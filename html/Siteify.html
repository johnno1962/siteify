<html><head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="siteify.css">
<script>

var lastlink;

function expand(a) {
    if ( a.children[0].style.display != "block" ) {
        if ( lastlink )
            lastlink.style.display = "none";
        a.children[0].style.display = "block";
        lastlink = a.children[0];
    }
    else {
        a.children[0].style.display = "none";
        lastlink = null;
    }
    return false;
}

</script></head><body><pre>0001    <span class='comment'><a name='1_0'>//
0002    </a></span><span class='comment'><a name='2_0'>//  Siteify.swift
0003    </a></span><span class='comment'><a name='3_0'>//  siteify
0004    </a></span><span class='comment'><a name='4_0'>//
0005    </a></span><span class='comment'><a name='5_0'>//  Created by John Holdsworth on 28/10/2019.
0006    </a></span><span class='comment'><a name='6_0'>//  Copyright Â© 2019 John Holdsworth. All rights reserved.
0007    </a></span><span class='comment'><a name='7_0'>//
0008    </a></span><span class='comment'><a name='8_0'>//  $Id: //depot/siteify/siteify/Siteify.swift#1 $
0009    </a></span><span class='comment'><a name='9_0'>//
0010    </a></span><span class='comment'><a name='10_0'>//  Repo: </a></span><span class='url'><a href='https://github.com/johnno1962/siteify'>https://github.com/johnno1962/siteify</a></span><span class='comment'><a name='10_47'>
0011    </a></span><span class='comment'><a name='11_0'>//
0012    </a></span>
0013    <span class='keyword'><a name='13_0'>import</a></span> <span class='identifier'><a name='13_7'>Foundation</a></span>
0014    <span class='keyword'><a name='14_0'>import</a></span> <span class='identifier'><a name='14_7'>SwiftLSPClient</a></span>
0015    <span class='keyword'><a name='15_0'>#if</a></span> <span class='id'><a name='15_4'>SWIFT_PACKAGE</a></span>
0016    <span class='keyword'><a name='16_0'>import</a></span> <span class='identifier'><a name='16_7'>SourceKit</a></span>
0017    <span class='keyword'><a name='17_0'>#endif</a></span>
0018    
0019    <span class='keyword'><a name='19_0'>var</a></span> <span class='identifier'><a name='19_4' href='#' title='usrString2' onclick='return expand(this);'>filenameForFile<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#24_22"; return false;'>Siteify.swift:24</td><td><pre>    if let filename = filenameForFile[file] {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#33_4"; return false;'>Siteify.swift:33</td><td><pre>    filenameForFile[file] = filename</pre></td></table></span></a></span> = [<span class='identifier'><a name='19_23'>String</a></span>:<span class='identifier'><a name='19_30'>String</a></span>](), <span class='identifier'><a name='19_41' href='#' title='usrString2' onclick='return expand(this);'>filesForFileName<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#28_10"; return false;'>Siteify.swift:28</td><td><pre>    while filesForFileName[filename] != nil {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#32_4"; return false;'>Siteify.swift:32</td><td><pre>    filesForFileName[filename] = file</pre></td></table></span></a></span> = [<span class='identifier'><a name='19_61'>String</a></span>:<span class='identifier'><a name='19_68'>String</a></span>]()
0020    
0021    <span class='keyword'><a name='21_0'>let</a></span> <span class='identifier'><a name='21_4' href='#' title='usrString2' onclick='return expand(this);'>filenameLock<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#31_4"; return false;'>Siteify.swift:31</td><td><pre>    filenameLock.lock()</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#34_4"; return false;'>Siteify.swift:34</td><td><pre>    filenameLock.unlock()</pre></td></table></span></a></span> = <span class='identifier'><a name='21_19'>NSLock</a></span>()
0022    
0023    <span class='keyword'><a name='23_0'>func</a></span> <span class='identifier'><a name='23_5' href='#' title='usrString2' onclick='return expand(this);'>fileFilename<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#160_23"; return false;'>Siteify.swift:160</td><td><pre>        let htmlfile = fileFilename(file: path)+".html"</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#325_27"; return false;'>Siteify.swift:325</td><td><pre>    var filename: String { fileFilename(file: URL(string: uri)!.path) }</pre></td></table></span></a></span>(<span class='identifier'><a name='23_18' href='#' title='usrString2' onclick='return expand(this);'>file<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#24_38"; return false;'>Siteify.swift:24</td><td><pre>    if let filename = filenameForFile[file] {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#27_42"; return false;'>Siteify.swift:27</td><td><pre>    var filename = NSURL(fileURLWithPath: file).deletingPathExtension!.lastPathComponent</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#32_33"; return false;'>Siteify.swift:32</td><td><pre>    filesForFileName[filename] = file</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#33_20"; return false;'>Siteify.swift:33</td><td><pre>    filenameForFile[file] = filename</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='23_24'>String</a></span>) -> <span class='typeidentifier'><a name='23_35'>String</a></span> {
0024        <span class='keyword'><a name='24_4'>if</a></span> <span class='keyword'><a name='24_7'>let</a></span> <span class='identifier'><a name='24_11' title='usrString3'>filename</a></span> = <span class='identifier'><a name='24_22' href='Siteify.html#19_4' title='usrString1'>filenameForFile</a></span>[<span class='identifier'><a name='24_38' href='Siteify.html#23_18' title='usrString1'>file</a></span>] {
0025            <span class='keyword'><a name='25_8'>return</a></span> <span class='identifier'><a name='25_15' href='Siteify.html#24_11' title='usrString1'>filename</a></span>
0026        }
0027        <span class='keyword'><a name='27_4'>var</a></span> <span class='identifier'><a name='27_8' title='usrString3'>filename</a></span> = <span class='identifier'><a name='27_19'>NSURL</a></span>(<span class='identifier'><a name='27_25'>fileURLWithPath</a></span>: <span class='identifier'><a name='27_42' href='Siteify.html#23_18' title='usrString1'>file</a></span>).<span class='identifier'><a name='27_48'>deletingPathExtension</a></span>!.<span class='identifier'><a name='27_71'>lastPathComponent</a></span>
0028        <span class='keyword'><a name='28_4'>while</a></span> <span class='identifier'><a name='28_10' href='Siteify.html#19_41' title='usrString1'>filesForFileName</a></span>[<span class='identifier'><a name='28_27' href='Siteify.html#27_8' title='usrString1'>filename</a></span>] != <span class='keyword'><a name='28_40'>nil</a></span> {
0029            <span class='identifier'><a name='29_8' href='Siteify.html#27_8' title='usrString1'>filename</a></span> += <span class='string'><a name='29_20'>"_"</a></span>
0030        }
0031        <span class='identifier'><a name='31_4' href='Siteify.html#21_4' title='usrString1'>filenameLock</a></span>.<span class='identifier'><a name='31_17'>lock</a></span>()
0032        <span class='identifier'><a name='32_4' href='Siteify.html#19_41' title='usrString1'>filesForFileName</a></span>[<span class='identifier'><a name='32_21' href='Siteify.html#27_8' title='usrString1'>filename</a></span>] = <span class='identifier'><a name='32_33' href='Siteify.html#23_18' title='usrString1'>file</a></span>
0033        <span class='identifier'><a name='33_4' href='Siteify.html#19_4' title='usrString1'>filenameForFile</a></span>[<span class='identifier'><a name='33_20' href='Siteify.html#23_18' title='usrString1'>file</a></span>] = <span class='identifier'><a name='33_28' href='Siteify.html#27_8' title='usrString1'>filename</a></span>
0034        <span class='identifier'><a name='34_4' href='Siteify.html#21_4' title='usrString1'>filenameLock</a></span>.<span class='identifier'><a name='34_17'>unlock</a></span>()
0035        <span class='keyword'><a name='35_4'>return</a></span> <span class='identifier'><a name='35_11' href='Siteify.html#27_8' title='usrString1'>filename</a></span>
0036    }
0037    
0038    <span class='keyword'><a name='38_0'>var</a></span> <span class='identifier'><a name='38_4' href='#' title='usrString2' onclick='return expand(this);'>comma<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#167_62"; return false;'>Siteify.swift:167</td><td><pre>                fputs("&lt;a href='\(htmlfile)'>\(relative)&lt;a> \(comma.string(from: NSNumber(value: data.count))!) bytes&lt;br>\n", index)</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='38_11'>NumberFormatter</a></span> = {
0039        <span class='keyword'><a name='39_4'>let</a></span> <span class='identifier'><a name='39_8' title='usrString3'>comma</a></span> = <span class='identifier'><a name='39_16'>NumberFormatter</a></span>()
0040        <span class='identifier'><a name='40_4' href='Siteify.html#39_8' title='usrString1'>comma</a></span>.<span class='identifier'><a name='40_10'>numberStyle</a></span> = <span class='identifier'><a name='40_24'>NumberFormatter</a></span>.<span class='identifier'><a name='40_40'>Style</a></span>.<span class='identifier'><a name='40_46'>decimal</a></span>
0041        <span class='keyword'><a name='41_4'>return</a></span> <span class='identifier'><a name='41_11' href='Siteify.html#39_8' title='usrString1'>comma</a></span>
0042    }()
0043    
0044    <span class='keyword'><a name='44_0'>func</a></span> <span class='identifier'><a name='44_5' href='#' title='usrString2' onclick='return expand(this);'>progress<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#155_8"; return false;'>Siteify.swift:155</td><td><pre>        progress(str: "Site complete.")</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#162_8"; return false;'>Siteify.swift:162</td><td><pre>        progress(str: "Saving html/\(htmlfile)")</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#298_8"; return false;'>Siteify.swift:298</td><td><pre>        progress(str: "Saved html/\(htmlfile)")</pre></td></table></span></a></span>(<span class='identifier'><a name='44_14' href='#' title='usrString2' onclick='return expand(this);'>str<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#45_24"; return false;'>Siteify.swift:45</td><td><pre>    print("\u{001b}[2K"+str, separator: "", terminator: "\r")</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='44_19'>String</a></span>) {
0045        <span class='identifier'><a name='45_4'>print</a></span>(<span class='string'><a name='45_10'>"\u{001b}[2K"</a></span>+<span class='identifier'><a name='45_24' href='Siteify.html#44_14' title='usrString1'>str</a></span>, <span class='identifier'><a name='45_29'>separator</a></span>: <span class='string'><a name='45_40'>""</a></span>, <span class='identifier'><a name='45_44'>terminator</a></span>: <span class='string'><a name='45_56'>"\r"</a></span>)
0046        <span class='identifier'><a name='46_4'>fflush</a></span>(<span class='identifier'><a name='46_11'>stdout</a></span>)
0047    }
0048    
0049    <span class='keyword'><a name='49_0'>struct</a></span> <span class='identifier'><a name='49_7' href='#' title='usrString2' onclick='return expand(this);'>LanguageServerSynchronizer<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#92_27"; return false;'>Siteify.swift:92</td><td><pre>        let synchronizer = LanguageServerSynchronizer()</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#159_27"; return false;'>Siteify.swift:159</td><td><pre>        let synchronizer = LanguageServerSynchronizer()</pre></td></table></span></a></span> {
0050        <span class='keyword'><a name='50_4'>let</a></span> <span class='identifier'><a name='50_8' href='#' title='usrString2' onclick='return expand(this);'>semaphore<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#62_17"; return false;'>Siteify.swift:62</td><td><pre>            self.semaphore.signal()</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#64_8"; return false;'>Siteify.swift:64</td><td><pre>        semaphore.wait()</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#77_17"; return false;'>Siteify.swift:77</td><td><pre>            self.semaphore.signal()</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#79_8"; return false;'>Siteify.swift:79</td><td><pre>        semaphore.wait()</pre></td></table></span></a></span> = <span class='identifier'><a name='50_20'>DispatchSemaphore</a></span>(<span class='identifier'><a name='50_38'>value</a></span>: <span class='number'><a name='50_45'>0</a></span>)
0051        <span class='keyword'><a name='51_4'>var</a></span> <span class='identifier'><a name='51_8' href='#' title='usrString2' onclick='return expand(this);'>errorHandler<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#60_21"; return false;'>Siteify.swift:60</td><td><pre>                self.errorHandler("LanguageServerError: \(error!)")</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#75_21"; return false;'>Siteify.swift:75</td><td><pre>                self.errorHandler("Error response \(error)")</pre></td></table></span></a></span> = {
0052            (<span class='identifier'><a name='52_9' title='usrString3'>message</a></span>: <span class='typeidentifier'><a name='52_18'>String</a></span>) <span class='keyword'><a name='52_26'>in</a></span>
0053            <span class='identifier'><a name='53_8'>fatalError</a></span>(<span class='identifier'><a name='53_19' href='Siteify.html#52_9' title='usrString1'>message</a></span>)
0054        }
0055    
0056        <span class='keyword'><a name='56_4'>func</a></span> <span class='identifier'><a name='56_9' title='usrString3'>sync</a></span>(<span class='keyword'><a name='56_14'>_</a></span> <span class='identifier'><a name='56_16' title='usrString3'>block</a></span>: <span class='builtin'><a name='56_23'>@escaping</a></span> (<span class='builtin'><a name='56_34'>@escaping</a></span> (<span class='typeidentifier'><a name='56_45'>LanguageServerError</a></span>?) -> <span class='typeidentifier'><a name='56_70'>Void</a></span>) -> <span class='typeidentifier'><a name='56_79'>Void</a></span>) {
0057            <span class='identifier'><a name='57_8' href='Siteify.html#56_16' title='usrString1'>block</a></span>({
0058                (<span class='identifier'><a name='58_13' title='usrString3'>error</a></span>: <span class='typeidentifier'><a name='58_20'>LanguageServerError</a></span>?) <span class='keyword'><a name='58_42'>in</a></span>
0059                <span class='keyword'><a name='59_12'>if</a></span> <span class='identifier'><a name='59_15' href='Siteify.html#58_13' title='usrString1'>error</a></span> != <span class='keyword'><a name='59_24'>nil</a></span> {
0060                    <span class='keyword'><a name='60_16'>self</a></span>.<span class='identifier'><a name='60_21'>errorHandler</a></span>(<span class='string'><a name='60_34'>"LanguageServerError: </a></span>\<span class='string_interpolation_anchor'><a name='60_57'>(</a></span><span class='identifier'><a name='60_58' href='Siteify.html#58_13' title='usrString1'>error</a></span>!<span class='string_interpolation_anchor'><a name='60_64'>)</a></span><span class='string'><a name='60_65'>"</a></span>)
0061                }
0062                <span class='keyword'><a name='62_12'>self</a></span>.<span class='identifier'><a name='62_17'>semaphore</a></span>.<span class='identifier'><a name='62_27'>signal</a></span>()
0063            })
0064            <span class='identifier'><a name='64_8' href='Siteify.html#50_8' title='usrString1'>semaphore</a></span>.<span class='identifier'><a name='64_18'>wait</a></span>()
0065        }
0066    
0067        <span class='keyword'><a name='67_4'>func</a></span> <span class='identifier'><a name='67_9' title='usrString3'>sync</a></span>&lt;<span class='identifier'><a name='67_14' title='usrString3'>RESP</a></span>>(<span class='keyword'><a name='67_20'>_</a></span> <span class='identifier'><a name='67_22' title='usrString3'>block</a></span>: <span class='builtin'><a name='67_29'>@escaping</a></span> (<span class='builtin'><a name='67_40'>@escaping</a></span> (<span class='typeidentifier'><a name='67_51'>LanguageServerResult</a></span>&lt;<span class='typeidentifier'><a name='67_72'>RESP</a></span>>) -> <span class='typeidentifier'><a name='67_82'>Void</a></span>) -> <span class='typeidentifier'><a name='67_91'>Void</a></span>) -> <span class='typeidentifier'><a name='67_100'>RESP</a></span> {
0068            <span class='keyword'><a name='68_8'>var</a></span> <span class='identifier'><a name='68_12' title='usrString3'>theResponse</a></span>: <span class='typeidentifier'><a name='68_25'>RESP</a></span>?
0069            <span class='identifier'><a name='69_8' href='Siteify.html#67_22' title='usrString1'>block</a></span>({
0070                (<span class='identifier'><a name='70_13' title='usrString3'>response</a></span>: <span class='typeidentifier'><a name='70_23'>LanguageServerResult</a></span>) <span class='keyword'><a name='70_45'>in</a></span>
0071                <span class='keyword'><a name='71_12'>switch</a></span> <span class='identifier'><a name='71_19' href='Siteify.html#70_13' title='usrString1'>response</a></span> {
0072                <span class='keyword'><a name='72_12'>case</a></span> .<span class='identifier'><a name='72_18'>success</a></span>(<span class='keyword'><a name='72_26'>let</a></span> <span class='identifier'><a name='72_30' title='usrString3'>value</a></span>):
0073                    <span class='identifier'><a name='73_16' href='Siteify.html#68_12' title='usrString1'>theResponse</a></span> = <span class='identifier'><a name='73_30' href='Siteify.html#72_30' title='usrString1'>value</a></span>
0074                <span class='keyword'><a name='74_12'>case</a></span> .<span class='identifier'><a name='74_18'>failure</a></span>(<span class='keyword'><a name='74_26'>let</a></span> <span class='identifier'><a name='74_30' title='usrString3'>error</a></span>):
0075                    <span class='keyword'><a name='75_16'>self</a></span>.<span class='identifier'><a name='75_21'>errorHandler</a></span>(<span class='string'><a name='75_34'>"Error response </a></span>\<span class='string_interpolation_anchor'><a name='75_51'>(</a></span><span class='identifier'><a name='75_52' href='Siteify.html#74_30' title='usrString1'>error</a></span><span class='string_interpolation_anchor'><a name='75_57'>)</a></span><span class='string'><a name='75_58'>"</a></span>)
0076                }
0077                <span class='keyword'><a name='77_12'>self</a></span>.<span class='identifier'><a name='77_17'>semaphore</a></span>.<span class='identifier'><a name='77_27'>signal</a></span>()
0078            })
0079            <span class='identifier'><a name='79_8' href='Siteify.html#50_8' title='usrString1'>semaphore</a></span>.<span class='identifier'><a name='79_18'>wait</a></span>()
0080            <span class='keyword'><a name='80_8'>return</a></span> <span class='identifier'><a name='80_15' href='Siteify.html#68_12' title='usrString1'>theResponse</a></span>!
0081        }
0082    }
0083    
0084    <span class='builtin'><a name='84_0'>public</a></span> <span class='keyword'><a name='84_7'>class</a></span> <span class='identifier'><a name='84_13' href='#' title='usrString2' onclick='return expand(this);'>Siteify<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Resources.html#9_10"; event.stopPropagation(); return false;'>Resources.swift:9</td><td><pre>extension Siteify {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="main.html#18_0"; event.stopPropagation(); return false;'>main.swift:18</td><td><pre>Siteify(projectRoot: ".").generateSite(into: "html")</pre></td></table></span></a></span> {
0085    
0086        <span class='keyword'><a name='86_4'>let</a></span> <span class='identifier'><a name='86_8' title='usrString3'>host</a></span>: <span class='typeidentifier'><a name='86_14'>LanguageServerProcessHost</a></span>
0087        <span class='keyword'><a name='87_4'>var</a></span> <span class='identifier'><a name='87_8' title='usrString3'>lspServer</a></span>: <span class='typeidentifier'><a name='87_19'>LanguageServer</a></span>?
0088        <span class='keyword'><a name='88_4'>let</a></span> <span class='identifier'><a name='88_8' href='#' title='usrString2' onclick='return expand(this);'>sourceKit<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#222_32"; return false;'>Siteify.swift:222</td><td><pre>                let resp = self.sourceKit.syntaxMap(filePath: path)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#224_16"; return false;'>Siteify.swift:224</td><td><pre>                sourceKit.recurseOver(childID: self.sourceKit.syntaxID, resp: dict) { dict in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#224_52"; return false;'>Siteify.swift:224</td><td><pre>                sourceKit.recurseOver(childID: self.sourceKit.syntaxID, resp: dict) { dict in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#225_55"; return false;'>Siteify.swift:225</td><td><pre>                    let offset = dict.getInt(key: self.sourceKit.offsetID)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#226_55"; return false;'>Siteify.swift:226</td><td><pre>                    let length = dict.getInt(key: self.sourceKit.lengthID)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#232_60"; return false;'>Siteify.swift:232</td><td><pre>                    let kind = dict.getUUIDString(key: self.sourceKit.kindID)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#238_78"; return false;'>Siteify.swift:238</td><td><pre>                    if SKApi.sourcekitd_variant_dictionary_get_uid(dict, self.sourceKit.kindID) == self.sourceKit.identifierID {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#238_104"; return false;'>Siteify.swift:238</td><td><pre>                    if SKApi.sourcekitd_variant_dictionary_get_uid(dict, self.sourceKit.kindID) == self.sourceKit.identifierID {</pre></td></table></span></a></span> = <span class='identifier'><a name='88_20' href='SourceKit.html#170_6' title='usrString1'>SourceKit</a></span>(<span class='identifier'><a name='88_30' href='SourceKit.html#225_4' title='usrString1'>isTTY</a></span>: <span class='keyword'><a name='88_37'>false</a></span>)
0089        <span class='keyword'><a name='89_4'>let</a></span> <span class='identifier'><a name='89_8' href='#' title='usrString2' onclick='return expand(this);'>projectRoot<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#97_13"; return false;'>Siteify.swift:97</td><td><pre>        self.projectRoot = URL(fileURLWithPath: projectRoot,</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#138_24"; return false;'>Siteify.swift:138</td><td><pre>            "__ROOT__": projectRoot.replacingOccurrences(of: home, with: "~")])</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#141_56"; return false;'>Siteify.swift:141</td><td><pre>        let fileEnumerator = filemgr.enumerator(atPath: projectRoot)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#150_48"; return false;'>Siteify.swift:150</td><td><pre>                    self.processFile(path: self.projectRoot + "/" + path)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#161_53"; return false;'>Siteify.swift:161</td><td><pre>        let relative = path.replacingOccurrences(of: projectRoot+"/", with: "")</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#257_81"; return false;'>Siteify.swift:257</td><td><pre>                                if refs.count > 0 &amp;&amp; decl.file.starts(with: self.projectRoot) {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#274_64"; return false;'>Siteify.swift:274</td><td><pre>                            else if decl.file.starts(with: self.projectRoot) {</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='89_21'>String</a></span>
0090    
0091        <span class='builtin'><a name='91_4'>public</a></span> <span class='keyword'><a name='91_11'>init</a></span>(<span class='identifier'><a name='91_16' href='#' title='usrString2' onclick='return expand(this);'>projectRoot<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#97_48"; return false;'>Siteify.swift:97</td><td><pre>        self.projectRoot = URL(fileURLWithPath: projectRoot,</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#116_48"; return false;'>Siteify.swift:116</td><td><pre>                                      rootPath: projectRoot,</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#121_88"; return false;'>Siteify.swift:121</td><td><pre>                                      workspaceFolders: [WorkspaceFolder(uri: "file://\(projectRoot)/", name: "siteify")])</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='91_29'>String</a></span>) {
0092            <span class='keyword'><a name='92_8'>let</a></span> <span class='identifier'><a name='92_12' title='usrString3'>synchronizer</a></span> = <span class='identifier'><a name='92_27' href='Siteify.html#49_7' title='usrString1'>LanguageServerSynchronizer</a></span>()
0093            <span class='keyword'><a name='93_8'>var</a></span> <span class='identifier'><a name='93_12' title='usrString3'>rootBuffer</a></span> = [<span class='identifier'><a name='93_26'>Int8</a></span>](<span class='identifier'><a name='93_32'>repeating</a></span>: <span class='number'><a name='93_43'>0</a></span>, <span class='identifier'><a name='93_46'>count</a></span>: <span class='number'><a name='93_53'>1024</a></span>)
0094            <span class='keyword'><a name='94_8'>let</a></span> <span class='identifier'><a name='94_12' title='usrString3'>cwd</a></span> = <span class='identifier'><a name='94_18'>String</a></span>(<span class='identifier'><a name='94_25'>cString</a></span>: <span class='identifier'><a name='94_34' href='Siteify.html#93_12' title='usrString1'>rootBuffer</a></span>.<span class='identifier'><a name='94_45'>withUnsafeMutableBufferPointer</a></span> {
0095                <span class='identifier'><a name='95_12'>getcwd</a></span>(<span class='identifier'><a name='95_19' href='Siteify.html#94_76' title='usrString1'>$0</a></span>.<span class='identifier'><a name='95_22'>baseAddress</a></span>, <span class='identifier'><a name='95_35' href='Siteify.html#94_76' title='usrString1'>$0</a></span>.<span class='identifier'><a name='95_38'>count</a></span>)
0096            })
0097            <span class='keyword'><a name='97_8'>self</a></span>.<span class='identifier'><a name='97_13' href='Siteify.html#89_8' title='usrString1'>projectRoot</a></span> = <span class='identifier'><a name='97_27'>URL</a></span>(<span class='identifier'><a name='97_31'>fileURLWithPath</a></span>: <span class='identifier'><a name='97_48' href='Siteify.html#91_16' title='usrString1'>projectRoot</a></span>,
0098                <span class='identifier'><a name='98_12'>relativeTo</a></span>: <span class='identifier'><a name='98_24'>URL</a></span>(<span class='identifier'><a name='98_28'>fileURLWithPath</a></span>: <span class='identifier'><a name='98_45' href='Siteify.html#94_12' title='usrString1'>cwd</a></span>)).<span class='identifier'><a name='98_51'>path</a></span>
0099    
0100            <span class='keyword'><a name='100_8'>let</a></span> <span class='identifier'><a name='100_12' title='usrString3'>executablePath</a></span> = <span class='string'><a name='100_29'>"/Library/Developer/Toolchains/swift-latest.xctoolchain/usr/bin/sourcekit-lsp"</a></span>
0101            <span class='keyword'><a name='101_8'>let</a></span> <span class='identifier'><a name='101_12' title='usrString3'>PATH</a></span> = <span class='identifier'><a name='101_19'>ProcessInfo</a></span>.<span class='identifier'><a name='101_31'>processInfo</a></span>.<span class='identifier'><a name='101_43'>environment</a></span>[<span class='string'><a name='101_55'>"PATH"</a></span>] ?? <span class='string'><a name='101_66'>"/usr/bin"</a></span>
0102            <span class='identifier'><a name='102_8'>host</a></span> = <span class='identifier'><a name='102_15'>LanguageServerProcessHost</a></span>(<span class='identifier'><a name='102_41'>path</a></span>: <span class='identifier'><a name='102_47' href='Siteify.html#100_12' title='usrString1'>executablePath</a></span>, <span class='identifier'><a name='102_63'>arguments</a></span>: [],
0103                                             <span class='identifier'><a name='103_41'>environment</a></span>: [<span class='string'><a name='103_55'>"PATH"</a></span>: <span class='identifier'><a name='103_63' href='Siteify.html#101_12' title='usrString1'>PATH</a></span>])
0104    
0105            <span class='identifier'><a name='105_8'>host</a></span>.<span class='identifier'><a name='105_13'>start</a></span> { (<span class='identifier'><a name='105_22' title='usrString3'>server</a></span>) <span class='keyword'><a name='105_30'>in</a></span>
0106                <span class='keyword'><a name='106_12'>guard</a></span> <span class='keyword'><a name='106_18'>let</a></span> <span class='identifier'><a name='106_22' title='usrString3'>server</a></span> = <span class='identifier'><a name='106_31' href='Siteify.html#105_22' title='usrString1'>server</a></span> <span class='keyword'><a name='106_38'>else</a></span> {
0107                    <span class='identifier'><a name='107_16'>fatalError</a></span>(<span class='string'><a name='107_27'>"unable to launch server"</a></span>)
0108                }
0109                <span class='keyword'><a name='109_12'>self</a></span>.<span class='identifier'><a name='109_17'>lspServer</a></span> = <span class='identifier'><a name='109_29' href='Siteify.html#106_22' title='usrString1'>server</a></span>
0110            }
0111    
0112            <span class='keyword'><a name='112_8'>let</a></span> <span class='identifier'><a name='112_12' title='usrString3'>processId</a></span> = <span class='identifier'><a name='112_24'>Int</a></span>(<span class='identifier'><a name='112_28'>ProcessInfo</a></span>.<span class='identifier'><a name='112_40'>processInfo</a></span>.<span class='identifier'><a name='112_52'>processIdentifier</a></span>)
0113            <span class='keyword'><a name='113_8'>let</a></span> <span class='identifier'><a name='113_12' title='usrString3'>capabilities</a></span> = <span class='identifier'><a name='113_27'>ClientCapabilities</a></span>(<span class='identifier'><a name='113_46'>workspace</a></span>: <span class='keyword'><a name='113_57'>nil</a></span>, <span class='identifier'><a name='113_62'>textDocument</a></span>: <span class='keyword'><a name='113_76'>nil</a></span>, <span class='identifier'><a name='113_81'>experimental</a></span>: <span class='keyword'><a name='113_95'>nil</a></span>)
0114    
0115            <span class='keyword'><a name='115_8'>let</a></span> <span class='identifier'><a name='115_12' title='usrString3'>params</a></span> = <span class='identifier'><a name='115_21'>InitializeParams</a></span>(<span class='identifier'><a name='115_38'>processId</a></span>: <span class='identifier'><a name='115_49' href='Siteify.html#112_12' title='usrString1'>processId</a></span>,
0116                                          <span class='identifier'><a name='116_38'>rootPath</a></span>: <span class='identifier'><a name='116_48' href='Siteify.html#91_16' title='usrString1'>projectRoot</a></span>,
0117                                          <span class='identifier'><a name='117_38'>rootURI</a></span>: <span class='keyword'><a name='117_47'>nil</a></span>,
0118                                          <span class='identifier'><a name='118_38'>initializationOptions</a></span>: <span class='keyword'><a name='118_61'>nil</a></span>,
0119                                          <span class='identifier'><a name='119_38'>capabilities</a></span>: <span class='identifier'><a name='119_52' href='Siteify.html#113_12' title='usrString1'>capabilities</a></span>,
0120                                          <span class='identifier'><a name='120_38'>trace</a></span>: <span class='identifier'><a name='120_45'>Tracing</a></span>.<span class='identifier'><a name='120_53'>off</a></span>,
0121                                          <span class='identifier'><a name='121_38'>workspaceFolders</a></span>: [<span class='identifier'><a name='121_57'>WorkspaceFolder</a></span>(<span class='identifier'><a name='121_73'>uri</a></span>: <span class='string'><a name='121_78'>"file://</a></span>\<span class='string_interpolation_anchor'><a name='121_87'>(</a></span><span class='identifier'><a name='121_88' href='Siteify.html#91_16' title='usrString1'>projectRoot</a></span><span class='string_interpolation_anchor'><a name='121_99'>)</a></span><span class='string'><a name='121_100'>/"</a></span>, <span class='identifier'><a name='121_104'>name</a></span>: <span class='string'><a name='121_110'>"siteify"</a></span>)])
0122    
0123            <span class='keyword'><a name='123_8'>_</a></span> = <span class='identifier'><a name='123_12' href='Siteify.html#92_12' title='usrString1'>synchronizer</a></span>.<span class='identifier'><a name='123_25'>sync</a></span>({
0124                <span class='keyword'><a name='124_12'>self</a></span>.<span class='identifier'><a name='124_17'>lspServer</a></span>!.<span class='identifier'><a name='124_28'>initialize</a></span>(<span class='identifier'><a name='124_39'>params</a></span>: <span class='identifier'><a name='124_47' href='Siteify.html#115_12' title='usrString1'>params</a></span>, <span class='identifier'><a name='124_55'>block</a></span>: <span class='identifier'><a name='124_62' href='Siteify.html#123_30' title='usrString1'>$0</a></span>)
0125            })
0126        }
0127    
0128        <span class='keyword'><a name='128_4'>var</a></span> <span class='identifier'><a name='128_8' href='#' title='usrString2' onclick='return expand(this);'>index<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#136_8"; return false;'>Siteify.swift:136</td><td><pre>        index = copyTemplate(template: "index.html", patches: [</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#139_15"; return false;'>Siteify.swift:139</td><td><pre>        setbuf(index, nil)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#166_15"; return false;'>Siteify.swift:166</td><td><pre>            if index != nil {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#167_126"; return false;'>Siteify.swift:167</td><td><pre>                fputs("&lt;a href='\(htmlfile)'>\(relative)&lt;a> \(comma.string(from: NSNumber(value: data.count))!) bytes&lt;br>\n", index)</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='128_15'>UnsafeMutablePointer</a></span>&lt;<span class='typeidentifier'><a name='128_36'>FILE</a></span>>?
0129    
0130        <span class='builtin'><a name='130_4'>public</a></span> <span class='keyword'><a name='130_11'>func</a></span> <span class='identifier'><a name='130_16' href='#' title='usrString2' onclick='return expand(this);'>generateSite<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="main.html#18_26"; event.stopPropagation(); return false;'>main.swift:18</td><td><pre>Siteify(projectRoot: ".").generateSite(into: "html")</pre></td></table></span></a></span>(<span class='identifier'><a name='130_29' title='usrString2' onclick='return expand(this);'>into<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='130_35'>String</a></span>) {
0131            <span class='keyword'><a name='131_8'>let</a></span> <span class='identifier'><a name='131_12' title='usrString3'>filemgr</a></span> = <span class='identifier'><a name='131_22'>FileManager</a></span>.<span class='identifier'><a name='131_34'>default</a></span>
0132            <span class='keyword'><a name='132_8'>if</a></span> !<span class='identifier'><a name='132_12' href='Siteify.html#131_12' title='usrString1'>filemgr</a></span>.<span class='identifier'><a name='132_20'>fileExists</a></span>(<span class='identifier'><a name='132_31'>atPath</a></span>: <span class='string'><a name='132_39'>"html"</a></span>) {
0133                <span class='keyword'><a name='133_12'>try</a></span>! <span class='identifier'><a name='133_17' href='Siteify.html#131_12' title='usrString1'>filemgr</a></span>.<span class='identifier'><a name='133_25'>createDirectory</a></span>(<span class='identifier'><a name='133_41'>atPath</a></span>: <span class='string'><a name='133_49'>"html"</a></span>, <span class='identifier'><a name='133_57'>withIntermediateDirectories</a></span>: <span class='keyword'><a name='133_86'>false</a></span>, <span class='identifier'><a name='133_93'>attributes</a></span>: <span class='keyword'><a name='133_105'>nil</a></span>)
0134            }
0135            <span class='identifier'><a name='135_8'>fclose</a></span>(<span class='identifier'><a name='135_15' href='Siteify.html#304_9' title='usrString1'>copyTemplate</a></span>(<span class='identifier'><a name='135_28'>template</a></span>: <span class='string'><a name='135_38'>"siteify.css"</a></span>))
0136            <span class='identifier'><a name='136_8' href='Siteify.html#128_8' title='usrString1'>index</a></span> = <span class='identifier'><a name='136_16' href='Siteify.html#304_9' title='usrString1'>copyTemplate</a></span>(<span class='identifier'><a name='136_29'>template</a></span>: <span class='string'><a name='136_39'>"index.html"</a></span>, <span class='identifier'><a name='136_53'>patches</a></span>: [
0137                <span class='string'><a name='137_12'>"__DATE__"</a></span>: <span class='identifier'><a name='137_24'>NSDate</a></span>().<span class='identifier'><a name='137_33'>description</a></span>,
0138                <span class='string'><a name='138_12'>"__ROOT__"</a></span>: <span class='identifier'><a name='138_24' href='Siteify.html#89_8' title='usrString1'>projectRoot</a></span>.<span class='identifier'><a name='138_36'>replacingOccurrences</a></span>(<span class='identifier'><a name='138_57'>of</a></span>: <span class='identifier'><a name='138_61' href='Siteify.html#301_8' title='usrString1'>home</a></span>, <span class='identifier'><a name='138_67'>with</a></span>: <span class='string'><a name='138_73'>"~"</a></span>)])
0139            <span class='identifier'><a name='139_8'>setbuf</a></span>(<span class='identifier'><a name='139_15' href='Siteify.html#128_8' title='usrString1'>index</a></span>, <span class='keyword'><a name='139_22'>nil</a></span>)
0140    
0141            <span class='keyword'><a name='141_8'>let</a></span> <span class='identifier'><a name='141_12' title='usrString3'>fileEnumerator</a></span> = <span class='identifier'><a name='141_29' href='Siteify.html#131_12' title='usrString1'>filemgr</a></span>.<span class='identifier'><a name='141_37'>enumerator</a></span>(<span class='identifier'><a name='141_48'>atPath</a></span>: <span class='identifier'><a name='141_56' href='Siteify.html#89_8' title='usrString1'>projectRoot</a></span>)
0142    
0143            <span class='identifier'><a name='143_8' href='Parallelize.html#15_12' title='usrString1'>parallelize</a></span>(<span class='identifier'><a name='143_20'>threads</a></span>: <span class='number'><a name='143_29'>4</a></span>) {
0144                <span class='keyword'><a name='144_12'>guard</a></span> <span class='keyword'><a name='144_18'>let</a></span> <span class='identifier'><a name='144_22' title='usrString3'>file</a></span> = <span class='identifier'><a name='144_29' href='Siteify.html#141_12' title='usrString1'>fileEnumerator</a></span>?.<span class='identifier'><a name='144_45'>nextObject</a></span>() <span class='keyword'><a name='144_58'>else</a></span> {
0145                    <span class='keyword'><a name='145_16'>return</a></span> <span class='keyword'><a name='145_23'>nil</a></span>
0146                }
0147                <span class='keyword'><a name='147_12'>return</a></span> {
0148                    <span class='keyword'><a name='148_16'>if</a></span> <span class='keyword'><a name='148_19'>let</a></span> <span class='identifier'><a name='148_23' title='usrString3'>path</a></span> = <span class='identifier'><a name='148_30' href='Siteify.html#144_22' title='usrString1'>file</a></span> <span class='keyword'><a name='148_35'>as</a></span>? <span class='typeidentifier'><a name='148_39'>String</a></span>,
0149                        (<span class='keyword'><a name='149_21'>try</a></span>? <span class='identifier'><a name='149_26'>LanguageIdentifier</a></span>(<span class='identifier'><a name='149_45'>for</a></span>: <span class='identifier'><a name='149_50'>URL</a></span>(<span class='identifier'><a name='149_54'>fileURLWithPath</a></span>: <span class='identifier'><a name='149_71' href='Siteify.html#148_23' title='usrString1'>path</a></span>))) != <span class='keyword'><a name='149_82'>nil</a></span> {
0150                        <span class='keyword'><a name='150_20'>self</a></span>.<span class='identifier'><a name='150_25' href='Siteify.html#158_16' title='usrString1'>processFile</a></span>(<span class='identifier'><a name='150_37' href='Siteify.html#158_16' title='usrString1'>path</a></span>: <span class='keyword'><a name='150_43'>self</a></span>.<span class='identifier'><a name='150_48' href='Siteify.html#89_8' title='usrString1'>projectRoot</a></span> + <span class='string'><a name='150_62'>"/"</a></span> + <span class='identifier'><a name='150_68' href='Siteify.html#148_23' title='usrString1'>path</a></span>)
0151                    }
0152                }
0153            }
0154    
0155            <span class='identifier'><a name='155_8' href='Siteify.html#44_5' title='usrString1'>progress</a></span>(<span class='identifier'><a name='155_17' href='Siteify.html#44_5' title='usrString1'>str</a></span>: <span class='string'><a name='155_22'>"Site complete."</a></span>)
0156        }
0157    
0158        <span class='builtin'><a name='158_4'>public</a></span> <span class='keyword'><a name='158_11'>func</a></span> <span class='identifier'><a name='158_16' href='#' title='usrString2' onclick='return expand(this);'>processFile<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#150_25"; return false;'>Siteify.swift:150</td><td><pre>                    self.processFile(path: self.projectRoot + "/" + path)</pre></td></table></span></a></span>(<span class='identifier'><a name='158_28' href='#' title='usrString2' onclick='return expand(this);'>path<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#160_42"; return false;'>Siteify.swift:160</td><td><pre>        let htmlfile = fileFilename(file: path)+".html"</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#161_23"; return false;'>Siteify.swift:161</td><td><pre>        let relative = path.replacingOccurrences(of: projectRoot+"/", with: "")</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#165_65"; return false;'>Siteify.swift:165</td><td><pre>        if let data = try? Data(contentsOf: URL(fileURLWithPath: path)) {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#171_138"; return false;'>Siteify.swift:171</td><td><pre>                self.lspServer!.didOpenTextDocument(params: DidOpenTextDocumentParams(textDocument: try! TextDocumentItem(contentsOfFile: path)), block: $0)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#222_62"; return false;'>Siteify.swift:222</td><td><pre>                let resp = self.sourceKit.syntaxMap(filePath: path)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#241_133"; return false;'>Siteify.swift:241</td><td><pre>                            self.lspServer!.definition(params: TextDocumentPositionParams(textDocument: TextDocumentIdentifier(path: path), position: pos), block: $0)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#252_44"; return false;'>Siteify.swift:252</td><td><pre>                            if decl.file == path &amp;&amp; decl.range.start == pos,</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#254_130"; return false;'>Siteify.swift:254</td><td><pre>                                    self.lspServer!.references(params: ReferenceParams(textDocument: TextDocumentIdentifier(path: path), position: pos, context: ReferenceContext(includeDeclaration: false)), block: $0)})?</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='158_34'>String</a></span>) {
0159            <span class='keyword'><a name='159_8'>let</a></span> <span class='identifier'><a name='159_12' title='usrString3'>synchronizer</a></span> = <span class='identifier'><a name='159_27' href='Siteify.html#49_7' title='usrString1'>LanguageServerSynchronizer</a></span>()
0160            <span class='keyword'><a name='160_8'>let</a></span> <span class='identifier'><a name='160_12' title='usrString3'>htmlfile</a></span> = <span class='identifier'><a name='160_23' href='Siteify.html#23_5' title='usrString1'>fileFilename</a></span>(<span class='identifier'><a name='160_36' href='Siteify.html#23_5' title='usrString1'>file</a></span>: <span class='identifier'><a name='160_42' href='Siteify.html#158_28' title='usrString1'>path</a></span>)+<span class='string'><a name='160_48'>".html"</a></span>
0161            <span class='keyword'><a name='161_8'>let</a></span> <span class='identifier'><a name='161_12' title='usrString3'>relative</a></span> = <span class='identifier'><a name='161_23' href='Siteify.html#158_28' title='usrString1'>path</a></span>.<span class='identifier'><a name='161_28'>replacingOccurrences</a></span>(<span class='identifier'><a name='161_49'>of</a></span>: <span class='identifier'><a name='161_53' href='Siteify.html#89_8' title='usrString1'>projectRoot</a></span>+<span class='string'><a name='161_65'>"/"</a></span>, <span class='identifier'><a name='161_70'>with</a></span>: <span class='string'><a name='161_76'>""</a></span>)
0162            <span class='identifier'><a name='162_8' href='Siteify.html#44_5' title='usrString1'>progress</a></span>(<span class='identifier'><a name='162_17' href='Siteify.html#44_5' title='usrString1'>str</a></span>: <span class='string'><a name='162_22'>"Saving html/</a></span>\<span class='string_interpolation_anchor'><a name='162_36'>(</a></span><span class='identifier'><a name='162_37' href='Siteify.html#160_12' title='usrString1'>htmlfile</a></span><span class='string_interpolation_anchor'><a name='162_45'>)</a></span><span class='string'><a name='162_46'>"</a></span>)
0163            <span class='keyword'><a name='163_8'>var</a></span> <span class='identifier'><a name='163_12' title='usrString3'>html</a></span> = <span class='string'><a name='163_19'>""</a></span>
0164    
0165            <span class='keyword'><a name='165_8'>if</a></span> <span class='keyword'><a name='165_11'>let</a></span> <span class='identifier'><a name='165_15' title='usrString3'>data</a></span> = <span class='keyword'><a name='165_22'>try</a></span>? <span class='identifier'><a name='165_27'>Data</a></span>(<span class='identifier'><a name='165_32'>contentsOf</a></span>: <span class='identifier'><a name='165_44'>URL</a></span>(<span class='identifier'><a name='165_48'>fileURLWithPath</a></span>: <span class='identifier'><a name='165_65' href='Siteify.html#158_28' title='usrString1'>path</a></span>)) {
0166                <span class='keyword'><a name='166_12'>if</a></span> <span class='identifier'><a name='166_15' href='Siteify.html#128_8' title='usrString1'>index</a></span> != <span class='keyword'><a name='166_24'>nil</a></span> {
0167                    <span class='identifier'><a name='167_16'>fputs</a></span>(<span class='string'><a name='167_22'>"&lt;a href='</a></span>\<span class='string_interpolation_anchor'><a name='167_33'>(</a></span><span class='identifier'><a name='167_34' href='Siteify.html#160_12' title='usrString1'>htmlfile</a></span><span class='string_interpolation_anchor'><a name='167_42'>)</a></span><span class='string'><a name='167_43'>'></a></span>\<span class='string_interpolation_anchor'><a name='167_46'>(</a></span><span class='identifier'><a name='167_47' href='Siteify.html#161_12' title='usrString1'>relative</a></span><span class='string_interpolation_anchor'><a name='167_55'>)</a></span><span class='string'><a name='167_56'>&lt;a> </a></span>\<span class='string_interpolation_anchor'><a name='167_61'>(</a></span><span class='identifier'><a name='167_62' href='Siteify.html#38_4' title='usrString1'>comma</a></span>.<span class='identifier'><a name='167_68'>string</a></span>(<span class='identifier'><a name='167_75'>from</a></span>: <span class='identifier'><a name='167_81'>NSNumber</a></span>(<span class='identifier'><a name='167_90'>value</a></span>: <span class='identifier'><a name='167_97' href='Siteify.html#165_15' title='usrString1'>data</a></span>.<span class='identifier'><a name='167_102'>count</a></span>))!<span class='string_interpolation_anchor'><a name='167_110'>)</a></span><span class='string'><a name='167_111'> bytes&lt;br>\n"</a></span>, <span class='identifier'><a name='167_126' href='Siteify.html#128_8' title='usrString1'>index</a></span>)
0168                }
0169    
0170                <span class='identifier'><a name='170_12' href='Siteify.html#159_12' title='usrString1'>synchronizer</a></span>.<span class='identifier'><a name='170_25'>sync</a></span> {
0171                    <span class='keyword'><a name='171_16'>self</a></span>.<span class='identifier'><a name='171_21'>lspServer</a></span>!.<span class='identifier'><a name='171_32'>didOpenTextDocument</a></span>(<span class='identifier'><a name='171_52'>params</a></span>: <span class='identifier'><a name='171_60'>DidOpenTextDocumentParams</a></span>(<span class='identifier'><a name='171_86'>textDocument</a></span>: <span class='keyword'><a name='171_100'>try</a></span>! <span class='identifier'><a name='171_105'>TextDocumentItem</a></span>(<span class='identifier'><a name='171_122'>contentsOfFile</a></span>: <span class='identifier'><a name='171_138' href='Siteify.html#158_28' title='usrString1'>path</a></span>)), <span class='identifier'><a name='171_146'>block</a></span>: <span class='identifier'><a name='171_153' href='Siteify.html#170_30' title='usrString1'>$0</a></span>)
0172                }
0173                <span class='identifier'><a name='173_12' href='Siteify.html#165_15' title='usrString1'>data</a></span>.<span class='identifier'><a name='173_17'>withUnsafeBytes</a></span> {
0174                    (<span class='identifier'><a name='174_17' title='usrString3'>start</a></span>: <span class='typeidentifier'><a name='174_24'>UnsafePointer</a></span>&lt;<span class='typeidentifier'><a name='174_38'>Int8</a></span>>) <span class='keyword'><a name='174_45'>in</a></span>
0175                    <span class='keyword'><a name='175_16'>var</a></span> <span class='identifier'><a name='175_20' title='usrString3'>curr</a></span> = <span class='identifier'><a name='175_27' href='Siteify.html#174_17' title='usrString1'>start</a></span>
0176                    <span class='keyword'><a name='176_16'>var</a></span> <span class='identifier'><a name='176_20' title='usrString3'>line</a></span> = <span class='number'><a name='176_27'>0</a></span>
0177                    <span class='keyword'><a name='177_16'>func</a></span> <span class='identifier'><a name='177_21' title='usrString3'>position</a></span>(<span class='identifier'><a name='177_30' href='Siteify.html#177_21' title='usrString1'>for</a></span> <span class='identifier'><a name='177_34' title='usrString3'>offset</a></span>: <span class='typeidentifier'><a name='177_42'>Int</a></span>) -> <span class='typeidentifier'><a name='177_50'>Position</a></span> {
0178                        <span class='keyword'><a name='178_20'>while</a></span> <span class='keyword'><a name='178_26'>let</a></span> <span class='identifier'><a name='178_30' title='usrString3'>next</a></span> = <span class='identifier'><a name='178_37'>UnsafePointer</a></span>&lt;<span class='typeidentifier'><a name='178_51'>Int8</a></span>>(<span class='identifier'><a name='178_57'>strchr</a></span>(<span class='identifier'><a name='178_64' href='Siteify.html#175_20' title='usrString1'>curr</a></span>, <span class='identifier'><a name='178_70'>Int32</a></span>(<span class='string'><a name='178_76'>"\n"</a></span>.<span class='identifier'><a name='178_81'>utf8</a></span>.<span class='identifier'><a name='178_86'>first</a></span>!))),
0179                            <span class='identifier'><a name='179_24' href='Siteify.html#178_30' title='usrString1'>next</a></span> - <span class='identifier'><a name='179_31' href='Siteify.html#174_17' title='usrString1'>start</a></span> &lt; <span class='identifier'><a name='179_39' href='Siteify.html#177_34' title='usrString1'>offset</a></span> {
0180                                <span class='identifier'><a name='180_28' href='Siteify.html#175_20' title='usrString1'>curr</a></span> = <span class='identifier'><a name='180_35' href='Siteify.html#178_30' title='usrString1'>next</a></span> + <span class='number'><a name='180_42'>1</a></span>
0181                                <span class='identifier'><a name='181_28' href='Siteify.html#176_20' title='usrString1'>line</a></span> += <span class='number'><a name='181_36'>1</a></span>
0182                        }
0183                        <span class='keyword'><a name='183_20'>return</a></span> <span class='identifier'><a name='183_27'>Position</a></span>(<span class='identifier'><a name='183_36'>line</a></span>: <span class='identifier'><a name='183_42' href='Siteify.html#176_20' title='usrString1'>line</a></span>,
0184                                        <span class='identifier'><a name='184_36'>character</a></span>: <span class='identifier'><a name='184_47' href='Siteify.html#177_34' title='usrString1'>offset</a></span> - (<span class='identifier'><a name='184_57' href='Siteify.html#175_20' title='usrString1'>curr</a></span> - <span class='identifier'><a name='184_64' href='Siteify.html#174_17' title='usrString1'>start</a></span>))
0185                    }
0186    
0187                    <span class='keyword'><a name='187_16'>let</a></span> <span class='identifier'><a name='187_20' title='usrString3'>newline</a></span> = <span class='identifier'><a name='187_30'>Int8</a></span>(<span class='string'><a name='187_35'>"\n"</a></span>.<span class='identifier'><a name='187_40'>utf16</a></span>.<span class='identifier'><a name='187_46'>last</a></span>!)
0188                    <span class='keyword'><a name='188_16'>var</a></span> <span class='identifier'><a name='188_20' title='usrString3'>ptr</a></span> = <span class='number'><a name='188_26'>0</a></span>, <span class='identifier'><a name='188_29' title='usrString3'>lineno</a></span> = <span class='number'><a name='188_38'>1</a></span>, <span class='identifier'><a name='188_41' title='usrString3'>col</a></span> = <span class='number'><a name='188_47'>1</a></span>
0189    
0190                    <span class='keyword'><a name='190_16'>func</a></span> <span class='identifier'><a name='190_21' title='usrString3'>skipTo</a></span>(<span class='identifier'><a name='190_28' href='#' title='usrString2' onclick='return expand(this);'>offset<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#191_65"; return false;'>Siteify.swift:191</td><td><pre>                    let out = NSString(bytes: start+ptr, length: offset-ptr, encoding: String.Encoding.utf8.rawValue) ?? ""</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#192_32"; return false;'>Siteify.swift:192</td><td><pre>                    while ptr &lt; offset {</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='190_36'>Int</a></span>) -> <span class='typeidentifier'><a name='190_44'>String</a></span> {
0191                        <span class='keyword'><a name='191_20'>let</a></span> <span class='identifier'><a name='191_24' title='usrString3'>out</a></span> = <span class='identifier'><a name='191_30'>NSString</a></span>(<span class='identifier'><a name='191_39'>bytes</a></span>: <span class='identifier'><a name='191_46' href='Siteify.html#174_17' title='usrString1'>start</a></span>+<span class='identifier'><a name='191_52' href='Siteify.html#188_20' title='usrString1'>ptr</a></span>, <span class='identifier'><a name='191_57'>length</a></span>: <span class='identifier'><a name='191_65' href='Siteify.html#190_28' title='usrString1'>offset</a></span>-<span class='identifier'><a name='191_72' href='Siteify.html#188_20' title='usrString1'>ptr</a></span>, <span class='identifier'><a name='191_77'>encoding</a></span>: <span class='identifier'><a name='191_87'>String</a></span>.<span class='identifier'><a name='191_94'>Encoding</a></span>.<span class='identifier'><a name='191_103'>utf8</a></span>.<span class='identifier'><a name='191_108'>rawValue</a></span>) ?? <span class='string'><a name='191_121'>""</a></span>
0192                        <span class='keyword'><a name='192_20'>while</a></span> <span class='identifier'><a name='192_26' href='Siteify.html#188_20' title='usrString1'>ptr</a></span> &lt; <span class='identifier'><a name='192_32' href='Siteify.html#190_28' title='usrString1'>offset</a></span> {
0193                            <span class='keyword'><a name='193_24'>if</a></span> <span class='identifier'><a name='193_27' href='Siteify.html#174_17' title='usrString1'>start</a></span>[<span class='identifier'><a name='193_33' href='Siteify.html#188_20' title='usrString1'>ptr</a></span>] == <span class='identifier'><a name='193_41' href='Siteify.html#187_20' title='usrString1'>newline</a></span> {
0194                                <span class='identifier'><a name='194_28' href='Siteify.html#188_29' title='usrString1'>lineno</a></span> += <span class='number'><a name='194_38'>1</a></span>
0195                                <span class='identifier'><a name='195_28' href='Siteify.html#188_41' title='usrString1'>col</a></span> = <span class='number'><a name='195_34'>1</a></span>
0196                            }
0197                            <span class='keyword'><a name='197_24'>else</a></span> {
0198                                <span class='identifier'><a name='198_28' href='Siteify.html#188_41' title='usrString1'>col</a></span> += <span class='number'><a name='198_35'>1</a></span>
0199                            }
0200                            <span class='identifier'><a name='200_24' href='Siteify.html#188_20' title='usrString1'>ptr</a></span> += <span class='number'><a name='200_31'>1</a></span>
0201                        }
0202                        <span class='keyword'><a name='202_20'>return</a></span> <span class='identifier'><a name='202_27' href='Siteify.html#191_24' title='usrString1'>out</a></span>
0203                            .<span class='identifier'><a name='203_25'>replacingOccurrences</a></span>(<span class='identifier'><a name='203_46'>of</a></span>: <span class='string'><a name='203_50'>"&amp;"</a></span>, <span class='identifier'><a name='203_55'>with</a></span>: <span class='string'><a name='203_61'>"&amp;amp;"</a></span>)
0204                            .<span class='identifier'><a name='204_25'>replacingOccurrences</a></span>(<span class='identifier'><a name='204_46'>of</a></span>: <span class='string'><a name='204_50'>"&lt;"</a></span>, <span class='identifier'><a name='204_55'>with</a></span>: <span class='string'><a name='204_61'>"&amp;lt;"</a></span>) <span class='keyword'><a name='204_69'>as</a></span> <span class='typeidentifier'><a name='204_72'>String</a></span>
0205                    }
0206    
0207                    <span class='keyword'><a name='207_16'>var</a></span> <span class='identifier'><a name='207_20' title='usrString3'>fileLineCache</a></span> = [<span class='identifier'><a name='207_37'>String</a></span>: [<span class='identifier'><a name='207_46'>String</a></span>]]()
0208                    <span class='keyword'><a name='208_16'>func</a></span> <span class='identifier'><a name='208_21' title='usrString3'>reflines</a></span>(<span class='identifier'><a name='208_30' href='#' title='usrString2' onclick='return expand(this);'>file<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#209_37"; return false;'>Siteify.swift:209</td><td><pre>                    if fileLineCache[file] == nil {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#210_38"; return false;'>Siteify.swift:210</td><td><pre>                        fileLineCache[file] =</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#211_57"; return false;'>Siteify.swift:211</td><td><pre>                            (try? String(contentsOfFile: file))?</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#214_49"; return false;'>Siteify.swift:214</td><td><pre>                    if let lines = fileLineCache[file], line &lt; lines.count {</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='208_36'>String</a></span>, <span class='identifier'><a name='208_44' href='#' title='usrString2' onclick='return expand(this);'>line<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#214_56"; return false;'>Siteify.swift:214</td><td><pre>                    if let lines = fileLineCache[file], line &lt; lines.count {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#215_37"; return false;'>Siteify.swift:215</td><td><pre>                        return lines[line]</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='208_50'>Int</a></span>) -> <span class='typeidentifier'><a name='208_58'>String</a></span> {
0209                        <span class='keyword'><a name='209_20'>if</a></span> <span class='identifier'><a name='209_23' href='Siteify.html#207_20' title='usrString1'>fileLineCache</a></span>[<span class='identifier'><a name='209_37' href='Siteify.html#208_30' title='usrString1'>file</a></span>] == <span class='keyword'><a name='209_46'>nil</a></span> {
0210                            <span class='identifier'><a name='210_24' href='Siteify.html#207_20' title='usrString1'>fileLineCache</a></span>[<span class='identifier'><a name='210_38' href='Siteify.html#208_30' title='usrString1'>file</a></span>] =
0211                                (<span class='keyword'><a name='211_29'>try</a></span>? <span class='identifier'><a name='211_34'>String</a></span>(<span class='identifier'><a name='211_41'>contentsOfFile</a></span>: <span class='identifier'><a name='211_57' href='Siteify.html#208_30' title='usrString1'>file</a></span>))?
0212                                .<span class='identifier'><a name='212_29'>components</a></span>(<span class='identifier'><a name='212_40'>separatedBy</a></span>: <span class='string'><a name='212_53'>"\n"</a></span>)
0213                        }
0214                        <span class='keyword'><a name='214_20'>if</a></span> <span class='keyword'><a name='214_23'>let</a></span> <span class='identifier'><a name='214_27' title='usrString3'>lines</a></span> = <span class='identifier'><a name='214_35' href='Siteify.html#207_20' title='usrString1'>fileLineCache</a></span>[<span class='identifier'><a name='214_49' href='Siteify.html#208_30' title='usrString1'>file</a></span>], <span class='identifier'><a name='214_56' href='Siteify.html#208_44' title='usrString1'>line</a></span> &lt; <span class='identifier'><a name='214_63' href='Siteify.html#214_27' title='usrString1'>lines</a></span>.<span class='identifier'><a name='214_69'>count</a></span> {
0215                            <span class='keyword'><a name='215_24'>return</a></span> <span class='identifier'><a name='215_31' href='Siteify.html#214_27' title='usrString1'>lines</a></span>[<span class='identifier'><a name='215_37' href='Siteify.html#208_44' title='usrString1'>line</a></span>]
0216                                .<span class='identifier'><a name='216_29'>replacingOccurrences</a></span>(<span class='identifier'><a name='216_50'>of</a></span>: <span class='string'><a name='216_54'>"&amp;"</a></span>, <span class='identifier'><a name='216_59'>with</a></span>: <span class='string'><a name='216_65'>"&amp;amp;"</a></span>)
0217                                .<span class='identifier'><a name='217_29'>replacingOccurrences</a></span>(<span class='identifier'><a name='217_50'>of</a></span>: <span class='string'><a name='217_54'>"&lt;"</a></span>, <span class='identifier'><a name='217_59'>with</a></span>: <span class='string'><a name='217_65'>"&amp;lt;"</a></span>)
0218                        }
0219                        <span class='keyword'><a name='219_20'>return</a></span> <span class='string'><a name='219_27'>""</a></span>
0220                    }
0221    
0222                    <span class='keyword'><a name='222_16'>let</a></span> <span class='identifier'><a name='222_20' title='usrString3'>resp</a></span> = <span class='keyword'><a name='222_27'>self</a></span>.<span class='identifier'><a name='222_32' href='Siteify.html#88_8' title='usrString1'>sourceKit</a></span>.<span class='identifier'><a name='222_42' href='SourceKit.html#291_9' title='usrString1'>syntaxMap</a></span>(<span class='identifier'><a name='222_52'>filePath</a></span>: <span class='identifier'><a name='222_62' href='Siteify.html#158_28' title='usrString1'>path</a></span>)
0223                    <span class='keyword'><a name='223_16'>let</a></span> <span class='identifier'><a name='223_20' title='usrString3'>dict</a></span> = <span class='identifier'><a name='223_27' href='SourceKit.html#168_4' title='usrString1'>SKApi</a></span>.<span class='identifier'><a name='223_33' href='SourceKit.html#131_17' title='usrString1'>sourcekitd_response_get_value</a></span>(<span class='identifier'><a name='223_63' href='Siteify.html#222_20' title='usrString1'>resp</a></span>)
0224                    <span class='identifier'><a name='224_16' href='Siteify.html#88_8' title='usrString1'>sourceKit</a></span>.<span class='identifier'><a name='224_26' href='SourceKit.html#314_9' title='usrString1'>recurseOver</a></span>(<span class='identifier'><a name='224_38'>childID</a></span>: <span class='keyword'><a name='224_47'>self</a></span>.<span class='identifier'><a name='224_52' href='Siteify.html#88_8' title='usrString1'>sourceKit</a></span>.<span class='identifier'><a name='224_62' href='SourceKit.html#192_13' title='usrString1'>syntaxID</a></span>, <span class='identifier'><a name='224_72'>resp</a></span>: <span class='identifier'><a name='224_78' href='Siteify.html#223_20' title='usrString1'>dict</a></span>) { <span class='identifier'><a name='224_86' title='usrString3'>dict</a></span> <span class='keyword'><a name='224_91'>in</a></span>
0225                        <span class='keyword'><a name='225_20'>let</a></span> <span class='identifier'><a name='225_24' title='usrString3'>offset</a></span> = <span class='identifier'><a name='225_33' href='Siteify.html#224_86' title='usrString1'>dict</a></span>.<span class='identifier'><a name='225_38' href='SourceKit.html#28_9' title='usrString1'>getInt</a></span>(<span class='identifier'><a name='225_45' href='SourceKit.html#28_9' title='usrString1'>key</a></span>: <span class='keyword'><a name='225_50'>self</a></span>.<span class='identifier'><a name='225_55' href='Siteify.html#88_8' title='usrString1'>sourceKit</a></span>.<span class='identifier'><a name='225_65' href='SourceKit.html#184_13' title='usrString1'>offsetID</a></span>)
0226                        <span class='keyword'><a name='226_20'>let</a></span> <span class='identifier'><a name='226_24' title='usrString3'>length</a></span> = <span class='identifier'><a name='226_33' href='Siteify.html#224_86' title='usrString1'>dict</a></span>.<span class='identifier'><a name='226_38' href='SourceKit.html#28_9' title='usrString1'>getInt</a></span>(<span class='identifier'><a name='226_45' href='SourceKit.html#28_9' title='usrString1'>key</a></span>: <span class='keyword'><a name='226_50'>self</a></span>.<span class='identifier'><a name='226_55' href='Siteify.html#88_8' title='usrString1'>sourceKit</a></span>.<span class='identifier'><a name='226_65' href='SourceKit.html#200_13' title='usrString1'>lengthID</a></span>)
0227                        <span class='keyword'><a name='227_20'>let</a></span> <span class='identifier'><a name='227_24' title='usrString3'>pos</a></span> = <span class='identifier'><a name='227_30' href='Siteify.html#177_21' title='usrString1'>position</a></span>(<span class='identifier'><a name='227_39' href='Siteify.html#177_21' title='usrString1'>for</a></span>: <span class='identifier'><a name='227_44' href='Siteify.html#225_24' title='usrString1'>offset</a></span>)
0228    <span class='comment'><a name='228_0'>//                    print(offset, pos)
0229    </a></span>
0230                        <span class='identifier'><a name='230_20' href='Siteify.html#163_12' title='usrString1'>html</a></span> += <span class='identifier'><a name='230_28' href='Siteify.html#190_21' title='usrString1'>skipTo</a></span>(<span class='identifier'><a name='230_35' href='Siteify.html#190_21' title='usrString1'>offset</a></span>: <span class='identifier'><a name='230_43' href='Siteify.html#225_24' title='usrString1'>offset</a></span>)
0231                        <span class='keyword'><a name='231_20'>let</a></span> <span class='identifier'><a name='231_24' title='usrString3'>text</a></span> = <span class='identifier'><a name='231_31' href='Siteify.html#190_21' title='usrString1'>skipTo</a></span>(<span class='identifier'><a name='231_38' href='Siteify.html#190_21' title='usrString1'>offset</a></span>: <span class='identifier'><a name='231_46' href='Siteify.html#225_24' title='usrString1'>offset</a></span>+<span class='identifier'><a name='231_53' href='Siteify.html#226_24' title='usrString1'>length</a></span>)
0232                        <span class='keyword'><a name='232_20'>let</a></span> <span class='identifier'><a name='232_24' title='usrString3'>kind</a></span> = <span class='identifier'><a name='232_31' href='Siteify.html#224_86' title='usrString1'>dict</a></span>.<span class='identifier'><a name='232_36' href='SourceKit.html#37_9' title='usrString1'>getUUIDString</a></span>(<span class='identifier'><a name='232_50' href='SourceKit.html#37_9' title='usrString1'>key</a></span>: <span class='keyword'><a name='232_55'>self</a></span>.<span class='identifier'><a name='232_60' href='Siteify.html#88_8' title='usrString1'>sourceKit</a></span>.<span class='identifier'><a name='232_70' href='SourceKit.html#201_13' title='usrString1'>kindID</a></span>)
0233                        <span class='keyword'><a name='233_20'>let</a></span> <span class='identifier'><a name='233_24' title='usrString3'>kindSuffix</a></span> = <span class='identifier'><a name='233_37'>NSURL</a></span>(<span class='identifier'><a name='233_43'>fileURLWithPath</a></span>: <span class='identifier'><a name='233_60' href='Siteify.html#232_24' title='usrString1'>kind</a></span>).<span class='identifier'><a name='233_66'>pathExtension</a></span>!
0234                        <span class='keyword'><a name='234_20'>var</a></span> <span class='identifier'><a name='234_24' title='usrString3'>span</a></span> = <span class='string'><a name='234_31'>"&lt;a name='</a></span>\<span class='string_interpolation_anchor'><a name='234_42'>(</a></span><span class='identifier'><a name='234_43' href='Siteify.html#227_24' title='usrString1'>pos</a></span>.<span class='identifier'><a name='234_47'>anchor</a></span><span class='string_interpolation_anchor'><a name='234_53'>)</a></span><span class='string'><a name='234_54'>'></a></span>\<span class='string_interpolation_anchor'><a name='234_57'>(</a></span><span class='identifier'><a name='234_58' href='Siteify.html#231_24' title='usrString1'>text</a></span><span class='string_interpolation_anchor'><a name='234_62'>)</a></span><span class='string'><a name='234_63'>&lt;/a>"</a></span>
0235                        <span class='keyword'><a name='235_20'>if</a></span> <span class='identifier'><a name='235_23' href='Siteify.html#233_24' title='usrString1'>kindSuffix</a></span> == <span class='string'><a name='235_37'>"url"</a></span> {
0236                            <span class='identifier'><a name='236_24' href='Siteify.html#234_24' title='usrString1'>span</a></span> = <span class='string'><a name='236_31'>"&lt;a href='</a></span>\<span class='string_interpolation_anchor'><a name='236_42'>(</a></span><span class='identifier'><a name='236_43' href='Siteify.html#231_24' title='usrString1'>text</a></span><span class='string_interpolation_anchor'><a name='236_47'>)</a></span><span class='string'><a name='236_48'>'></a></span>\<span class='string_interpolation_anchor'><a name='236_51'>(</a></span><span class='identifier'><a name='236_52' href='Siteify.html#231_24' title='usrString1'>text</a></span><span class='string_interpolation_anchor'><a name='236_56'>)</a></span><span class='string'><a name='236_57'>&lt;/a>"</a></span>
0237                        }
0238                        <span class='keyword'><a name='238_20'>if</a></span> <span class='identifier'><a name='238_23' href='SourceKit.html#168_4' title='usrString1'>SKApi</a></span>.<span class='identifier'><a name='238_29' href='SourceKit.html#137_17' title='usrString1'>sourcekitd_variant_dictionary_get_uid</a></span>(<span class='identifier'><a name='238_67' href='Siteify.html#224_86' title='usrString1'>dict</a></span>, <span class='keyword'><a name='238_73'>self</a></span>.<span class='identifier'><a name='238_78' href='Siteify.html#88_8' title='usrString1'>sourceKit</a></span>.<span class='identifier'><a name='238_88' href='SourceKit.html#201_13' title='usrString1'>kindID</a></span>) == <span class='keyword'><a name='238_99'>self</a></span>.<span class='identifier'><a name='238_104' href='Siteify.html#88_8' title='usrString1'>sourceKit</a></span>.<span class='identifier'><a name='238_114' href='SourceKit.html#193_13' title='usrString1'>identifierID</a></span> {
0239                            <span class='keyword'><a name='239_24'>var</a></span> <span class='identifier'><a name='239_28' title='usrString3'>def</a></span>: <span class='typeidentifier'><a name='239_33'>Location</a></span>?
0240                            <span class='keyword'><a name='240_24'>let</a></span> <span class='identifier'><a name='240_28' title='usrString3'>res</a></span> = <span class='identifier'><a name='240_34' href='Siteify.html#159_12' title='usrString1'>synchronizer</a></span>.<span class='identifier'><a name='240_47'>sync</a></span> {
0241                                <span class='keyword'><a name='241_28'>self</a></span>.<span class='identifier'><a name='241_33'>lspServer</a></span>!.<span class='identifier'><a name='241_44'>definition</a></span>(<span class='identifier'><a name='241_55'>params</a></span>: <span class='identifier'><a name='241_63'>TextDocumentPositionParams</a></span>(<span class='identifier'><a name='241_90'>textDocument</a></span>: <span class='identifier'><a name='241_104'>TextDocumentIdentifier</a></span>(<span class='identifier'><a name='241_127'>path</a></span>: <span class='identifier'><a name='241_133' href='Siteify.html#158_28' title='usrString1'>path</a></span>), <span class='identifier'><a name='241_140'>position</a></span>: <span class='identifier'><a name='241_150' href='Siteify.html#227_24' title='usrString1'>pos</a></span>), <span class='identifier'><a name='241_156'>block</a></span>: <span class='identifier'><a name='241_163' href='Siteify.html#240_52' title='usrString1'>$0</a></span>)
0242                            }
0243                            <span class='keyword'><a name='243_24'>switch</a></span> <span class='identifier'><a name='243_31' href='Siteify.html#240_28' title='usrString1'>res</a></span> {
0244                            <span class='keyword'><a name='244_24'>case</a></span> .<span class='identifier'><a name='244_30'>locationArray</a></span>(<span class='keyword'><a name='244_44'>let</a></span> <span class='identifier'><a name='244_48' title='usrString3'>a</a></span>) <span class='keyword'><a name='244_51'>where</a></span> <span class='identifier'><a name='244_57' href='Siteify.html#244_48' title='usrString1'>a</a></span>.<span class='identifier'><a name='244_59'>count</a></span> > <span class='number'><a name='244_67'>0</a></span>:
0245                                <span class='identifier'><a name='245_28' href='Siteify.html#239_28' title='usrString1'>def</a></span> = <span class='identifier'><a name='245_34' href='Siteify.html#244_48' title='usrString1'>a</a></span>.<span class='identifier'><a name='245_36'>first</a></span>
0246    <span class='comment'><a name='246_0'>//                            print(res as Any)
0247    </a></span>                        <span class='keyword'><a name='247_24'>default</a></span>:
0248                                <span class='keyword'><a name='248_28'>break</a></span>
0249                            }
0250    
0251                            <span class='keyword'><a name='251_24'>if</a></span> <span class='keyword'><a name='251_27'>let</a></span> <span class='identifier'><a name='251_31' title='usrString3'>decl</a></span> = <span class='identifier'><a name='251_38' href='Siteify.html#239_28' title='usrString1'>def</a></span> {
0252                                <span class='keyword'><a name='252_28'>if</a></span> <span class='identifier'><a name='252_31' href='Siteify.html#251_31' title='usrString1'>decl</a></span>.<span class='identifier'><a name='252_36'>file</a></span> == <span class='identifier'><a name='252_44' href='Siteify.html#158_28' title='usrString1'>path</a></span> &amp;&amp; <span class='identifier'><a name='252_52' href='Siteify.html#251_31' title='usrString1'>decl</a></span>.<span class='identifier'><a name='252_57'>range</a></span>.<span class='identifier'><a name='252_63'>start</a></span> == <span class='identifier'><a name='252_72' href='Siteify.html#227_24' title='usrString1'>pos</a></span>,
0253                                    <span class='keyword'><a name='253_32'>let</a></span> <span class='identifier'><a name='253_36' title='usrString3'>refs</a></span> = <span class='identifier'><a name='253_43' href='Siteify.html#159_12' title='usrString1'>synchronizer</a></span>.<span class='identifier'><a name='253_56'>sync</a></span>({
0254                                        <span class='keyword'><a name='254_36'>self</a></span>.<span class='identifier'><a name='254_41'>lspServer</a></span>!.<span class='identifier'><a name='254_52'>references</a></span>(<span class='identifier'><a name='254_63'>params</a></span>: <span class='identifier'><a name='254_71'>ReferenceParams</a></span>(<span class='identifier'><a name='254_87'>textDocument</a></span>: <span class='identifier'><a name='254_101'>TextDocumentIdentifier</a></span>(<span class='identifier'><a name='254_124'>path</a></span>: <span class='identifier'><a name='254_130' href='Siteify.html#158_28' title='usrString1'>path</a></span>), <span class='identifier'><a name='254_137'>position</a></span>: <span class='identifier'><a name='254_147' href='Siteify.html#227_24' title='usrString1'>pos</a></span>, <span class='identifier'><a name='254_152'>context</a></span>: <span class='identifier'><a name='254_161'>ReferenceContext</a></span>(<span class='identifier'><a name='254_178'>includeDeclaration</a></span>: <span class='keyword'><a name='254_198'>false</a></span>)), <span class='identifier'><a name='254_207'>block</a></span>: <span class='identifier'><a name='254_214' href='Siteify.html#253_61' title='usrString1'>$0</a></span>)})?
0255                                        .<span class='identifier'><a name='255_37'>sorted</a></span>(<span class='identifier'><a name='255_44'>by</a></span>: { <span class='identifier'><a name='255_50' href='Siteify.html#255_48' title='usrString1'>$0</a></span>.<span class='identifier'><a name='255_53'>uri</a></span> &lt; <span class='identifier'><a name='255_59' href='Siteify.html#255_48' title='usrString1'>$1</a></span>.<span class='identifier'><a name='255_62'>uri</a></span> }) {
0256    
0257                                    <span class='keyword'><a name='257_32'>if</a></span> <span class='identifier'><a name='257_35' href='Siteify.html#253_36' title='usrString1'>refs</a></span>.<span class='identifier'><a name='257_40'>count</a></span> > <span class='number'><a name='257_48'>0</a></span> &amp;&amp; <span class='identifier'><a name='257_53' href='Siteify.html#251_31' title='usrString1'>decl</a></span>.<span class='identifier'><a name='257_58'>file</a></span>.<span class='identifier'><a name='257_63'>starts</a></span>(<span class='identifier'><a name='257_70'>with</a></span>: <span class='keyword'><a name='257_76'>self</a></span>.<span class='identifier'><a name='257_81'>projectRoot</a></span>) {
0258                                        <span class='keyword'><a name='258_36'>var</a></span> <span class='identifier'><a name='258_40' title='usrString3'>popup</a></span> = <span class='string'><a name='258_48'>""</a></span>
0259                                        <span class='keyword'><a name='259_36'>for</a></span> <span class='identifier'><a name='259_40' title='usrString3'>ref</a></span> <span class='keyword'><a name='259_44'>in</a></span> <span class='identifier'><a name='259_47' href='Siteify.html#253_36' title='usrString1'>refs</a></span> {
0260                                            <span class='keyword'><a name='260_40'>let</a></span> <span class='identifier'><a name='260_44' title='usrString3'>keepListOpen</a></span> = <span class='identifier'><a name='260_59' href='Siteify.html#259_40' title='usrString1'>ref</a></span>.<span class='identifier'><a name='260_63'>file</a></span> != <span class='identifier'><a name='260_71' href='Siteify.html#251_31' title='usrString1'>decl</a></span>.<span class='identifier'><a name='260_76'>file</a></span> ? <span class='string'><a name='260_83'>"event.stopPropagation(); "</a></span> : <span class='string'><a name='260_113'>""</a></span>
0261                                            <span class='keyword'><a name='261_40'>if</a></span> <span class='identifier'><a name='261_43' href='Siteify.html#259_40' title='usrString1'>ref</a></span>.<span class='identifier'><a name='261_47'>href</a></span> == <span class='identifier'><a name='261_55' href='Siteify.html#251_31' title='usrString1'>decl</a></span>.<span class='identifier'><a name='261_60'>href</a></span> {
0262                                                <span class='keyword'><a name='262_44'>continue</a></span>
0263                                            }
0264                                            <span class='identifier'><a name='264_40' href='Siteify.html#258_40' title='usrString1'>popup</a></span> += <span class='string'><a name='264_49'>"&lt;tr>&lt;td style='text-decoration: underline;' onclick='document.location.href=\"</a></span>\<span class='string_interpolation_anchor'><a name='264_129'>(</a></span><span class='identifier'><a name='264_130' href='Siteify.html#259_40' title='usrString1'>ref</a></span>.<span class='identifier'><a name='264_134'>href</a></span><span class='string_interpolation_anchor'><a name='264_138'>)</a></span><span class='string'><a name='264_139'>\"; </a></span>\<span class='string_interpolation_anchor'><a name='264_144'>(</a></span><span class='identifier'><a name='264_145' href='Siteify.html#260_44' title='usrString1'>keepListOpen</a></span><span class='string_interpolation_anchor'><a name='264_157'>)</a></span><span class='string'><a name='264_158'>return false;'></a></span>\<span class='string_interpolation_anchor'><a name='264_174'>(</a></span><span class='identifier'><a name='264_175' href='Siteify.html#259_40' title='usrString1'>ref</a></span>.<span class='identifier'><a name='264_179'>filename</a></span><span class='string_interpolation_anchor'><a name='264_187'>)</a></span><span class='string'><a name='264_188'>.swift:</a></span>\<span class='string_interpolation_anchor'><a name='264_196'>(</a></span><span class='identifier'><a name='264_197' href='Siteify.html#259_40' title='usrString1'>ref</a></span>.<span class='identifier'><a name='264_201'>line</a></span>+<span class='number'><a name='264_206'>1</a></span><span class='string_interpolation_anchor'><a name='264_207'>)</a></span><span class='string'><a name='264_208'>&lt;/td>"</a></span>
0265                                            <span class='identifier'><a name='265_40' href='Siteify.html#258_40' title='usrString1'>popup</a></span> += <span class='string'><a name='265_49'>"&lt;td>&lt;pre></a></span>\<span class='string_interpolation_anchor'><a name='265_60'>(</a></span><span class='identifier'><a name='265_61'>reflines</a></span>(<span class='identifier'><a name='265_70'>file</a></span>: <span class='identifier'><a name='265_76' href='Siteify.html#259_40' title='usrString1'>ref</a></span>.<span class='identifier'><a name='265_80'>file</a></span>, <span class='identifier'><a name='265_86'>line</a></span>: <span class='identifier'><a name='265_92' href='Siteify.html#259_40' title='usrString1'>ref</a></span>.<span class='identifier'><a name='265_96'>line</a></span>)<span class='string_interpolation_anchor'><a name='265_101'>)</a></span><span class='string'><a name='265_102'>&lt;/pre>&lt;/td>"</a></span>
0266                                        }
0267                                        <span class='identifier'><a name='267_36' href='Siteify.html#234_24' title='usrString1'>span</a></span> = <span class='string'><a name='267_43'>"&lt;a name='</a></span>\<span class='string_interpolation_anchor'><a name='267_54'>(</a></span><span class='identifier'><a name='267_55' href='Siteify.html#251_31' title='usrString1'>decl</a></span>.<span class='identifier'><a name='267_60'>anchor</a></span><span class='string_interpolation_anchor'><a name='267_66'>)</a></span><span class='string'><a name='267_67'>' </a></span>\<span class='string_interpolation_anchor'><a name='267_70'>(</a></span><span class='identifier'><a name='267_71' href='Siteify.html#258_40' title='usrString1'>popup</a></span> != <span class='string'><a name='267_80'>""</a></span> ? <span class='string'><a name='267_85'>"href='#' "</a></span> : <span class='string'><a name='267_99'>""</a></span><span class='string_interpolation_anchor'><a name='267_101'>)</a></span><span class='string'><a name='267_102'>title='</a></span>\<span class='string_interpolation_anchor'><a name='267_110'>(</a></span><span class='string'><a name='267_111'>"usrString2"</a></span><span class='string_interpolation_anchor'><a name='267_123'>)</a></span><span class='string'><a name='267_124'>' onclick='return expand(this);'>"</a></span> +
0268                                                <span class='string'><a name='268_44'>"</a></span>\<span class='string_interpolation_anchor'><a name='268_46'>(</a></span><span class='identifier'><a name='268_47' href='Siteify.html#231_24' title='usrString1'>text</a></span><span class='string_interpolation_anchor'><a name='268_51'>)</a></span><span class='string'><a name='268_52'>&lt;span class='references'>&lt;table></a></span>\<span class='string_interpolation_anchor'><a name='268_85'>(</a></span><span class='identifier'><a name='268_86' href='Siteify.html#258_40' title='usrString1'>popup</a></span><span class='string_interpolation_anchor'><a name='268_91'>)</a></span><span class='string'><a name='268_92'>&lt;/table>&lt;/span>&lt;/a>"</a></span>
0269                                    }
0270                                    <span class='keyword'><a name='270_32'>else</a></span> {
0271                                        <span class='identifier'><a name='271_36' href='Siteify.html#234_24' title='usrString1'>span</a></span> = <span class='string'><a name='271_43'>"&lt;a name='</a></span>\<span class='string_interpolation_anchor'><a name='271_54'>(</a></span><span class='identifier'><a name='271_55' href='Siteify.html#251_31' title='usrString1'>decl</a></span>.<span class='identifier'><a name='271_60'>anchor</a></span><span class='string_interpolation_anchor'><a name='271_66'>)</a></span><span class='string'><a name='271_67'>' title='</a></span>\<span class='string_interpolation_anchor'><a name='271_77'>(</a></span><span class='string'><a name='271_78'>"usrString3"</a></span><span class='string_interpolation_anchor'><a name='271_90'>)</a></span><span class='string'><a name='271_91'>'></a></span>\<span class='string_interpolation_anchor'><a name='271_94'>(</a></span><span class='identifier'><a name='271_95' href='Siteify.html#231_24' title='usrString1'>text</a></span><span class='string_interpolation_anchor'><a name='271_99'>)</a></span><span class='string'><a name='271_100'>&lt;/a>"</a></span>
0272                                    }
0273                                }
0274                                <span class='keyword'><a name='274_28'>else</a></span> <span class='keyword'><a name='274_33'>if</a></span> <span class='identifier'><a name='274_36' href='Siteify.html#251_31' title='usrString1'>decl</a></span>.<span class='identifier'><a name='274_41'>file</a></span>.<span class='identifier'><a name='274_46'>starts</a></span>(<span class='identifier'><a name='274_53'>with</a></span>: <span class='keyword'><a name='274_59'>self</a></span>.<span class='identifier'><a name='274_64'>projectRoot</a></span>) {
0275                                    <span class='identifier'><a name='275_32' href='Siteify.html#234_24' title='usrString1'>span</a></span> = <span class='string'><a name='275_39'>"&lt;a name='</a></span>\<span class='string_interpolation_anchor'><a name='275_50'>(</a></span><span class='identifier'><a name='275_51' href='Siteify.html#227_24' title='usrString1'>pos</a></span>.<span class='identifier'><a name='275_55'>anchor</a></span><span class='string_interpolation_anchor'><a name='275_61'>)</a></span><span class='string'><a name='275_62'>' href='</a></span>\<span class='string_interpolation_anchor'><a name='275_71'>(</a></span><span class='identifier'><a name='275_72' href='Siteify.html#251_31' title='usrString1'>decl</a></span>.<span class='identifier'><a name='275_77'>href</a></span><span class='string_interpolation_anchor'><a name='275_81'>)</a></span><span class='string'><a name='275_82'>' title='</a></span>\<span class='string_interpolation_anchor'><a name='275_92'>(</a></span><span class='string'><a name='275_93'>"usrString1"</a></span><span class='string_interpolation_anchor'><a name='275_105'>)</a></span><span class='string'><a name='275_106'>'></a></span>\<span class='string_interpolation_anchor'><a name='275_109'>(</a></span><span class='identifier'><a name='275_110' href='Siteify.html#231_24' title='usrString1'>text</a></span><span class='string_interpolation_anchor'><a name='275_114'>)</a></span><span class='string'><a name='275_115'>&lt;/a>"</a></span>
0276                                }
0277                            }
0278                        }
0279    
0280                        <span class='identifier'><a name='280_20' href='Siteify.html#163_12' title='usrString1'>html</a></span> += <span class='string'><a name='280_28'>"&lt;span class='</a></span>\<span class='string_interpolation_anchor'><a name='280_43'>(</a></span><span class='identifier'><a name='280_44' href='Siteify.html#233_24' title='usrString1'>kindSuffix</a></span><span class='string_interpolation_anchor'><a name='280_54'>)</a></span><span class='string'><a name='280_55'>'></a></span>\<span class='string_interpolation_anchor'><a name='280_58'>(</a></span><span class='identifier'><a name='280_59' href='Siteify.html#234_24' title='usrString1'>span</a></span><span class='string_interpolation_anchor'><a name='280_63'>)</a></span><span class='string'><a name='280_64'>&lt;/span>"</a></span>
0281                    }
0282    
0283                    <span class='identifier'><a name='283_16' href='Siteify.html#163_12' title='usrString1'>html</a></span> += <span class='identifier'><a name='283_24' href='Siteify.html#190_21' title='usrString1'>skipTo</a></span>(<span class='identifier'><a name='283_31' href='Siteify.html#190_21' title='usrString1'>offset</a></span>: <span class='identifier'><a name='283_39' href='Siteify.html#165_15' title='usrString1'>data</a></span>.<span class='identifier'><a name='283_44'>count</a></span>)
0284                }
0285    
0286                <span class='keyword'><a name='286_12'>var</a></span> <span class='identifier'><a name='286_16' title='usrString3'>htmp</a></span> = <span class='identifier'><a name='286_23' href='Siteify.html#163_12' title='usrString1'>html</a></span>
0287                <span class='keyword'><a name='287_12'>var</a></span> <span class='identifier'><a name='287_16' title='usrString3'>line</a></span> = <span class='number'><a name='287_23'>0</a></span>
0288    
0289                <span class='identifier'><a name='289_12' href='Siteify.html#286_16' title='usrString1'>htmp</a></span>[<span class='string'><a name='289_17'>"(^|\n)"</a></span>] = { (<span class='identifier'><a name='289_32' title='usrString3'>groups</a></span>: [<span class='typeidentifier'><a name='289_41'>String</a></span>], <span class='identifier'><a name='289_50' title='usrString3'>stop</a></span>) -> <span class='typeidentifier'><a name='289_59'>String</a></span> <span class='keyword'><a name='289_66'>in</a></span>
0290                    <span class='identifier'><a name='290_16' href='Siteify.html#287_16' title='usrString1'>line</a></span> += <span class='number'><a name='290_24'>1</a></span>
0291                    <span class='keyword'><a name='291_16'>return</a></span> <span class='identifier'><a name='291_23' href='Siteify.html#289_32' title='usrString1'>groups</a></span>[<span class='number'><a name='291_30'>1</a></span>] + <span class='identifier'><a name='291_35'>String</a></span>(<span class='identifier'><a name='291_42'>format</a></span>: <span class='string'><a name='291_50'>"%04d    "</a></span>, <span class='identifier'><a name='291_62' href='Siteify.html#287_16' title='usrString1'>line</a></span>)
0292                }
0293    
0294                <span class='keyword'><a name='294_12'>let</a></span> <span class='identifier'><a name='294_16' title='usrString3'>out</a></span> = <span class='identifier'><a name='294_22' href='Siteify.html#304_9' title='usrString1'>copyTemplate</a></span>(<span class='identifier'><a name='294_35' href='Siteify.html#304_9' title='usrString1'>template</a></span>: <span class='string'><a name='294_45'>"source.html"</a></span>, <span class='identifier'><a name='294_60' href='Siteify.html#304_9' title='usrString1'>patches</a></span>: [:], <span class='identifier'><a name='294_74' href='Siteify.html#304_9' title='usrString1'>dest</a></span>: <span class='string'><a name='294_80'>"html/"</a></span>+<span class='identifier'><a name='294_88' href='Siteify.html#160_12' title='usrString1'>htmlfile</a></span>)
0295                <span class='identifier'><a name='295_12' href='Siteify.html#286_16' title='usrString1'>htmp</a></span>.<span class='identifier'><a name='295_17'>withCString</a></span> { <span class='keyword'><a name='295_31'>_</a></span> = <span class='identifier'><a name='295_35'>fputs</a></span>(<span class='identifier'><a name='295_41' href='Siteify.html#295_29' title='usrString1'>$0</a></span>, <span class='identifier'><a name='295_45' href='Siteify.html#294_16' title='usrString1'>out</a></span>) }
0296                <span class='identifier'><a name='296_12'>fclose</a></span>(<span class='identifier'><a name='296_19' href='Siteify.html#294_16' title='usrString1'>out</a></span>)
0297            }
0298            <span class='identifier'><a name='298_8' href='Siteify.html#44_5' title='usrString1'>progress</a></span>(<span class='identifier'><a name='298_17' href='Siteify.html#44_5' title='usrString1'>str</a></span>: <span class='string'><a name='298_22'>"Saved html/</a></span>\<span class='string_interpolation_anchor'><a name='298_35'>(</a></span><span class='identifier'><a name='298_36' href='Siteify.html#160_12' title='usrString1'>htmlfile</a></span><span class='string_interpolation_anchor'><a name='298_44'>)</a></span><span class='string'><a name='298_45'>"</a></span>)
0299        }
0300    
0301        <span class='keyword'><a name='301_4'>let</a></span> <span class='identifier'><a name='301_8' href='#' title='usrString2' onclick='return expand(this);'>home<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#138_61"; return false;'>Siteify.swift:138</td><td><pre>            "__ROOT__": projectRoot.replacingOccurrences(of: home, with: "~")])</pre></td></table></span></a></span> = <span class='identifier'><a name='301_15'>String</a></span>(<span class='identifier'><a name='301_22'>cString</a></span>: <span class='identifier'><a name='301_31'>getenv</a></span>(<span class='string'><a name='301_38'>"HOME"</a></span>))
0302        <span class='keyword'><a name='302_4'>let</a></span> <span class='identifier'><a name='302_8' title='usrString2' onclick='return expand(this);'>resources<span class='references'><table></table></span></a></span> = <span class='identifier'><a name='302_20'>String</a></span>(<span class='identifier'><a name='302_27'>cString</a></span>: <span class='identifier'><a name='302_36'>getenv</a></span>(<span class='string'><a name='302_43'>"HOME"</a></span>))+<span class='string'><a name='302_52'>"/Library/siteify/"</a></span>
0303    
0304        <span class='keyword'><a name='304_4'>func</a></span> <span class='identifier'><a name='304_9' href='#' title='usrString2' onclick='return expand(this);'>copyTemplate<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#135_15"; return false;'>Siteify.swift:135</td><td><pre>        fclose(copyTemplate(template: "siteify.css"))</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#136_16"; return false;'>Siteify.swift:136</td><td><pre>        index = copyTemplate(template: "index.html", patches: [</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#294_22"; return false;'>Siteify.swift:294</td><td><pre>            let out = copyTemplate(template: "source.html", patches: [:], dest: "html/"+htmlfile)</pre></td></table></span></a></span>(<span class='identifier'><a name='304_22' href='#' title='usrString2' onclick='return expand(this);'>template<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#305_35"; return false;'>Siteify.swift:305</td><td><pre>        var input = Self.resources[template]!</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#309_40"; return false;'>Siteify.swift:309</td><td><pre>        let out = fopen(dest ?? "html/"+template, "w")!</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='304_32'>String</a></span>, <span class='identifier'><a name='304_40' href='#' title='usrString2' onclick='return expand(this);'>patches<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#306_28"; return false;'>Siteify.swift:306</td><td><pre>        for (tag, value) in patches {</pre></td></table></span></a></span>: [<span class='typeidentifier'><a name='304_50'>String</a></span>:<span class='typeidentifier'><a name='304_57'>String</a></span>] = [:], <span class='identifier'><a name='304_72' href='#' title='usrString2' onclick='return expand(this);'>dest<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.html#309_24"; return false;'>Siteify.swift:309</td><td><pre>        let out = fopen(dest ?? "html/"+template, "w")!</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='304_78'>String</a></span>? = <span class='keyword'><a name='304_88'>nil</a></span>) -> <span class='typeidentifier'><a name='304_96'>UnsafeMutablePointer</a></span>&lt;<span class='typeidentifier'><a name='304_117'>FILE</a></span>> {
0305            <span class='keyword'><a name='305_8'>var</a></span> <span class='identifier'><a name='305_12' title='usrString3'>input</a></span> = <span class='keyword'><a name='305_20'>Self</a></span>.<span class='identifier'><a name='305_25' href='Resources.html#10_15' title='usrString1'>resources</a></span>[<span class='identifier'><a name='305_35' href='Siteify.html#304_22' title='usrString1'>template</a></span>]!
0306            <span class='keyword'><a name='306_8'>for</a></span> (<span class='identifier'><a name='306_13' title='usrString3'>tag</a></span>, <span class='identifier'><a name='306_18' title='usrString3'>value</a></span>) <span class='keyword'><a name='306_25'>in</a></span> <span class='identifier'><a name='306_28' href='Siteify.html#304_40' title='usrString1'>patches</a></span> {
0307                <span class='identifier'><a name='307_12' href='Siteify.html#305_12' title='usrString1'>input</a></span> = <span class='identifier'><a name='307_20' href='Siteify.html#305_12' title='usrString1'>input</a></span>.<span class='identifier'><a name='307_26'>replacingOccurrences</a></span>(<span class='identifier'><a name='307_47'>of</a></span>: <span class='identifier'><a name='307_51' href='Siteify.html#306_13' title='usrString1'>tag</a></span>, <span class='identifier'><a name='307_56'>with</a></span>: <span class='identifier'><a name='307_62' href='Siteify.html#306_18' title='usrString1'>value</a></span>)
0308            }
0309            <span class='keyword'><a name='309_8'>let</a></span> <span class='identifier'><a name='309_12' title='usrString3'>out</a></span> = <span class='identifier'><a name='309_18'>fopen</a></span>(<span class='identifier'><a name='309_24' href='Siteify.html#304_72' title='usrString1'>dest</a></span> ?? <span class='string'><a name='309_32'>"html/"</a></span>+<span class='identifier'><a name='309_40' href='Siteify.html#304_22' title='usrString1'>template</a></span>, <span class='string'><a name='309_50'>"w"</a></span>)!
0310            <span class='keyword'><a name='310_8'>_</a></span> = (<span class='identifier'><a name='310_13' href='Siteify.html#305_12' title='usrString1'>input</a></span> <span class='keyword'><a name='310_19'>as</a></span> <span class='typeidentifier'><a name='310_22'>String</a></span>).<span class='identifier'><a name='310_30'>withCString</a></span> {
0311                <span class='identifier'><a name='311_12'>fputs</a></span>(<span class='identifier'><a name='311_18' href='Siteify.html#310_42' title='usrString1'>$0</a></span>, <span class='identifier'><a name='311_22' href='Siteify.html#309_12' title='usrString1'>out</a></span>)
0312            }
0313            <span class='keyword'><a name='313_8'>return</a></span> <span class='identifier'><a name='313_15' href='Siteify.html#309_12' title='usrString1'>out</a></span>
0314        }
0315    }
0316    
0317    <span class='keyword'><a name='317_0'>extension</a></span> <span class='typeidentifier'><a name='317_10'>Position</a></span> {
0318    
0319        <span class='keyword'><a name='319_4'>var</a></span> <span class='identifier'><a name='319_8' title='usrString3'>anchor</a></span>: <span class='typeidentifier'><a name='319_16'>String</a></span> { <span class='string'><a name='319_25'>"</a></span>\<span class='string_interpolation_anchor'><a name='319_27'>(</a></span><span class='identifier'><a name='319_28'>line</a></span>+<span class='number'><a name='319_33'>1</a></span><span class='string_interpolation_anchor'><a name='319_34'>)</a></span><span class='string'><a name='319_35'>_</a></span>\<span class='string_interpolation_anchor'><a name='319_37'>(</a></span><span class='identifier'><a name='319_38'>character</a></span><span class='string_interpolation_anchor'><a name='319_47'>)</a></span><span class='string'><a name='319_48'>"</a></span> }
0320    }
0321    
0322    <span class='keyword'><a name='322_0'>extension</a></span> <span class='typeidentifier'><a name='322_10'>Location</a></span> {
0323    
0324        <span class='keyword'><a name='324_4'>var</a></span> <span class='identifier'><a name='324_8' title='usrString3'>file</a></span>: <span class='typeidentifier'><a name='324_14'>String</a></span> { <span class='identifier'><a name='324_23'>URL</a></span>(<span class='identifier'><a name='324_27'>string</a></span>: <span class='identifier'><a name='324_35'>uri</a></span>)!.<span class='identifier'><a name='324_41'>path</a></span> }
0325        <span class='keyword'><a name='325_4'>var</a></span> <span class='identifier'><a name='325_8' title='usrString3'>filename</a></span>: <span class='typeidentifier'><a name='325_18'>String</a></span> { <span class='identifier'><a name='325_27'>fileFilename</a></span>(<span class='identifier'><a name='325_40'>file</a></span>: <span class='identifier'><a name='325_46'>URL</a></span>(<span class='identifier'><a name='325_50'>string</a></span>: <span class='identifier'><a name='325_58'>uri</a></span>)!.<span class='identifier'><a name='325_64'>path</a></span>) }
0326        <span class='keyword'><a name='326_4'>var</a></span> <span class='identifier'><a name='326_8' title='usrString3'>line</a></span>: <span class='typeidentifier'><a name='326_14'>Int</a></span> { <span class='identifier'><a name='326_20'>range</a></span>.<span class='identifier'><a name='326_26'>start</a></span>.<span class='identifier'><a name='326_32'>line</a></span> }
0327        <span class='keyword'><a name='327_4'>var</a></span> <span class='identifier'><a name='327_8' title='usrString3'>anchor</a></span>: <span class='typeidentifier'><a name='327_16'>String</a></span> { <span class='identifier'><a name='327_25'>range</a></span>.<span class='identifier'><a name='327_31'>start</a></span>.<span class='identifier'><a name='327_37'>anchor</a></span> }
0328        <span class='keyword'><a name='328_4'>var</a></span> <span class='identifier'><a name='328_8' title='usrString3'>href</a></span>: <span class='typeidentifier'><a name='328_14'>String</a></span> { <span class='string'><a name='328_23'>"</a></span>\<span class='string_interpolation_anchor'><a name='328_25'>(</a></span><span class='identifier'><a name='328_26'>filename</a></span><span class='string_interpolation_anchor'><a name='328_34'>)</a></span><span class='string'><a name='328_35'>.html#</a></span>\<span class='string_interpolation_anchor'><a name='328_42'>(</a></span><span class='identifier'><a name='328_43'>anchor</a></span><span class='string_interpolation_anchor'><a name='328_49'>)</a></span><span class='string'><a name='328_50'>"</a></span> }
0329    }
0330    