<html><head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="siteify.css">
<script>

var lastlink;

function expand(a) {
    if ( a.children[0].style.display != "block" ) {
        if ( lastlink )
            lastlink.style.display = "none";
        a.children[0].style.display = "block";
        lastlink = a.children[0];
    }
    else {
        a.children[0].style.display = "none";
        lastlink = null;
    }
    return false;
}

</script></head><body><h3>siteify/Siteify.swift</h3><pre><span class=linenum>0001</span>    <span class='comment'>//
<span class=linenum>0002</span>    </span><span class='comment'>//  Siteify.swift
<span class=linenum>0003</span>    </span><span class='comment'>//  siteify
<span class=linenum>0004</span>    </span><span class='comment'>//
<span class=linenum>0005</span>    </span><span class='comment'>//  Created by John Holdsworth on 28/10/2019.
<span class=linenum>0006</span>    </span><span class='comment'>//  Copyright Â© 2019 John Holdsworth. All rights reserved.
<span class=linenum>0007</span>    </span><span class='comment'>//
<span class=linenum>0008</span>    </span><span class='comment'>//  $Id: //depot/siteify/siteify/Siteify.swift#22 $
<span class=linenum>0009</span>    </span><span class='comment'>//
<span class=linenum>0010</span>    </span><span class='comment'>//  Repo: </span><span class='url'><a href='https://github.com/johnno1962/siteify'>https://github.com/johnno1962/siteify</a></span><span class='comment'>
<span class=linenum>0011</span>    </span><span class='comment'>//
<span class=linenum>0012</span>    </span>
<span class=linenum>0013</span>    <span class='keyword'>import</span> <span class='identifier'>Foundation</span>
<span class=linenum>0014</span>    <span class='keyword'>import</span> <span class='identifier'>SwiftLSPClient</span>
<span class=linenum>0015</span>    <span class='keyword'>#if</span> <span class='id'>SWIFT_PACKAGE</span>
<span class=linenum>0016</span>    <span class='keyword'>import</span> <span class='identifier'>SourceKit</span>
<span class=linenum>0017</span>    <span class='keyword'>#endif</span>
<span class=linenum>0018</span>    
<span class=linenum>0019</span>    <span class='keyword'>var</span> <span class='identifier'><a name='19_4' href='#' title='usrString2' onclick='return expand(this);'>filenameForFile<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#26_22"; return false;'>Siteify.swift:26</td><td><pre>    if let filename = filenameForFile[file] {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#34_4"; return false;'>Siteify.swift:34</td><td><pre>    filenameForFile[file] = filename</pre></td></table></span></a></span> = [<span class='identifier'>String</span>: <span class='identifier'>String</span>](), <span class='identifier'><a name='19_42' href='#' title='usrString2' onclick='return expand(this);'>filesForFileName<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#30_10"; return false;'>Siteify.swift:30</td><td><pre>    while filesForFileName[filename] != nil {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#33_4"; return false;'>Siteify.swift:33</td><td><pre>    filesForFileName[filename] = file</pre></td></table></span></a></span> = [<span class='identifier'>String</span>: <span class='identifier'>String</span>]()
<span class=linenum>0020</span>    
<span class=linenum>0021</span>    <span class='keyword'>let</span> <span class='identifier'><a name='21_4' href='#' title='usrString2' onclick='return expand(this);'>filenameLock<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#24_4"; return false;'>Siteify.swift:24</td><td><pre>    filenameLock.lock()</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#25_12"; return false;'>Siteify.swift:25</td><td><pre>    defer { filenameLock.unlock() }</pre></td></table></span></a></span> = <span class='identifier'>NSLock</span>()
<span class=linenum>0022</span>    
<span class=linenum>0023</span>    <span class='keyword'>func</span> <span class='identifier'><a name='23_5' href='#' title='usrString2' onclick='return expand(this);'>fileFilename<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#154_23"; return false;'>Siteify.swift:154</td><td><pre>        let htmlfile = fileFilename(file: path)+".html"</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#359_27"; return false;'>Siteify.swift:359</td><td><pre>    var filename: String { fileFilename(file: URL(string: uri)!.path) }</pre></td></table></span></a></span>(<span class='identifier'><a name='23_18' href='#' title='usrString2' onclick='return expand(this);'>file<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#26_38"; return false;'>Siteify.swift:26</td><td><pre>    if let filename = filenameForFile[file] {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#29_42"; return false;'>Siteify.swift:29</td><td><pre>    var filename = NSURL(fileURLWithPath: file).lastPathComponent!</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#33_33"; return false;'>Siteify.swift:33</td><td><pre>    filesForFileName[filename] = file</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#34_20"; return false;'>Siteify.swift:34</td><td><pre>    filenameForFile[file] = filename</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>) -> <span class='typeidentifier'>String</span> {
<span class=linenum>0024</span>        <span class='identifier'><a name='24_4' href='Siteify.swift.html#21_4' title='usrString1'>filenameLock</a></span>.<span class='identifier'>lock</span>()
<span class=linenum>0025</span>        <span class='keyword'>defer</span> { <span class='identifier'><a name='25_12' href='Siteify.swift.html#21_4' title='usrString1'>filenameLock</a></span>.<span class='identifier'>unlock</span>() }
<span class=linenum>0026</span>        <span class='keyword'>if</span> <span class='keyword'>let</span> <span class='identifier'><a name='26_11' title='usrString3'>filename</a></span> = <span class='identifier'><a name='26_22' href='Siteify.swift.html#19_4' title='usrString1'>filenameForFile</a></span>[<span class='identifier'><a name='26_38' href='Siteify.swift.html#23_18' title='usrString1'>file</a></span>] {
<span class=linenum>0027</span>            <span class='keyword'>return</span> <span class='identifier'><a name='27_15' href='Siteify.swift.html#26_11' title='usrString1'>filename</a></span>
<span class=linenum>0028</span>        }
<span class=linenum>0029</span>        <span class='keyword'>var</span> <span class='identifier'><a name='29_8' title='usrString3'>filename</a></span> = <span class='identifier'>NSURL</span>(<span class='identifier'>fileURLWithPath</span>: <span class='identifier'><a name='29_42' href='Siteify.swift.html#23_18' title='usrString1'>file</a></span>).<span class='identifier'>lastPathComponent</span>!
<span class=linenum>0030</span>        <span class='keyword'>while</span> <span class='identifier'><a name='30_10' href='Siteify.swift.html#19_42' title='usrString1'>filesForFileName</a></span>[<span class='identifier'><a name='30_27' href='Siteify.swift.html#29_8' title='usrString1'>filename</a></span>] != <span class='keyword'>nil</span> {
<span class=linenum>0031</span>            <span class='identifier'><a name='31_8' href='Siteify.swift.html#29_8' title='usrString1'>filename</a></span> += <span class='string'>"_"</span>
<span class=linenum>0032</span>        }
<span class=linenum>0033</span>        <span class='identifier'><a name='33_4' href='Siteify.swift.html#19_42' title='usrString1'>filesForFileName</a></span>[<span class='identifier'><a name='33_21' href='Siteify.swift.html#29_8' title='usrString1'>filename</a></span>] = <span class='identifier'><a name='33_33' href='Siteify.swift.html#23_18' title='usrString1'>file</a></span>
<span class=linenum>0034</span>        <span class='identifier'><a name='34_4' href='Siteify.swift.html#19_4' title='usrString1'>filenameForFile</a></span>[<span class='identifier'><a name='34_20' href='Siteify.swift.html#23_18' title='usrString1'>file</a></span>] = <span class='identifier'><a name='34_28' href='Siteify.swift.html#29_8' title='usrString1'>filename</a></span>
<span class=linenum>0035</span>        <span class='keyword'>return</span> <span class='identifier'><a name='35_11' href='Siteify.swift.html#29_8' title='usrString1'>filename</a></span>
<span class=linenum>0036</span>    }
<span class=linenum>0037</span>    
<span class=linenum>0038</span>    <span class='keyword'>var</span> <span class='identifier'><a name='38_4' href='#' title='usrString2' onclick='return expand(this);'>comma<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#160_62"; return false;'>Siteify.swift:160</td><td><pre>                fputs("&lt;a href='\(htmlfile)'>\(relative)&lt;a> \(comma.string(from: NSNumber(value: data.count))!) bytes&lt;br>\n", indexFILE)</pre></td></table></span></a></span>: <span class='typeidentifier'>NumberFormatter</span> = {
<span class=linenum>0039</span>        <span class='keyword'>let</span> <span class='identifier'><a name='39_8' title='usrString3'>comma</a></span> = <span class='identifier'>NumberFormatter</span>()
<span class=linenum>0040</span>        <span class='identifier'><a name='40_4' href='Siteify.swift.html#39_8' title='usrString1'>comma</a></span>.<span class='identifier'>numberStyle</span> = <span class='identifier'>NumberFormatter</span>.<span class='identifier'>Style</span>.<span class='identifier'>decimal</span>
<span class=linenum>0041</span>        <span class='keyword'>return</span> <span class='identifier'><a name='41_11' href='Siteify.swift.html#39_8' title='usrString1'>comma</a></span>
<span class=linenum>0042</span>    }()
<span class=linenum>0043</span>    
<span class=linenum>0044</span>    <span class='keyword'>func</span> <span class='identifier'><a name='44_5' href='#' title='usrString2' onclick='return expand(this);'>progress<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#149_8"; return false;'>Siteify.swift:149</td><td><pre>        progress(str: "Site complete.")</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#156_8"; return false;'>Siteify.swift:156</td><td><pre>        progress(str: "Saving html/\(htmlfile)")</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#305_8"; return false;'>Siteify.swift:305</td><td><pre>        progress(str: "Saved html/\(htmlfile)")</pre></td></table></span></a></span>(<span class='identifier'><a name='44_14' href='#' title='usrString2' onclick='return expand(this);'>str<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#45_24"; return false;'>Siteify.swift:45</td><td><pre>    print("\u{001b}[2K"+str, separator: "", terminator: "\r")</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>) {
<span class=linenum>0045</span>        <span class='identifier'>print</span>(<span class='string'>"\u{001b}[2K"</span>+<span class='identifier'><a name='45_24' href='Siteify.swift.html#44_14' title='usrString1'>str</a></span>, <span class='identifier'>separator</span>: <span class='string'>""</span>, <span class='identifier'>terminator</span>: <span class='string'>"\r"</span>)
<span class=linenum>0046</span>        <span class='identifier'>fflush</span>(<span class='identifier'>stdout</span>)
<span class=linenum>0047</span>    }
<span class=linenum>0048</span>    
<span class=linenum>0049</span>    <span class='keyword'>struct</span> <span class='identifier'><a name='49_7' href='#' title='usrString2' onclick='return expand(this);'>LanguageServerSynchronizer<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#90_27"; return false;'>Siteify.swift:90</td><td><pre>        let synchronizer = LanguageServerSynchronizer()</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#153_27"; return false;'>Siteify.swift:153</td><td><pre>        let synchronizer = LanguageServerSynchronizer()</pre></td></table></span></a></span> {
<span class=linenum>0050</span>        <span class='keyword'>let</span> <span class='identifier'><a name='50_8' href='#' title='usrString2' onclick='return expand(this);'>semaphore<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#61_17"; return false;'>Siteify.swift:61</td><td><pre>            self.semaphore.signal()</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#63_8"; return false;'>Siteify.swift:63</td><td><pre>        semaphore.wait()</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#75_17"; return false;'>Siteify.swift:75</td><td><pre>            self.semaphore.signal()</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#77_8"; return false;'>Siteify.swift:77</td><td><pre>        semaphore.wait()</pre></td></table></span></a></span> = <span class='identifier'>DispatchSemaphore</span>(<span class='identifier'>value</span>: <span class='number'>0</span>)
<span class=linenum>0051</span>        <span class='keyword'>var</span> <span class='identifier'><a name='51_8' href='#' title='usrString2' onclick='return expand(this);'>errorHandler<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#59_21"; return false;'>Siteify.swift:59</td><td><pre>                self.errorHandler("LanguageServerError: \(error!)")</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#73_21"; return false;'>Siteify.swift:73</td><td><pre>                self.errorHandler("Error response \(error)")</pre></td></table></span></a></span> = {
<span class=linenum>0052</span>            (<span class='identifier'><a name='52_9' title='usrString3'>message</a></span>: <span class='typeidentifier'>String</span>) <span class='keyword'>in</span>
<span class=linenum>0053</span>            <span class='identifier'>fatalError</span>(<span class='identifier'><a name='53_19' href='Siteify.swift.html#52_9' title='usrString1'>message</a></span>)
<span class=linenum>0054</span>        }
<span class=linenum>0055</span>    
<span class=linenum>0056</span>        <span class='keyword'>func</span> <span class='identifier'><a name='56_9' title='usrString3'>sync</a></span>(<span class='keyword'>_</span> <span class='identifier'><a name='56_16' title='usrString3'>block</a></span>: <span class='builtin'>@escaping</span> (<span class='builtin'>@escaping</span> (<span class='typeidentifier'>LanguageServerError</span>?) -> <span class='typeidentifier'>Void</span>) -> <span class='typeidentifier'>Void</span>) {
<span class=linenum>0057</span>            <span class='identifier'><a name='57_8' href='Siteify.swift.html#56_16' title='usrString1'>block</a></span>({ (<span class='identifier'><a name='57_17' title='usrString3'>error</a></span>: <span class='typeidentifier'>LanguageServerError</span>?) <span class='keyword'>in</span>
<span class=linenum>0058</span>                <span class='keyword'>if</span> <span class='identifier'><a name='58_15' href='Siteify.swift.html#57_17' title='usrString1'>error</a></span> != <span class='keyword'>nil</span> {
<span class=linenum>0059</span>                    <span class='keyword'>self</span>.<span class='identifier'>errorHandler</span>(<span class='string'>"LanguageServerError: </span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='59_58' href='Siteify.swift.html#57_17' title='usrString1'>error</a></span>!<span class='string_interpolation_anchor'>)</span><span class='string'>"</span>)
<span class=linenum>0060</span>                }
<span class=linenum>0061</span>                <span class='keyword'>self</span>.<span class='identifier'>semaphore</span>.<span class='identifier'>signal</span>()
<span class=linenum>0062</span>            })
<span class=linenum>0063</span>            <span class='identifier'><a name='63_8' href='Siteify.swift.html#50_8' title='usrString1'>semaphore</a></span>.<span class='identifier'>wait</span>()
<span class=linenum>0064</span>        }
<span class=linenum>0065</span>    
<span class=linenum>0066</span>        <span class='keyword'>func</span> <span class='identifier'><a name='66_9' title='usrString3'>sync</a></span>&lt;<span class='identifier'><a name='66_14' title='usrString3'>RESP</a></span>>(<span class='keyword'>_</span> <span class='identifier'><a name='66_22' title='usrString3'>block</a></span>: <span class='builtin'>@escaping</span> (<span class='builtin'>@escaping</span> (<span class='typeidentifier'>LanguageServerResult</span>&lt;<span class='typeidentifier'><a name='66_72' href='Siteify.swift.html#66_14' title='usrString1'>RESP</a></span>>) -> <span class='typeidentifier'>Void</span>) -> <span class='typeidentifier'>Void</span>) -> <span class='typeidentifier'><a name='66_100' href='Siteify.swift.html#66_14' title='usrString1'>RESP</a></span> {
<span class=linenum>0067</span>            <span class='keyword'>var</span> <span class='identifier'><a name='67_12' title='usrString3'>theResponse</a></span>: <span class='typeidentifier'><a name='67_25' href='Siteify.swift.html#66_14' title='usrString1'>RESP</a></span>?
<span class=linenum>0068</span>            <span class='identifier'><a name='68_8' href='Siteify.swift.html#66_22' title='usrString1'>block</a></span>({ (<span class='identifier'><a name='68_17' title='usrString3'>response</a></span>: <span class='typeidentifier'>LanguageServerResult</span>) <span class='keyword'>in</span>
<span class=linenum>0069</span>                <span class='keyword'>switch</span> <span class='identifier'><a name='69_19' href='Siteify.swift.html#68_17' title='usrString1'>response</a></span> {
<span class=linenum>0070</span>                <span class='keyword'>case</span> .<span class='identifier'>success</span>(<span class='keyword'>let</span> <span class='identifier'><a name='70_30' title='usrString3'>value</a></span>):
<span class=linenum>0071</span>                    <span class='identifier'><a name='71_16' href='Siteify.swift.html#67_12' title='usrString1'>theResponse</a></span> = <span class='identifier'><a name='71_30' href='Siteify.swift.html#70_30' title='usrString1'>value</a></span>
<span class=linenum>0072</span>                <span class='keyword'>case</span> .<span class='identifier'>failure</span>(<span class='keyword'>let</span> <span class='identifier'><a name='72_30' title='usrString3'>error</a></span>):
<span class=linenum>0073</span>                    <span class='keyword'>self</span>.<span class='identifier'>errorHandler</span>(<span class='string'>"Error response </span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='73_52' href='Siteify.swift.html#72_30' title='usrString1'>error</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>"</span>)
<span class=linenum>0074</span>                }
<span class=linenum>0075</span>                <span class='keyword'>self</span>.<span class='identifier'>semaphore</span>.<span class='identifier'>signal</span>()
<span class=linenum>0076</span>            })
<span class=linenum>0077</span>            <span class='identifier'><a name='77_8' href='Siteify.swift.html#50_8' title='usrString1'>semaphore</a></span>.<span class='identifier'>wait</span>()
<span class=linenum>0078</span>            <span class='keyword'>return</span> <span class='identifier'><a name='78_15' href='Siteify.swift.html#67_12' title='usrString1'>theResponse</a></span>!
<span class=linenum>0079</span>        }
<span class=linenum>0080</span>    }
<span class=linenum>0081</span>    
<span class=linenum>0082</span>    <span class='builtin'>public</span> <span class='keyword'>class</span> <span class='identifier'><a name='82_13' href='#' title='usrString2' onclick='return expand(this);'>Siteify<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="main.swift.html#19_0"; event.stopPropagation(); return false;'>main.swift:19</td><td><pre>Siteify(projectRoot: projectRoot ?? ".").generateSite(into: "html")</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Resources.swift.html#9_10"; event.stopPropagation(); return false;'>Resources.swift:9</td><td><pre>extension Siteify {</pre></td></table></span></a></span>: <span class='typeidentifier'>NotificationResponder</span> {
<span class=linenum>0083</span>    
<span class=linenum>0084</span>        <span class='keyword'>let</span> <span class='identifier'><a name='84_8' href='#' title='usrString2' onclick='return expand(this);'>sourceKit<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#207_32"; return false;'>Siteify.swift:207</td><td><pre>                let resp = self.sourceKit.syntaxMap(filePath: path)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#209_79"; return false;'>Siteify.swift:209</td><td><pre>                let syntaxMap = SKApi.variant_dictionary_get_value( dict, self.sourceKit.syntaxID )</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#213_59"; return false;'>Siteify.swift:213</td><td><pre>                        let offset = dict.getInt(key: self.sourceKit.offsetID)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#214_59"; return false;'>Siteify.swift:214</td><td><pre>                        let length = dict.getInt(key: self.sourceKit.lengthID)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#223_60"; return false;'>Siteify.swift:223</td><td><pre>                    let kind = dict.getUUIDString(key: self.sourceKit.kindID)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#224_77"; return false;'>Siteify.swift:224</td><td><pre>                    let kindID = SKApi.variant_dictionary_get_uid(dict, self.sourceKit.kindID)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#233_41"; return false;'>Siteify.swift:233</td><td><pre>                    guard kindID == self.sourceKit.identifierID ||</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#234_39"; return false;'>Siteify.swift:234</td><td><pre>                        kindID == self.sourceKit.typeID else {</pre></td></table></span></a></span> = <span class='identifier'><a name='84_20' href='SourceKit.swift.html#169_13' title='usrString1'>SourceKit</a></span>(<span class='identifier'><a name='84_30' href='SourceKit.swift.html#225_4' title='usrString1'>logRequests</a></span>: <span class='keyword'>false</span>)
<span class=linenum>0085</span>        <span class='keyword'>let</span> <span class='identifier'><a name='85_8' href='#' title='usrString2' onclick='return expand(this);'>executablePath<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#99_51"; return false;'>Siteify.swift:99</td><td><pre>        let host = LanguageServerProcessHost(path: executablePath, arguments: [],</pre></td></table></span></a></span> = <span class='string'>"/Library/Developer/Toolchains/swift-latest.xctoolchain/usr/bin/sourcekit-lsp"</span>
<span class=linenum>0086</span>        <span class='keyword'>var</span> <span class='identifier'><a name='86_8' title='usrString3'>lspServer</a></span>: <span class='typeidentifier'>LanguageServer</span>!
<span class=linenum>0087</span>        <span class='keyword'>let</span> <span class='identifier'><a name='87_8' href='#' title='usrString2' onclick='return expand(this);'>projectRoot<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#95_13"; return false;'>Siteify.swift:95</td><td><pre>        self.projectRoot = URL(fileURLWithPath: projectRoot,</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#113_50"; return false;'>Siteify.swift:113</td><td><pre>        let workspace = WorkspaceFolder(uri: self.projectRoot.absoluteString, name: "siteify")</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#137_24"; return false;'>Siteify.swift:137</td><td><pre>            "__ROOT__": projectRoot.path.replacingOccurrences(of: home, with: "~")])</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#140_35"; return false;'>Siteify.swift:140</td><td><pre>        filemgr.enumerator(atPath: projectRoot.path)?</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#144_48"; return false;'>Siteify.swift:144</td><td><pre>                    self.processFile(path: self.projectRoot.appendingPathComponent(path).path)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#155_53"; return false;'>Siteify.swift:155</td><td><pre>        let relative = path.replacingOccurrences(of: projectRoot.path+"/", with: "")</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#251_76"; return false;'>Siteify.swift:251</td><td><pre>                                                decl.file.starts(with: self.projectRoot.path) {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#270_70"; return false;'>Siteify.swift:270</td><td><pre>                                } else if decl.file.starts(with: self.projectRoot.path) {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#293_50"; return false;'>Siteify.swift:293</td><td><pre>                    path.replacingOccurrences(of: projectRoot.path + "/", with: "")],</pre></td></table></span></a></span>: <span class='typeidentifier'>URL</span>
<span class=linenum>0088</span>    
<span class=linenum>0089</span>        <span class='builtin'>public</span> <span class='keyword'>init</span>(<span class='identifier'><a name='89_16' href='#' title='usrString2' onclick='return expand(this);'>projectRoot<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#95_48"; return false;'>Siteify.swift:95</td><td><pre>        self.projectRoot = URL(fileURLWithPath: projectRoot,</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#115_48"; return false;'>Siteify.swift:115</td><td><pre>                                      rootPath: projectRoot,</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>) {
<span class=linenum>0090</span>            <span class='keyword'>let</span> <span class='identifier'><a name='90_12' title='usrString3'>synchronizer</a></span> = <span class='identifier'><a name='90_27' href='Siteify.swift.html#49_7' title='usrString1'>LanguageServerSynchronizer</a></span>()
<span class=linenum>0091</span>            <span class='keyword'>var</span> <span class='identifier'><a name='91_12' title='usrString3'>rootBuffer</a></span> = [<span class='identifier'>Int8</span>](<span class='identifier'>repeating</span>: <span class='number'>0</span>, <span class='identifier'>count</span>: <span class='number'>1024</span>)
<span class=linenum>0092</span>            <span class='keyword'>let</span> <span class='identifier'><a name='92_12' title='usrString3'>cwd</a></span> = <span class='identifier'>String</span>(<span class='identifier'>cString</span>: <span class='identifier'><a name='92_34' href='Siteify.swift.html#91_12' title='usrString1'>rootBuffer</a></span>.<span class='identifier'>withUnsafeMutableBufferPointer</span> {
<span class=linenum>0093</span>                <span class='identifier'>getcwd</span>(<span class='identifier'><a name='93_19' href='Siteify.swift.html#92_76' title='usrString1'>$0</a></span>.<span class='identifier'>baseAddress</span>, <span class='identifier'><a name='93_35' href='Siteify.swift.html#92_76' title='usrString1'>$0</a></span>.<span class='identifier'>count</span>)
<span class=linenum>0094</span>            })
<span class=linenum>0095</span>            <span class='keyword'>self</span>.<span class='identifier'><a name='95_13' href='Siteify.swift.html#87_8' title='usrString1'>projectRoot</a></span> = <span class='identifier'>URL</span>(<span class='identifier'>fileURLWithPath</span>: <span class='identifier'><a name='95_48' href='Siteify.swift.html#89_16' title='usrString1'>projectRoot</a></span>,
<span class=linenum>0096</span>                                   <span class='identifier'>relativeTo</span>: <span class='identifier'>URL</span>(<span class='identifier'>fileURLWithPath</span>: <span class='identifier'><a name='96_64' href='Siteify.swift.html#92_12' title='usrString1'>cwd</a></span>))
<span class=linenum>0097</span>    
<span class=linenum>0098</span>            <span class='keyword'>let</span> <span class='identifier'><a name='98_12' title='usrString3'>PATH</a></span> = <span class='identifier'>ProcessInfo</span>.<span class='identifier'>processInfo</span>.<span class='identifier'>environment</span>[<span class='string'>"PATH"</span>] ?? <span class='string'>"/usr/bin"</span>
<span class=linenum>0099</span>            <span class='keyword'>let</span> <span class='identifier'><a name='99_12' title='usrString3'>host</a></span> = <span class='identifier'>LanguageServerProcessHost</span>(<span class='identifier'>path</span>: <span class='identifier'>executablePath</span>, <span class='identifier'>arguments</span>: [],
<span class=linenum>0100</span>                                             <span class='identifier'>environment</span>: [<span class='string'>"PATH"</span>: <span class='identifier'><a name='100_63' href='Siteify.swift.html#98_12' title='usrString1'>PATH</a></span>])
<span class=linenum>0101</span>    
<span class=linenum>0102</span>            <span class='identifier'><a name='102_8' href='Siteify.swift.html#99_12' title='usrString1'>host</a></span>.<span class='identifier'>start</span> { (<span class='identifier'><a name='102_22' title='usrString3'>server</a></span>) <span class='keyword'>in</span>
<span class=linenum>0103</span>                <span class='keyword'>guard</span> <span class='keyword'>let</span> <span class='identifier'><a name='103_22' title='usrString3'>server</a></span> = <span class='identifier'><a name='103_31' href='Siteify.swift.html#102_22' title='usrString1'>server</a></span> <span class='keyword'>as</span>? <span class='typeidentifier'>JSONRPCLanguageServer</span> <span class='keyword'>else</span> {
<span class=linenum>0104</span>                    <span class='identifier'>fatalError</span>(<span class='string'>"unable to launch server"</span>)
<span class=linenum>0105</span>                }
<span class=linenum>0106</span>                <span class='identifier'><a name='106_12' href='Siteify.swift.html#103_22' title='usrString1'>server</a></span>.<span class='identifier'>notificationResponder</span> = <span class='keyword'>self</span>
<span class=linenum>0107</span>                <span class='keyword'>self</span>.<span class='identifier'>lspServer</span> = <span class='identifier'><a name='107_29' href='Siteify.swift.html#103_22' title='usrString1'>server</a></span>
<span class=linenum>0108</span>            }
<span class=linenum>0109</span>    
<span class=linenum>0110</span>            <span class='keyword'>let</span> <span class='identifier'><a name='110_12' title='usrString3'>processId</a></span> = <span class='identifier'>Int</span>(<span class='identifier'>ProcessInfo</span>.<span class='identifier'>processInfo</span>.<span class='identifier'>processIdentifier</span>)
<span class=linenum>0111</span>            <span class='keyword'>let</span> <span class='identifier'><a name='111_12' title='usrString3'>capabilities</a></span> = <span class='identifier'>ClientCapabilities</span>(<span class='identifier'>workspace</span>: <span class='keyword'>nil</span>, <span class='identifier'>textDocument</span>: <span class='keyword'>nil</span>, <span class='identifier'>experimental</span>: <span class='keyword'>nil</span>)
<span class=linenum>0112</span>    
<span class=linenum>0113</span>            <span class='keyword'>let</span> <span class='identifier'><a name='113_12' title='usrString3'>workspace</a></span> = <span class='identifier'>WorkspaceFolder</span>(<span class='identifier'>uri</span>: <span class='keyword'>self</span>.<span class='identifier'>projectRoot</span>.<span class='identifier'>absoluteString</span>, <span class='identifier'>name</span>: <span class='string'>"siteify"</span>)
<span class=linenum>0114</span>            <span class='keyword'>let</span> <span class='identifier'><a name='114_12' title='usrString3'>params</a></span> = <span class='identifier'>InitializeParams</span>(<span class='identifier'>processId</span>: <span class='identifier'><a name='114_49' href='Siteify.swift.html#110_12' title='usrString1'>processId</a></span>,
<span class=linenum>0115</span>                                          <span class='identifier'>rootPath</span>: <span class='identifier'><a name='115_48' href='Siteify.swift.html#89_16' title='usrString1'>projectRoot</a></span>,
<span class=linenum>0116</span>                                          <span class='identifier'>rootURI</span>: <span class='keyword'>nil</span>,
<span class=linenum>0117</span>                                          <span class='identifier'>initializationOptions</span>: <span class='keyword'>nil</span>,
<span class=linenum>0118</span>                                          <span class='identifier'>capabilities</span>: <span class='identifier'><a name='118_52' href='Siteify.swift.html#111_12' title='usrString1'>capabilities</a></span>,
<span class=linenum>0119</span>                                          <span class='identifier'>trace</span>: <span class='identifier'>Tracing</span>.<span class='identifier'>off</span>,
<span class=linenum>0120</span>                                          <span class='identifier'>workspaceFolders</span>: [<span class='identifier'><a name='120_57' href='Siteify.swift.html#113_12' title='usrString1'>workspace</a></span>])
<span class=linenum>0121</span>    
<span class=linenum>0122</span>            <span class='keyword'>_</span> = <span class='identifier'><a name='122_12' href='Siteify.swift.html#90_12' title='usrString1'>synchronizer</a></span>.<span class='identifier'>sync</span>({
<span class=linenum>0123</span>                <span class='keyword'>self</span>.<span class='identifier'>lspServer</span>.<span class='identifier'>initialize</span>(<span class='identifier'>params</span>: <span class='identifier'><a name='123_46' href='Siteify.swift.html#114_12' title='usrString1'>params</a></span>, <span class='identifier'>block</span>: <span class='identifier'><a name='123_61' href='Siteify.swift.html#122_30' title='usrString1'>$0</a></span>)
<span class=linenum>0124</span>            })
<span class=linenum>0125</span>        }
<span class=linenum>0126</span>    
<span class=linenum>0127</span>        <span class='keyword'>var</span> <span class='identifier'><a name='127_8' href='#' title='usrString2' onclick='return expand(this);'>indexFILE<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#135_8"; return false;'>Siteify.swift:135</td><td><pre>        indexFILE = copyTemplate(template: "index.html", patches: [</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#138_15"; return false;'>Siteify.swift:138</td><td><pre>        setbuf(indexFILE, nil)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#159_15"; return false;'>Siteify.swift:159</td><td><pre>            if indexFILE != nil {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#160_126"; return false;'>Siteify.swift:160</td><td><pre>                fputs("&lt;a href='\(htmlfile)'>\(relative)&lt;a> \(comma.string(from: NSNumber(value: data.count))!) bytes&lt;br>\n", indexFILE)</pre></td></table></span></a></span>: <span class='typeidentifier'>UnsafeMutablePointer</span>&lt;<span class='typeidentifier'>FILE</span>>?
<span class=linenum>0128</span>    
<span class=linenum>0129</span>        <span class='builtin'>public</span> <span class='keyword'>func</span> <span class='identifier'><a name='129_16' href='#' title='usrString2' onclick='return expand(this);'>generateSite<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="main.swift.html#19_41"; event.stopPropagation(); return false;'>main.swift:19</td><td><pre>Siteify(projectRoot: projectRoot ?? ".").generateSite(into: "html")</pre></td></table></span></a></span>(<span class='identifier'><a name='129_29' title='usrString2' onclick='return expand(this);'>into<span class='references'><table></table></span></a></span>: <span class='typeidentifier'>String</span>) {
<span class=linenum>0130</span>            <span class='keyword'>let</span> <span class='identifier'><a name='130_12' title='usrString3'>filemgr</a></span> = <span class='identifier'>FileManager</span>.<span class='identifier'>default</span>
<span class=linenum>0131</span>            <span class='keyword'>if</span> !<span class='identifier'><a name='131_12' href='Siteify.swift.html#130_12' title='usrString1'>filemgr</a></span>.<span class='identifier'>fileExists</span>(<span class='identifier'>atPath</span>: <span class='string'>"html"</span>) {
<span class=linenum>0132</span>                <span class='keyword'>try</span>! <span class='identifier'><a name='132_17' href='Siteify.swift.html#130_12' title='usrString1'>filemgr</a></span>.<span class='identifier'>createDirectory</span>(<span class='identifier'>atPath</span>: <span class='string'>"html"</span>, <span class='identifier'>withIntermediateDirectories</span>: <span class='keyword'>false</span>, <span class='identifier'>attributes</span>: <span class='keyword'>nil</span>)
<span class=linenum>0133</span>            }
<span class=linenum>0134</span>            <span class='identifier'>fclose</span>(<span class='identifier'><a name='134_15' href='Siteify.swift.html#311_9' title='usrString1'>copyTemplate</a></span>(<span class='identifier'>template</span>: <span class='string'>"siteify.css"</span>))
<span class=linenum>0135</span>            <span class='identifier'><a name='135_8' href='Siteify.swift.html#127_8' title='usrString1'>indexFILE</a></span> = <span class='identifier'><a name='135_20' href='Siteify.swift.html#311_9' title='usrString1'>copyTemplate</a></span>(<span class='identifier'>template</span>: <span class='string'>"index.html"</span>, <span class='identifier'>patches</span>: [
<span class=linenum>0136</span>                <span class='string'>"__DATE__"</span>: <span class='identifier'>NSDate</span>().<span class='identifier'>description</span>,
<span class=linenum>0137</span>                <span class='string'>"__ROOT__"</span>: <span class='identifier'><a name='137_24' href='Siteify.swift.html#87_8' title='usrString1'>projectRoot</a></span>.<span class='identifier'>path</span>.<span class='identifier'>replacingOccurrences</span>(<span class='identifier'>of</span>: <span class='identifier'><a name='137_66' href='Siteify.swift.html#308_8' title='usrString1'>home</a></span>, <span class='identifier'>with</span>: <span class='string'>"~"</span>)])
<span class=linenum>0138</span>            <span class='identifier'>setbuf</span>(<span class='identifier'><a name='138_15' href='Siteify.swift.html#127_8' title='usrString1'>indexFILE</a></span>, <span class='keyword'>nil</span>)
<span class=linenum>0139</span>    
<span class=linenum>0140</span>            <span class='identifier'><a name='140_8' href='Siteify.swift.html#130_12' title='usrString1'>filemgr</a></span>.<span class='identifier'>enumerator</span>(<span class='identifier'>atPath</span>: <span class='identifier'><a name='140_35' href='Siteify.swift.html#87_8' title='usrString1'>projectRoot</a></span>.<span class='identifier'>path</span>)?
<span class=linenum>0141</span>                .<span class='identifier'>compactMap</span> { <span class='identifier'><a name='141_26' href='Siteify.swift.html#141_24' title='usrString1'>$0</a></span> <span class='keyword'>as</span>? <span class='typeidentifier'>String</span> }.<span class='identifier'>sorted</span>()
<span class=linenum>0142</span>                .<span class='identifier'><a name='142_13' href='Parallelize.swift.html#18_9' title='usrString1'>concurrentMap</a></span>(<span class='identifier'>maxConcurrency</span>: <span class='number'>8</span>) { (<span class='identifier'><a name='142_49' title='usrString3'>path</a></span>, <span class='identifier'><a name='142_55' title='usrString3'>completion</a></span>: (<span class='typeidentifier'>String</span>?) -> <span class='typeidentifier'>Void</span>) <span class='keyword'>in</span>
<span class=linenum>0143</span>                    <span class='keyword'>if</span> (<span class='keyword'>try</span>? <span class='identifier'>LanguageIdentifier</span>(<span class='identifier'>for</span>: <span class='identifier'>URL</span>(<span class='identifier'>fileURLWithPath</span>: <span class='identifier'><a name='143_70' href='Siteify.swift.html#142_49' title='usrString1'>path</a></span>))) != <span class='keyword'>nil</span> {
<span class=linenum>0144</span>                        <span class='keyword'>self</span>.<span class='identifier'><a name='144_25' href='Siteify.swift.html#152_16' title='usrString1'>processFile</a></span>(<span class='identifier'><a name='144_37' href='Siteify.swift.html#152_16' title='usrString1'>path</a></span>: <span class='keyword'>self</span>.<span class='identifier'><a name='144_48' href='Siteify.swift.html#87_8' title='usrString1'>projectRoot</a></span>.<span class='identifier'>appendingPathComponent</span>(<span class='identifier'><a name='144_83' href='Siteify.swift.html#142_49' title='usrString1'>path</a></span>).<span class='identifier'>path</span>)
<span class=linenum>0145</span>                    }
<span class=linenum>0146</span>                    <span class='keyword'>return</span> <span class='identifier'><a name='146_23' href='Siteify.swift.html#142_55' title='usrString1'>completion</a></span>(<span class='identifier'><a name='146_34' href='Siteify.swift.html#142_49' title='usrString1'>path</a></span>)
<span class=linenum>0147</span>                }
<span class=linenum>0148</span>    
<span class=linenum>0149</span>            <span class='identifier'><a name='149_8' href='Siteify.swift.html#44_5' title='usrString1'>progress</a></span>(<span class='identifier'><a name='149_17' href='Siteify.swift.html#44_5' title='usrString1'>str</a></span>: <span class='string'>"Site complete."</span>)
<span class=linenum>0150</span>        }
<span class=linenum>0151</span>    
<span class=linenum>0152</span>        <span class='builtin'>public</span> <span class='keyword'>func</span> <span class='identifier'><a name='152_16' href='#' title='usrString2' onclick='return expand(this);'>processFile<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#144_25"; return false;'>Siteify.swift:144</td><td><pre>                    self.processFile(path: self.projectRoot.appendingPathComponent(path).path)</pre></td></table></span></a></span>(<span class='identifier'><a name='152_28' href='#' title='usrString2' onclick='return expand(this);'>path<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#154_42"; return false;'>Siteify.swift:154</td><td><pre>        let htmlfile = fileFilename(file: path)+".html"</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#155_23"; return false;'>Siteify.swift:155</td><td><pre>        let relative = path.replacingOccurrences(of: projectRoot.path+"/", with: "")</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#158_65"; return false;'>Siteify.swift:158</td><td><pre>        if let data = try? Data(contentsOf: URL(fileURLWithPath: path)) {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#164_137"; return false;'>Siteify.swift:164</td><td><pre>                self.lspServer.didOpenTextDocument(params: DidOpenTextDocumentParams(textDocument: try! TextDocumentItem(contentsOfFile: path)), block: $0)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#207_62"; return false;'>Siteify.swift:207</td><td><pre>                let resp = self.sourceKit.syntaxMap(filePath: path)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#238_103"; return false;'>Siteify.swift:238</td><td><pre>                    let docPos = TextDocumentPositionParams(textDocument: TextDocumentIdentifier(path: path), position: pos)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#245_48"; return false;'>Siteify.swift:245</td><td><pre>                                if decl.file == path &amp;&amp; decl.range.start == pos {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#246_129"; return false;'>Siteify.swift:246</td><td><pre>                                    self.lspServer.references(params: ReferenceParams(textDocument: TextDocumentIdentifier(path: path), position: pos, context: ReferenceContext(includeDeclaration: false))) {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#293_20"; return false;'>Siteify.swift:293</td><td><pre>                    path.replacingOccurrences(of: projectRoot.path + "/", with: "")],</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#300_134"; return false;'>Siteify.swift:300</td><td><pre>                    self.lspServer.didCloseTextDocument(params: DidCloseTextDocumentParams(textDocument: TextDocumentIdentifier(path: path)), block: $0)</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>) {
<span class=linenum>0153</span>            <span class='keyword'>let</span> <span class='identifier'><a name='153_12' title='usrString3'>synchronizer</a></span> = <span class='identifier'><a name='153_27' href='Siteify.swift.html#49_7' title='usrString1'>LanguageServerSynchronizer</a></span>()
<span class=linenum>0154</span>            <span class='keyword'>let</span> <span class='identifier'><a name='154_12' title='usrString3'>htmlfile</a></span> = <span class='identifier'><a name='154_23' href='Siteify.swift.html#23_5' title='usrString1'>fileFilename</a></span>(<span class='identifier'><a name='154_36' href='Siteify.swift.html#23_5' title='usrString1'>file</a></span>: <span class='identifier'><a name='154_42' href='Siteify.swift.html#152_28' title='usrString1'>path</a></span>)+<span class='string'>".html"</span>
<span class=linenum>0155</span>            <span class='keyword'>let</span> <span class='identifier'><a name='155_12' title='usrString3'>relative</a></span> = <span class='identifier'><a name='155_23' href='Siteify.swift.html#152_28' title='usrString1'>path</a></span>.<span class='identifier'>replacingOccurrences</span>(<span class='identifier'>of</span>: <span class='identifier'><a name='155_53' href='Siteify.swift.html#87_8' title='usrString1'>projectRoot</a></span>.<span class='identifier'>path</span>+<span class='string'>"/"</span>, <span class='identifier'>with</span>: <span class='string'>""</span>)
<span class=linenum>0156</span>            <span class='identifier'><a name='156_8' href='Siteify.swift.html#44_5' title='usrString1'>progress</a></span>(<span class='identifier'><a name='156_17' href='Siteify.swift.html#44_5' title='usrString1'>str</a></span>: <span class='string'>"Saving html/</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='156_37' href='Siteify.swift.html#154_12' title='usrString1'>htmlfile</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>"</span>)
<span class=linenum>0157</span>    
<span class=linenum>0158</span>            <span class='keyword'>if</span> <span class='keyword'>let</span> <span class='identifier'><a name='158_15' title='usrString3'>data</a></span> = <span class='keyword'>try</span>? <span class='identifier'>Data</span>(<span class='identifier'>contentsOf</span>: <span class='identifier'>URL</span>(<span class='identifier'>fileURLWithPath</span>: <span class='identifier'><a name='158_65' href='Siteify.swift.html#152_28' title='usrString1'>path</a></span>)) {
<span class=linenum>0159</span>                <span class='keyword'>if</span> <span class='identifier'><a name='159_15' href='Siteify.swift.html#127_8' title='usrString1'>indexFILE</a></span> != <span class='keyword'>nil</span> {
<span class=linenum>0160</span>                    <span class='identifier'>fputs</span>(<span class='string'>"&lt;a href='</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='160_34' href='Siteify.swift.html#154_12' title='usrString1'>htmlfile</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>'></span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='160_47' href='Siteify.swift.html#155_12' title='usrString1'>relative</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>&lt;a> </span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='160_62' href='Siteify.swift.html#38_4' title='usrString1'>comma</a></span>.<span class='identifier'>string</span>(<span class='identifier'>from</span>: <span class='identifier'>NSNumber</span>(<span class='identifier'>value</span>: <span class='identifier'><a name='160_97' href='Siteify.swift.html#158_15' title='usrString1'>data</a></span>.<span class='identifier'>count</span>))!<span class='string_interpolation_anchor'>)</span><span class='string'> bytes&lt;br>\n"</span>, <span class='identifier'><a name='160_126' href='Siteify.swift.html#127_8' title='usrString1'>indexFILE</a></span>)
<span class=linenum>0161</span>                }
<span class=linenum>0162</span>    
<span class=linenum>0163</span>                <span class='identifier'><a name='163_12' href='Siteify.swift.html#153_12' title='usrString1'>synchronizer</a></span>.<span class='identifier'>sync</span> {
<span class=linenum>0164</span>                    <span class='keyword'>self</span>.<span class='identifier'>lspServer</span>.<span class='identifier'>didOpenTextDocument</span>(<span class='identifier'>params</span>: <span class='identifier'>DidOpenTextDocumentParams</span>(<span class='identifier'>textDocument</span>: <span class='keyword'>try</span>! <span class='identifier'>TextDocumentItem</span>(<span class='identifier'>contentsOfFile</span>: <span class='identifier'><a name='164_137' href='Siteify.swift.html#152_28' title='usrString1'>path</a></span>)), <span class='identifier'>block</span>: <span class='identifier'><a name='164_152' href='Siteify.swift.html#163_30' title='usrString1'>$0</a></span>)
<span class=linenum>0165</span>                }
<span class=linenum>0166</span>                <span class='identifier'><a name='166_12' href='Siteify.swift.html#158_15' title='usrString1'>data</a></span>.<span class='identifier'>withUnsafeBytes</span> { (<span class='identifier'><a name='166_36' title='usrString3'>buffer</a></span>: <span class='typeidentifier'>UnsafeRawBufferPointer</span>) <span class='keyword'>in</span>
<span class=linenum>0167</span>                    <span class='keyword'>let</span> <span class='identifier'><a name='167_20' title='usrString3'>start</a></span> = <span class='identifier'><a name='167_28' href='Siteify.swift.html#166_36' title='usrString1'>buffer</a></span>.<span class='identifier'>baseAddress</span>!.<span class='identifier'>assumingMemoryBound</span>(<span class='identifier'>to</span>: <span class='identifier'>Int8</span>.<span class='keyword'>self</span>)
<span class=linenum>0168</span>                    <span class='keyword'>var</span> <span class='identifier'><a name='168_20' title='usrString3'>ptr</a></span> = <span class='number'>0</span>, <span class='identifier'><a name='168_29' title='usrString3'>linestart</a></span> = <span class='number'>0</span>, <span class='identifier'><a name='168_44' title='usrString3'>lineno</a></span> = <span class='number'>0</span>, <span class='identifier'><a name='168_56' title='usrString3'>col</a></span> = <span class='number'>0</span>
<span class=linenum>0169</span>    
<span class=linenum>0170</span>                    <span class='keyword'>func</span> <span class='identifier'><a name='170_21' title='usrString3'>skipTo</a></span>(<span class='identifier'><a name='170_28' href='#' title='usrString2' onclick='return expand(this);'>offset<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#172_71"; return false;'>Siteify.swift:172</td><td><pre>                                            Int32(UInt8(ascii: "\n")), offset - linestart) {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#181_44"; return false;'>Siteify.swift:181</td><td><pre>                                    length: offset - linestart,</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#184_65"; return false;'>Siteify.swift:184</td><td><pre>                    let out = NSString(bytes: start+ptr, length: offset-ptr,</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#186_26"; return false;'>Siteify.swift:186</td><td><pre>                    ptr = offset</pre></td></table></span></a></span>: <span class='typeidentifier'>Int</span>) -> <span class='typeidentifier'>String</span> {
<span class=linenum>0171</span>                        <span class='keyword'>while</span> <span class='keyword'>let</span> <span class='identifier'><a name='171_30' title='usrString3'>line</a></span> = <span class='identifier'>memchr</span>(<span class='identifier'><a name='171_44' href='Siteify.swift.html#167_20' title='usrString1'>start</a></span> + <span class='identifier'><a name='171_52' href='Siteify.swift.html#168_29' title='usrString1'>linestart</a></span>,
<span class=linenum>0172</span>                                                <span class='identifier'>Int32</span>(<span class='identifier'>UInt8</span>(<span class='identifier'>ascii</span>: <span class='string'>"\n"</span>)), <span class='identifier'><a name='172_71' href='Siteify.swift.html#170_28' title='usrString1'>offset</a></span> - <span class='identifier'><a name='172_80' href='Siteify.swift.html#168_29' title='usrString1'>linestart</a></span>) {
<span class=linenum>0173</span>                            <span class='identifier'><a name='173_24' href='Siteify.swift.html#168_44' title='usrString1'>lineno</a></span> += <span class='number'>1</span>
<span class=linenum>0174</span>                            <span class='identifier'><a name='174_24' href='Siteify.swift.html#168_29' title='usrString1'>linestart</a></span> = <span class='identifier'>UnsafePointer</span>&lt;<span class='typeidentifier'>Int8</span>>(<span class='identifier'><a name='174_56' href='Siteify.swift.html#171_30' title='usrString1'>line</a></span>
<span class=linenum>0175</span>                                .<span class='identifier'>assumingMemoryBound</span>(<span class='identifier'>to</span>: <span class='identifier'>Int8</span>.<span class='keyword'>self</span>)) - <span class='identifier'><a name='175_67' href='Siteify.swift.html#167_20' title='usrString1'>start</a></span> + <span class='number'>1</span>
<span class=linenum>0176</span>                            <span class='keyword'>if</span> <span class='identifier'><a name='176_27' href='Siteify.swift.html#167_20' title='usrString1'>start</a></span>[<span class='identifier'><a name='176_33' href='Siteify.swift.html#168_29' title='usrString1'>linestart</a></span>] == <span class='identifier'>UInt8</span>(<span class='identifier'>ascii</span>: <span class='string'>"\r"</span>) {
<span class=linenum>0177</span>                                <span class='identifier'><a name='177_28' href='Siteify.swift.html#168_29' title='usrString1'>linestart</a></span> += <span class='number'>1</span>
<span class=linenum>0178</span>                            }
<span class=linenum>0179</span>                        }
<span class=linenum>0180</span>                        <span class='identifier'><a name='180_20' href='Siteify.swift.html#168_56' title='usrString1'>col</a></span> = (<span class='identifier'>NSString</span>(<span class='identifier'>bytes</span>: <span class='identifier'><a name='180_43' href='Siteify.swift.html#167_20' title='usrString1'>start</a></span> + <span class='identifier'><a name='180_51' href='Siteify.swift.html#168_29' title='usrString1'>linestart</a></span>,
<span class=linenum>0181</span>                                        <span class='identifier'>length</span>: <span class='identifier'><a name='181_44' href='Siteify.swift.html#170_28' title='usrString1'>offset</a></span> - <span class='identifier'><a name='181_53' href='Siteify.swift.html#168_29' title='usrString1'>linestart</a></span>,
<span class=linenum>0182</span>                                        <span class='identifier'>encoding</span>: <span class='identifier'>String</span>.<span class='identifier'>Encoding</span>.<span class='identifier'>utf8</span>.<span class='identifier'>rawValue</span>) ?? <span class='string'>""</span>).<span class='identifier'>length</span>
<span class=linenum>0183</span>                        
<span class=linenum>0184</span>                        <span class='keyword'>let</span> <span class='identifier'><a name='184_24' title='usrString3'>out</a></span> = <span class='identifier'>NSString</span>(<span class='identifier'>bytes</span>: <span class='identifier'><a name='184_46' href='Siteify.swift.html#167_20' title='usrString1'>start</a></span>+<span class='identifier'><a name='184_52' href='Siteify.swift.html#168_20' title='usrString1'>ptr</a></span>, <span class='identifier'>length</span>: <span class='identifier'><a name='184_65' href='Siteify.swift.html#170_28' title='usrString1'>offset</a></span>-<span class='identifier'><a name='184_72' href='Siteify.swift.html#168_20' title='usrString1'>ptr</a></span>,
<span class=linenum>0185</span>                                           <span class='identifier'>encoding</span>: <span class='identifier'>String</span>.<span class='identifier'>Encoding</span>.<span class='identifier'>utf8</span>.<span class='identifier'>rawValue</span>) ?? <span class='string'>""</span>
<span class=linenum>0186</span>                        <span class='identifier'><a name='186_20' href='Siteify.swift.html#168_20' title='usrString1'>ptr</a></span> = <span class='identifier'><a name='186_26' href='Siteify.swift.html#170_28' title='usrString1'>offset</a></span>
<span class=linenum>0187</span>                        <span class='keyword'>return</span> <span class='identifier'><a name='187_27' href='Siteify.swift.html#184_24' title='usrString1'>out</a></span>
<span class=linenum>0188</span>                            .<span class='identifier'>replacingOccurrences</span>(<span class='identifier'>of</span>: <span class='string'>"&amp;"</span>, <span class='identifier'>with</span>: <span class='string'>"&amp;amp;"</span>)
<span class=linenum>0189</span>                            .<span class='identifier'>replacingOccurrences</span>(<span class='identifier'>of</span>: <span class='string'>"&lt;"</span>, <span class='identifier'>with</span>: <span class='string'>"&amp;lt;"</span>) <span class='keyword'>as</span> <span class='typeidentifier'>String</span>
<span class=linenum>0190</span>                    }
<span class=linenum>0191</span>    
<span class=linenum>0192</span>                    <span class='keyword'>var</span> <span class='identifier'><a name='192_20' title='usrString3'>fileLineCache</a></span> = [<span class='identifier'>String</span>: [<span class='identifier'>String</span>]]()
<span class=linenum>0193</span>                    <span class='keyword'>func</span> <span class='identifier'><a name='193_21' title='usrString3'>reflines</a></span>(<span class='identifier'><a name='193_30' href='#' title='usrString2' onclick='return expand(this);'>file<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#194_37"; return false;'>Siteify.swift:194</td><td><pre>                    if fileLineCache[file] == nil {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#195_38"; return false;'>Siteify.swift:195</td><td><pre>                        fileLineCache[file] =</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#196_57"; return false;'>Siteify.swift:196</td><td><pre>                            (try? String(contentsOfFile: file))?</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#199_49"; return false;'>Siteify.swift:199</td><td><pre>                    if let lines = fileLineCache[file], line &lt; lines.count {</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>, <span class='identifier'><a name='193_44' href='#' title='usrString2' onclick='return expand(this);'>line<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#199_56"; return false;'>Siteify.swift:199</td><td><pre>                    if let lines = fileLineCache[file], line &lt; lines.count {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#200_37"; return false;'>Siteify.swift:200</td><td><pre>                        return lines[line]</pre></td></table></span></a></span>: <span class='typeidentifier'>Int</span>) -> <span class='typeidentifier'>String</span> {
<span class=linenum>0194</span>                        <span class='keyword'>if</span> <span class='identifier'><a name='194_23' href='Siteify.swift.html#192_20' title='usrString1'>fileLineCache</a></span>[<span class='identifier'><a name='194_37' href='Siteify.swift.html#193_30' title='usrString1'>file</a></span>] == <span class='keyword'>nil</span> {
<span class=linenum>0195</span>                            <span class='identifier'><a name='195_24' href='Siteify.swift.html#192_20' title='usrString1'>fileLineCache</a></span>[<span class='identifier'><a name='195_38' href='Siteify.swift.html#193_30' title='usrString1'>file</a></span>] =
<span class=linenum>0196</span>                                (<span class='keyword'>try</span>? <span class='identifier'>String</span>(<span class='identifier'>contentsOfFile</span>: <span class='identifier'><a name='196_57' href='Siteify.swift.html#193_30' title='usrString1'>file</a></span>))?
<span class=linenum>0197</span>                                .<span class='identifier'>components</span>(<span class='identifier'>separatedBy</span>: <span class='string'>"\n"</span>)
<span class=linenum>0198</span>                        }
<span class=linenum>0199</span>                        <span class='keyword'>if</span> <span class='keyword'>let</span> <span class='identifier'><a name='199_27' title='usrString3'>lines</a></span> = <span class='identifier'><a name='199_35' href='Siteify.swift.html#192_20' title='usrString1'>fileLineCache</a></span>[<span class='identifier'><a name='199_49' href='Siteify.swift.html#193_30' title='usrString1'>file</a></span>], <span class='identifier'><a name='199_56' href='Siteify.swift.html#193_44' title='usrString1'>line</a></span> &lt; <span class='identifier'><a name='199_63' href='Siteify.swift.html#199_27' title='usrString1'>lines</a></span>.<span class='identifier'>count</span> {
<span class=linenum>0200</span>                            <span class='keyword'>return</span> <span class='identifier'><a name='200_31' href='Siteify.swift.html#199_27' title='usrString1'>lines</a></span>[<span class='identifier'><a name='200_37' href='Siteify.swift.html#193_44' title='usrString1'>line</a></span>]
<span class=linenum>0201</span>                                .<span class='identifier'>replacingOccurrences</span>(<span class='identifier'>of</span>: <span class='string'>"&amp;"</span>, <span class='identifier'>with</span>: <span class='string'>"&amp;amp;"</span>)
<span class=linenum>0202</span>                                .<span class='identifier'>replacingOccurrences</span>(<span class='identifier'>of</span>: <span class='string'>"&lt;"</span>, <span class='identifier'>with</span>: <span class='string'>"&amp;lt;"</span>)
<span class=linenum>0203</span>                        }
<span class=linenum>0204</span>                        <span class='keyword'>return</span> <span class='string'>""</span>
<span class=linenum>0205</span>                    }
<span class=linenum>0206</span>    
<span class=linenum>0207</span>                    <span class='keyword'>let</span> <span class='identifier'><a name='207_20' title='usrString3'>resp</a></span> = <span class='keyword'>self</span>.<span class='identifier'><a name='207_32' href='Siteify.swift.html#84_8' title='usrString1'>sourceKit</a></span>.<span class='identifier'><a name='207_42' href='SourceKit.swift.html#291_16' title='usrString1'>syntaxMap</a></span>(<span class='identifier'>filePath</span>: <span class='identifier'><a name='207_62' href='Siteify.swift.html#152_28' title='usrString1'>path</a></span>)
<span class=linenum>0208</span>                    <span class='keyword'>let</span> <span class='identifier'><a name='208_20' title='usrString3'>dict</a></span> = <span class='identifier'><a name='208_27' href='SourceKit.swift.html#167_11' title='usrString1'>SKApi</a></span>.<span class='identifier'><a name='208_33' href='SourceKit.swift.html#131_20' title='usrString1'>response_get_value</a></span>(<span class='identifier'><a name='208_52' href='Siteify.swift.html#207_20' title='usrString1'>resp</a></span>)
<span class=linenum>0209</span>                    <span class='keyword'>let</span> <span class='identifier'><a name='209_20' title='usrString3'>syntaxMap</a></span> = <span class='identifier'><a name='209_32' href='SourceKit.swift.html#167_11' title='usrString1'>SKApi</a></span>.<span class='identifier'><a name='209_38' href='SourceKit.swift.html#133_20' title='usrString1'>variant_dictionary_get_value</a></span>( <span class='identifier'><a name='209_68' href='Siteify.swift.html#208_20' title='usrString1'>dict</a></span>, <span class='keyword'>self</span>.<span class='identifier'><a name='209_79' href='Siteify.swift.html#84_8' title='usrString1'>sourceKit</a></span>.<span class='identifier'><a name='209_89' href='SourceKit.swift.html#191_20' title='usrString1'>syntaxID</a></span> )
<span class=linenum>0210</span>                    <span class='keyword'>var</span> <span class='identifier'><a name='210_20' title='usrString3'>html</a></span> = (<span class='number'>0</span>..&lt;<span class='identifier'><a name='210_32' href='SourceKit.swift.html#167_11' title='usrString1'>SKApi</a></span>.<span class='identifier'><a name='210_38' href='SourceKit.swift.html#139_20' title='usrString1'>variant_array_get_count</a></span>(<span class='identifier'><a name='210_62' href='Siteify.swift.html#209_20' title='usrString1'>syntaxMap</a></span>))
<span class=linenum>0211</span>                        .<span class='identifier'>map</span> { (<span class='identifier'><a name='211_28' title='usrString3'>index</a></span>: <span class='typeidentifier'>Int</span>) -> (<span class='typeidentifier'>String</span>, <span class='typeidentifier'><a name='211_52' href='sourcekitd.h.html#336_8' title='usrString1'>sourcekitd_variant_t</a></span>, <span class='typeidentifier'>Position</span>, <span class='typeidentifier'>String</span>) <span class='keyword'>in</span>
<span class=linenum>0212</span>                            <span class='keyword'>let</span> <span class='identifier'><a name='212_28' title='usrString3'>dict</a></span> = <span class='identifier'><a name='212_35' href='SourceKit.swift.html#167_11' title='usrString1'>SKApi</a></span>.<span class='identifier'><a name='212_41' href='SourceKit.swift.html#140_20' title='usrString1'>variant_array_get_value</a></span>(<span class='identifier'><a name='212_65' href='Siteify.swift.html#209_20' title='usrString1'>syntaxMap</a></span>, <span class='identifier'><a name='212_76' href='Siteify.swift.html#211_28' title='usrString1'>index</a></span>)
<span class=linenum>0213</span>                            <span class='keyword'>let</span> <span class='identifier'><a name='213_28' title='usrString3'>offset</a></span> = <span class='identifier'><a name='213_37' href='Siteify.swift.html#212_28' title='usrString1'>dict</a></span>.<span class='identifier'><a name='213_42' href='SourceKit.swift.html#28_9' title='usrString1'>getInt</a></span>(<span class='identifier'><a name='213_49' href='SourceKit.swift.html#28_9' title='usrString1'>key</a></span>: <span class='keyword'>self</span>.<span class='identifier'><a name='213_59' href='Siteify.swift.html#84_8' title='usrString1'>sourceKit</a></span>.<span class='identifier'><a name='213_69' href='SourceKit.swift.html#183_20' title='usrString1'>offsetID</a></span>)
<span class=linenum>0214</span>                            <span class='keyword'>let</span> <span class='identifier'><a name='214_28' title='usrString3'>length</a></span> = <span class='identifier'><a name='214_37' href='Siteify.swift.html#212_28' title='usrString1'>dict</a></span>.<span class='identifier'><a name='214_42' href='SourceKit.swift.html#28_9' title='usrString1'>getInt</a></span>(<span class='identifier'><a name='214_49' href='SourceKit.swift.html#28_9' title='usrString1'>key</a></span>: <span class='keyword'>self</span>.<span class='identifier'><a name='214_59' href='Siteify.swift.html#84_8' title='usrString1'>sourceKit</a></span>.<span class='identifier'><a name='214_69' href='SourceKit.swift.html#200_20' title='usrString1'>lengthID</a></span>)
<span class=linenum>0215</span>                            <span class='keyword'>let</span> <span class='identifier'><a name='215_28' title='usrString3'>pre</a></span> = <span class='identifier'><a name='215_34' href='Siteify.swift.html#170_21' title='usrString1'>skipTo</a></span>(<span class='identifier'><a name='215_41' href='Siteify.swift.html#170_21' title='usrString1'>offset</a></span>: <span class='identifier'><a name='215_49' href='Siteify.swift.html#213_28' title='usrString1'>offset</a></span>)
<span class=linenum>0216</span>                            <span class='keyword'>let</span> <span class='identifier'><a name='216_28' title='usrString3'>pos</a></span> = <span class='identifier'>Position</span>(<span class='identifier'>line</span>: <span class='identifier'><a name='216_49' href='Siteify.swift.html#168_44' title='usrString1'>lineno</a></span>, <span class='identifier'>character</span>: <span class='identifier'><a name='216_68' href='Siteify.swift.html#168_56' title='usrString1'>col</a></span>)
<span class=linenum>0217</span>                            <span class='keyword'>let</span> <span class='identifier'><a name='217_28' title='usrString3'>text</a></span> = <span class='identifier'><a name='217_35' href='Siteify.swift.html#170_21' title='usrString1'>skipTo</a></span>(<span class='identifier'><a name='217_42' href='Siteify.swift.html#170_21' title='usrString1'>offset</a></span>: <span class='identifier'><a name='217_50' href='Siteify.swift.html#213_28' title='usrString1'>offset</a></span>+<span class='identifier'><a name='217_57' href='Siteify.swift.html#214_28' title='usrString1'>length</a></span>)
<span class=linenum>0218</span>                            <span class='keyword'>return</span> (<span class='identifier'><a name='218_32' href='Siteify.swift.html#215_28' title='usrString1'>pre</a></span>, <span class='identifier'><a name='218_37' href='Siteify.swift.html#212_28' title='usrString1'>dict</a></span>, <span class='identifier'><a name='218_43' href='Siteify.swift.html#216_28' title='usrString1'>pos</a></span>, <span class='identifier'><a name='218_48' href='Siteify.swift.html#217_28' title='usrString1'>text</a></span>)
<span class=linenum>0219</span>                    }.<span class='identifier'><a name='219_18' href='Parallelize.swift.html#18_9' title='usrString1'>concurrentMap</a></span>(<span class='identifier'>maxConcurrency</span>: <span class='number'>1</span>
<span class=linenum>0220</span>                                    <span class='comment'>/* cannot multithread per file */</span>) {
<span class=linenum>0221</span>                        (<span class='identifier'><a name='221_21' title='usrString3'>arg0</a></span>, <span class='identifier'><a name='221_27' title='usrString3'>completion</a></span>: <span class='builtin'>@escaping</span> (<span class='typeidentifier'>String</span>) -> <span class='typeidentifier'>Void</span>) <span class='keyword'>in</span>
<span class=linenum>0222</span>                        <span class='keyword'>let</span> (<span class='identifier'><a name='222_25' title='usrString3'>pre</a></span>, <span class='identifier'><a name='222_30' title='usrString3'>dict</a></span>, <span class='identifier'><a name='222_36' title='usrString3'>pos</a></span>, <span class='identifier'><a name='222_41' title='usrString3'>text</a></span>) = <span class='identifier'><a name='222_49' href='Siteify.swift.html#221_21' title='usrString1'>arg0</a></span>
<span class=linenum>0223</span>                        <span class='keyword'>let</span> <span class='identifier'><a name='223_24' title='usrString3'>kind</a></span> = <span class='identifier'><a name='223_31' href='Siteify.swift.html#222_30' title='usrString1'>dict</a></span>.<span class='identifier'>getUUIDString</span>(<span class='identifier'>key</span>: <span class='keyword'>self</span>.<span class='identifier'>sourceKit</span>.<span class='identifier'>kindID</span>)
<span class=linenum>0224</span>                        <span class='keyword'>let</span> <span class='identifier'><a name='224_24' title='usrString3'>kindID</a></span> = <span class='identifier'><a name='224_33' href='SourceKit.swift.html#167_11' title='usrString1'>SKApi</a></span>.<span class='identifier'>variant_dictionary_get_uid</span>(<span class='identifier'><a name='224_66' href='Siteify.swift.html#222_30' title='usrString1'>dict</a></span>, <span class='keyword'>self</span>.<span class='identifier'>sourceKit</span>.<span class='identifier'>kindID</span>)
<span class=linenum>0225</span>                        <span class='keyword'>let</span> <span class='identifier'><a name='225_24' title='usrString3'>kindSuffix</a></span> = <span class='identifier'>NSURL</span>(<span class='identifier'>fileURLWithPath</span>: <span class='identifier'><a name='225_60' href='Siteify.swift.html#223_24' title='usrString1'>kind</a></span>).<span class='identifier'>pathExtension</span>!
<span class=linenum>0226</span>                        <span class='keyword'>let</span> <span class='identifier'><a name='226_24' title='usrString3'>completion2</a></span> = { (<span class='identifier'><a name='226_41' title='usrString3'>span</a></span>: <span class='typeidentifier'>String</span>) <span class='keyword'>in</span>
<span class=linenum>0227</span>                            <span class='identifier'><a name='227_24' href='Siteify.swift.html#221_27' title='usrString1'>completion</a></span>(<span class='string'>"</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='227_38' href='Siteify.swift.html#222_25' title='usrString1'>pre</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>&lt;span class='</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='227_57' href='Siteify.swift.html#225_24' title='usrString1'>kindSuffix</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>'></span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='227_72' href='Siteify.swift.html#226_41' title='usrString1'>span</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>&lt;/span>"</span>)
<span class=linenum>0228</span>                        }
<span class=linenum>0229</span>    
<span class=linenum>0230</span>                        <span class='keyword'>if</span> <span class='identifier'><a name='230_23' href='Siteify.swift.html#225_24' title='usrString1'>kindSuffix</a></span> == <span class='string'>"url"</span> {
<span class=linenum>0231</span>                            <span class='keyword'>return</span> <span class='identifier'><a name='231_31' href='Siteify.swift.html#226_24' title='usrString1'>completion2</a></span>(<span class='string'>"&lt;a href='</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='231_55' href='Siteify.swift.html#222_41' title='usrString1'>text</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>'></span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='231_64' href='Siteify.swift.html#222_41' title='usrString1'>text</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>&lt;/a>"</span>)
<span class=linenum>0232</span>                        }
<span class=linenum>0233</span>                        <span class='keyword'>guard</span> <span class='identifier'><a name='233_26' href='Siteify.swift.html#224_24' title='usrString1'>kindID</a></span> == <span class='keyword'>self</span>.<span class='identifier'>sourceKit</span>.<span class='identifier'>identifierID</span> ||
<span class=linenum>0234</span>                            <span class='identifier'><a name='234_24' href='Siteify.swift.html#224_24' title='usrString1'>kindID</a></span> == <span class='keyword'>self</span>.<span class='identifier'>sourceKit</span>.<span class='identifier'>typeID</span> <span class='keyword'>else</span> {
<span class=linenum>0235</span>                            <span class='keyword'>return</span> <span class='identifier'><a name='235_31' href='Siteify.swift.html#226_24' title='usrString1'>completion2</a></span>(<span class='identifier'><a name='235_43' href='Siteify.swift.html#222_41' title='usrString1'>text</a></span>)
<span class=linenum>0236</span>                        }
<span class=linenum>0237</span>    
<span class=linenum>0238</span>                        <span class='keyword'>let</span> <span class='identifier'><a name='238_24' title='usrString3'>docPos</a></span> = <span class='identifier'>TextDocumentPositionParams</span>(<span class='identifier'>textDocument</span>: <span class='identifier'>TextDocumentIdentifier</span>(<span class='identifier'>path</span>: <span class='identifier'><a name='238_103' href='Siteify.swift.html#152_28' title='usrString1'>path</a></span>), <span class='identifier'>position</span>: <span class='identifier'><a name='238_120' href='Siteify.swift.html#222_36' title='usrString1'>pos</a></span>)
<span class=linenum>0239</span>                        <span class='keyword'>self</span>.<span class='identifier'>lspServer</span>.<span class='identifier'>definition</span>(<span class='identifier'>params</span>: <span class='identifier'><a name='239_54' href='Siteify.swift.html#238_24' title='usrString1'>docPos</a></span>) { <span class='identifier'><a name='239_64' title='usrString3'>result</a></span> <span class='keyword'>in</span>
<span class=linenum>0240</span>                            <span class='keyword'>switch</span> <span class='identifier'><a name='240_31' href='Siteify.swift.html#239_64' title='usrString1'>result</a></span> {
<span class=linenum>0241</span>                            <span class='keyword'>case</span> .<span class='identifier'>success</span>(<span class='keyword'>let</span> <span class='identifier'><a name='241_42' title='usrString3'>value</a></span>):
<span class=linenum>0242</span>                                <span class='keyword'>switch</span> <span class='identifier'><a name='242_35' href='Siteify.swift.html#241_42' title='usrString1'>value</a></span> {
<span class=linenum>0243</span>                                <span class='keyword'>case</span> .<span class='identifier'>locationArray</span>(<span class='keyword'>let</span> <span class='identifier'><a name='243_52' title='usrString3'>a</a></span>) <span class='keyword'>where</span> <span class='identifier'><a name='243_61' href='Siteify.swift.html#243_52' title='usrString1'>a</a></span>.<span class='identifier'>count</span> > <span class='number'>0</span>:
<span class=linenum>0244</span>                                    <span class='keyword'>let</span> <span class='identifier'><a name='244_36' title='usrString3'>decl</a></span> = <span class='identifier'><a name='244_43' href='Siteify.swift.html#243_52' title='usrString1'>a</a></span>.<span class='identifier'>first</span>!
<span class=linenum>0245</span>                                    <span class='keyword'>if</span> <span class='identifier'><a name='245_35' href='Siteify.swift.html#244_36' title='usrString1'>decl</a></span>.<span class='identifier'>file</span> == <span class='identifier'><a name='245_48' href='Siteify.swift.html#152_28' title='usrString1'>path</a></span> &amp;&amp; <span class='identifier'><a name='245_56' href='Siteify.swift.html#244_36' title='usrString1'>decl</a></span>.<span class='identifier'>range</span>.<span class='identifier'>start</span> == <span class='identifier'><a name='245_76' href='Siteify.swift.html#222_36' title='usrString1'>pos</a></span> {
<span class=linenum>0246</span>                                        <span class='keyword'>self</span>.<span class='identifier'>lspServer</span>.<span class='identifier'>references</span>(<span class='identifier'>params</span>: <span class='identifier'>ReferenceParams</span>(<span class='identifier'>textDocument</span>: <span class='identifier'>TextDocumentIdentifier</span>(<span class='identifier'>path</span>: <span class='identifier'><a name='246_129' href='Siteify.swift.html#152_28' title='usrString1'>path</a></span>), <span class='identifier'>position</span>: <span class='identifier'><a name='246_146' href='Siteify.swift.html#222_36' title='usrString1'>pos</a></span>, <span class='identifier'>context</span>: <span class='identifier'>ReferenceContext</span>(<span class='identifier'>includeDeclaration</span>: <span class='keyword'>false</span>))) {
<span class=linenum>0247</span>                                            <span class='identifier'><a name='247_40' title='usrString3'>result</a></span> <span class='keyword'>in</span>
<span class=linenum>0248</span>                                            <span class='keyword'>switch</span> <span class='identifier'><a name='248_47' href='Siteify.swift.html#247_40' title='usrString1'>result</a></span> {
<span class=linenum>0249</span>                                            <span class='keyword'>case</span> .<span class='identifier'>success</span>(<span class='keyword'>let</span> <span class='identifier'><a name='249_58' title='usrString3'>refs</a></span>):
<span class=linenum>0250</span>                                                <span class='keyword'>if</span> <span class='keyword'>let</span> <span class='identifier'><a name='250_51' title='usrString3'>refs</a></span> = <span class='identifier'><a name='250_58' href='Siteify.swift.html#249_58' title='usrString1'>refs</a></span>, <span class='identifier'><a name='250_64' href='Siteify.swift.html#250_51' title='usrString1'>refs</a></span>.<span class='identifier'>count</span> > <span class='number'>0</span> &amp;&amp;
<span class=linenum>0251</span>                                                    <span class='identifier'><a name='251_48' href='Siteify.swift.html#244_36' title='usrString1'>decl</a></span>.<span class='identifier'>file</span>.<span class='identifier'>starts</span>(<span class='identifier'>with</span>: <span class='keyword'>self</span>.<span class='identifier'>projectRoot</span>.<span class='identifier'>path</span>) {
<span class=linenum>0252</span>                                                    <span class='keyword'>var</span> <span class='identifier'><a name='252_52' title='usrString3'>popup</a></span> = <span class='string'>""</span>
<span class=linenum>0253</span>                                                    <span class='keyword'>for</span> <span class='identifier'><a name='253_52' title='usrString3'>ref</a></span> <span class='keyword'>in</span> <span class='identifier'><a name='253_59' href='Siteify.swift.html#250_51' title='usrString1'>refs</a></span> {
<span class=linenum>0254</span>                                                        <span class='keyword'>let</span> <span class='identifier'><a name='254_56' title='usrString3'>keepListOpen</a></span> = <span class='identifier'><a name='254_71' href='Siteify.swift.html#253_52' title='usrString1'>ref</a></span>.<span class='identifier'>file</span> != <span class='identifier'><a name='254_83' href='Siteify.swift.html#244_36' title='usrString1'>decl</a></span>.<span class='identifier'>file</span> ? <span class='string'>"event.stopPropagation(); "</span> : <span class='string'>""</span>
<span class=linenum>0255</span>                                                        <span class='keyword'>if</span> <span class='identifier'><a name='255_55' href='Siteify.swift.html#253_52' title='usrString1'>ref</a></span>.<span class='identifier'>href</span> == <span class='identifier'><a name='255_67' href='Siteify.swift.html#244_36' title='usrString1'>decl</a></span>.<span class='identifier'>href</span> {
<span class=linenum>0256</span>                                                            <span class='keyword'>continue</span>
<span class=linenum>0257</span>                                                        }
<span class=linenum>0258</span>                                                        <span class='identifier'><a name='258_52' href='Siteify.swift.html#252_52' title='usrString1'>popup</a></span> += <span class='string'>"&lt;tr>&lt;td style='text-decoration: underline;' onclick='document.location.href=\"</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='258_142' href='Siteify.swift.html#253_52' title='usrString1'>ref</a></span>.<span class='identifier'>href</span><span class='string_interpolation_anchor'>)</span><span class='string'>\"; </span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='258_157' href='Siteify.swift.html#254_56' title='usrString1'>keepListOpen</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>return false;'></span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='258_187' href='Siteify.swift.html#253_52' title='usrString1'>ref</a></span>.<span class='identifier'>filebase</span><span class='string_interpolation_anchor'>)</span><span class='string'>:</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='258_203' href='Siteify.swift.html#253_52' title='usrString1'>ref</a></span>.<span class='identifier'>line</span>+<span class='number'>1</span><span class='string_interpolation_anchor'>)</span><span class='string'>&lt;/td>"</span>
<span class=linenum>0259</span>                                                        <span class='identifier'><a name='259_52' href='Siteify.swift.html#252_52' title='usrString1'>popup</a></span> += <span class='string'>"&lt;td>&lt;pre></span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'>reflines</span>(<span class='identifier'>file</span>: <span class='identifier'><a name='259_88' href='Siteify.swift.html#253_52' title='usrString1'>ref</a></span>.<span class='identifier'>file</span>, <span class='identifier'>line</span>: <span class='identifier'><a name='259_104' href='Siteify.swift.html#253_52' title='usrString1'>ref</a></span>.<span class='identifier'>line</span>)<span class='string_interpolation_anchor'>)</span><span class='string'>&lt;/pre>&lt;/td>"</span>
<span class=linenum>0260</span>                                                    }
<span class=linenum>0261</span>                                                    <span class='identifier'><a name='261_48' href='Siteify.swift.html#226_24' title='usrString1'>completion2</a></span>(<span class='string'>"&lt;a name='</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='261_72' href='Siteify.swift.html#244_36' title='usrString1'>decl</a></span>.<span class='identifier'>anchor</span><span class='string_interpolation_anchor'>)</span><span class='string'>' </span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='261_88' href='Siteify.swift.html#252_52' title='usrString1'>popup</a></span> != <span class='string'>""</span> ? <span class='string'>"href='#' "</span> : <span class='string'>""</span><span class='string_interpolation_anchor'>)</span><span class='string'>title='</span>\<span class='string_interpolation_anchor'>(</span><span class='string'>"usrString2"</span><span class='string_interpolation_anchor'>)</span><span class='string'>' onclick='return expand(this);'>"</span> +
<span class=linenum>0262</span>                                                        <span class='string'>"</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='262_55' href='Siteify.swift.html#222_41' title='usrString1'>text</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>&lt;span class='references'>&lt;table></span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='262_94' href='Siteify.swift.html#252_52' title='usrString1'>popup</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>&lt;/table>&lt;/span>&lt;/a>"</span>)
<span class=linenum>0263</span>                                                } <span class='keyword'>else</span> {
<span class=linenum>0264</span>                                                    <span class='identifier'><a name='264_48' href='Siteify.swift.html#226_24' title='usrString1'>completion2</a></span>(<span class='string'>"&lt;a name='</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='264_72' href='Siteify.swift.html#244_36' title='usrString1'>decl</a></span>.<span class='identifier'>anchor</span><span class='string_interpolation_anchor'>)</span><span class='string'>' title='</span>\<span class='string_interpolation_anchor'>(</span><span class='string'>"usrString3"</span><span class='string_interpolation_anchor'>)</span><span class='string'>'></span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='264_112' href='Siteify.swift.html#222_41' title='usrString1'>text</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>&lt;/a>"</span>)
<span class=linenum>0265</span>                                                }
<span class=linenum>0266</span>                                            <span class='keyword'>case</span> .<span class='identifier'>failure</span>(<span class='keyword'>let</span> <span class='identifier'><a name='266_58' title='usrString3'>err</a></span>):
<span class=linenum>0267</span>                                                <span class='keyword'>return</span> <span class='identifier'><a name='267_51' href='Siteify.swift.html#226_24' title='usrString1'>completion2</a></span>(<span class='string'>"&lt;span title='</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='267_79' href='Siteify.swift.html#266_58' title='usrString1'>err</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>'>#ERROR </span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='267_94' href='Siteify.swift.html#222_41' title='usrString1'>text</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>&lt;/span>"</span>)
<span class=linenum>0268</span>                                            }
<span class=linenum>0269</span>                                        }
<span class=linenum>0270</span>                                    } <span class='keyword'>else</span> <span class='keyword'>if</span> <span class='identifier'><a name='270_42' href='Siteify.swift.html#244_36' title='usrString1'>decl</a></span>.<span class='identifier'>file</span>.<span class='identifier'>starts</span>(<span class='identifier'>with</span>: <span class='keyword'>self</span>.<span class='identifier'>projectRoot</span>.<span class='identifier'>path</span>) {
<span class=linenum>0271</span>                                        <span class='identifier'><a name='271_36' href='Siteify.swift.html#226_24' title='usrString1'>completion2</a></span>(<span class='string'>"&lt;a name='</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='271_60' href='Siteify.swift.html#222_36' title='usrString1'>pos</a></span>.<span class='identifier'>anchor</span><span class='string_interpolation_anchor'>)</span><span class='string'>' href='</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='271_81' href='Siteify.swift.html#244_36' title='usrString1'>decl</a></span>.<span class='identifier'>href</span><span class='string_interpolation_anchor'>)</span><span class='string'>' title='</span>\<span class='string_interpolation_anchor'>(</span><span class='string'>"usrString1"</span><span class='string_interpolation_anchor'>)</span><span class='string'>'></span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='271_119' href='Siteify.swift.html#222_41' title='usrString1'>text</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>&lt;/a>"</span>)
<span class=linenum>0272</span>                                    } <span class='keyword'>else</span> {
<span class=linenum>0273</span>                                        <span class='identifier'><a name='273_36' href='Siteify.swift.html#226_24' title='usrString1'>completion2</a></span>(<span class='identifier'><a name='273_48' href='Siteify.swift.html#222_41' title='usrString1'>text</a></span>)
<span class=linenum>0274</span>                                    }
<span class=linenum>0275</span>                                <span class='keyword'>default</span>:
<span class=linenum>0276</span>                                    <span class='identifier'><a name='276_32' href='Siteify.swift.html#226_24' title='usrString1'>completion2</a></span>(<span class='identifier'><a name='276_44' href='Siteify.swift.html#222_41' title='usrString1'>text</a></span>)
<span class=linenum>0277</span>                                    <span class='keyword'>break</span>
<span class=linenum>0278</span>                                }
<span class=linenum>0279</span>    
<span class=linenum>0280</span>                            <span class='keyword'>case</span> .<span class='identifier'>failure</span>(<span class='keyword'>let</span> <span class='identifier'><a name='280_42' title='usrString3'>err</a></span>):
<span class=linenum>0281</span>                                <span class='keyword'>return</span> <span class='identifier'><a name='281_35' href='Siteify.swift.html#226_24' title='usrString1'>completion2</a></span>(<span class='string'>"&lt;span title='</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='281_63' href='Siteify.swift.html#280_42' title='usrString1'>err</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>'>#ERROR </span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='281_78' href='Siteify.swift.html#222_41' title='usrString1'>text</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>&lt;/span>"</span>)
<span class=linenum>0282</span>                            }
<span class=linenum>0283</span>                        }
<span class=linenum>0284</span>                    }.<span class='identifier'>joined</span>() + <span class='identifier'><a name='284_29' href='Siteify.swift.html#170_21' title='usrString1'>skipTo</a></span>(<span class='identifier'><a name='284_36' href='Siteify.swift.html#170_21' title='usrString1'>offset</a></span>: <span class='identifier'><a name='284_44' href='Siteify.swift.html#158_15' title='usrString1'>data</a></span>.<span class='identifier'>count</span>)
<span class=linenum>0285</span>    
<span class=linenum>0286</span>                    <span class='identifier'><a name='286_16' href='Siteify.swift.html#168_44' title='usrString1'>lineno</a></span> = <span class='number'>0</span>
<span class=linenum>0287</span>                    <span class='identifier'><a name='287_16' href='Siteify.swift.html#210_20' title='usrString1'>html</a></span>[<span class='string'>"(^|\n)"</span>] = { (<span class='identifier'><a name='287_36' title='usrString3'>groups</a></span>: [<span class='typeidentifier'>String</span>], <span class='identifier'><a name='287_54' title='usrString3'>stop</a></span>) -> <span class='typeidentifier'>String</span> <span class='keyword'>in</span>
<span class=linenum>0288</span>                        <span class='identifier'><a name='288_20' href='Siteify.swift.html#168_44' title='usrString1'>lineno</a></span> += <span class='number'>1</span>
<span class=linenum>0289</span>                        <span class='keyword'>return</span> <span class='identifier'><a name='289_27' href='Siteify.swift.html#287_36' title='usrString1'>groups</a></span>[<span class='number'>1</span>] + <span class='identifier'>String</span>(<span class='identifier'>format</span>: <span class='string'>"&lt;span class=linenum>%04d&lt;/span>    "</span>, <span class='identifier'><a name='289_93' href='Siteify.swift.html#168_44' title='usrString1'>lineno</a></span>)
<span class=linenum>0290</span>                    }
<span class=linenum>0291</span>    
<span class=linenum>0292</span>                    <span class='keyword'>let</span> <span class='identifier'><a name='292_20' title='usrString3'>htmlFILE</a></span> = <span class='identifier'><a name='292_31' href='Siteify.swift.html#311_9' title='usrString1'>copyTemplate</a></span>(<span class='identifier'><a name='292_44' href='Siteify.swift.html#311_9' title='usrString1'>template</a></span>: <span class='string'>"source.html"</span>, <span class='identifier'><a name='292_69' href='Siteify.swift.html#311_9' title='usrString1'>patches</a></span>: [<span class='string'>"__FILE__"</span>:
<span class=linenum>0293</span>                        <span class='identifier'><a name='293_20' href='Siteify.swift.html#152_28' title='usrString1'>path</a></span>.<span class='identifier'>replacingOccurrences</span>(<span class='identifier'>of</span>: <span class='identifier'><a name='293_50' href='Siteify.swift.html#87_8' title='usrString1'>projectRoot</a></span>.<span class='identifier'>path</span> + <span class='string'>"/"</span>, <span class='identifier'>with</span>: <span class='string'>""</span>)],
<span class=linenum>0294</span>                                           <span class='identifier'><a name='294_39' href='Siteify.swift.html#311_9' title='usrString1'>dest</a></span>: <span class='string'>"html/"</span>+<span class='identifier'><a name='294_53' href='Siteify.swift.html#154_12' title='usrString1'>htmlfile</a></span>)
<span class=linenum>0295</span>                    <span class='keyword'>_</span> = <span class='identifier'><a name='295_20' href='Siteify.swift.html#210_20' title='usrString1'>html</a></span>.<span class='identifier'>withCString</span> { <span class='identifier'>fputs</span>(<span class='identifier'><a name='295_45' href='Siteify.swift.html#295_37' title='usrString1'>$0</a></span>, <span class='identifier'><a name='295_49' href='Siteify.swift.html#292_20' title='usrString1'>htmlFILE</a></span>) }
<span class=linenum>0296</span>                    <span class='identifier'>fclose</span>(<span class='identifier'><a name='296_23' href='Siteify.swift.html#292_20' title='usrString1'>htmlFILE</a></span>)
<span class=linenum>0297</span>    
<span class=linenum>0298</span>                    <span class='identifier'><a name='298_16' href='SourceKit.swift.html#167_11' title='usrString1'>SKApi</a></span>.<span class='identifier'><a name='298_22' href='SourceKit.swift.html#127_20' title='usrString1'>response_dispose</a></span>(<span class='identifier'><a name='298_39' href='Siteify.swift.html#207_20' title='usrString1'>resp</a></span>)
<span class=linenum>0299</span>                    <span class='identifier'><a name='299_16' href='Siteify.swift.html#153_12' title='usrString1'>synchronizer</a></span>.<span class='identifier'>sync</span> {
<span class=linenum>0300</span>                        <span class='keyword'>self</span>.<span class='identifier'>lspServer</span>.<span class='identifier'>didCloseTextDocument</span>(<span class='identifier'>params</span>: <span class='identifier'>DidCloseTextDocumentParams</span>(<span class='identifier'>textDocument</span>: <span class='identifier'>TextDocumentIdentifier</span>(<span class='identifier'>path</span>: <span class='identifier'><a name='300_134' href='Siteify.swift.html#152_28' title='usrString1'>path</a></span>)), <span class='identifier'>block</span>: <span class='identifier'><a name='300_149' href='Siteify.swift.html#299_34' title='usrString1'>$0</a></span>)
<span class=linenum>0301</span>                    }
<span class=linenum>0302</span>                }
<span class=linenum>0303</span>            }
<span class=linenum>0304</span>    
<span class=linenum>0305</span>            <span class='identifier'><a name='305_8' href='Siteify.swift.html#44_5' title='usrString1'>progress</a></span>(<span class='identifier'><a name='305_17' href='Siteify.swift.html#44_5' title='usrString1'>str</a></span>: <span class='string'>"Saved html/</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='305_36' href='Siteify.swift.html#154_12' title='usrString1'>htmlfile</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>"</span>)
<span class=linenum>0306</span>        }
<span class=linenum>0307</span>    
<span class=linenum>0308</span>        <span class='keyword'>let</span> <span class='identifier'><a name='308_8' href='#' title='usrString2' onclick='return expand(this);'>home<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#137_66"; return false;'>Siteify.swift:137</td><td><pre>            "__ROOT__": projectRoot.path.replacingOccurrences(of: home, with: "~")])</pre></td></table></span></a></span> = <span class='identifier'>String</span>(<span class='identifier'>cString</span>: <span class='identifier'>getenv</span>(<span class='string'>"HOME"</span>))
<span class=linenum>0309</span>        <span class='keyword'>let</span> <span class='identifier'><a name='309_8' title='usrString2' onclick='return expand(this);'>resources<span class='references'><table></table></span></a></span> = <span class='identifier'>String</span>(<span class='identifier'>cString</span>: <span class='identifier'>getenv</span>(<span class='string'>"HOME"</span>))+<span class='string'>"/Library/siteify/"</span>
<span class=linenum>0310</span>    
<span class=linenum>0311</span>        <span class='keyword'>func</span> <span class='identifier'><a name='311_9' href='#' title='usrString2' onclick='return expand(this);'>copyTemplate<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#134_15"; return false;'>Siteify.swift:134</td><td><pre>        fclose(copyTemplate(template: "siteify.css"))</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#135_20"; return false;'>Siteify.swift:135</td><td><pre>        indexFILE = copyTemplate(template: "index.html", patches: [</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#292_31"; return false;'>Siteify.swift:292</td><td><pre>                let htmlFILE = copyTemplate(template: "source.html", patches: ["__FILE__":</pre></td></table></span></a></span>(<span class='identifier'><a name='311_22' href='#' title='usrString2' onclick='return expand(this);'>template<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#312_35"; return false;'>Siteify.swift:312</td><td><pre>        var input = Self.resources[template]!</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#316_40"; return false;'>Siteify.swift:316</td><td><pre>        let out = fopen(dest ?? "html/"+template, "w")!</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>, <span class='identifier'><a name='311_40' href='#' title='usrString2' onclick='return expand(this);'>patches<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#313_28"; return false;'>Siteify.swift:313</td><td><pre>        for (tag, value) in patches {</pre></td></table></span></a></span>: [<span class='typeidentifier'>String</span>:<span class='typeidentifier'>String</span>] = [:], <span class='identifier'><a name='311_72' href='#' title='usrString2' onclick='return expand(this);'>dest<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Siteify.swift.html#316_24"; return false;'>Siteify.swift:316</td><td><pre>        let out = fopen(dest ?? "html/"+template, "w")!</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>? = <span class='keyword'>nil</span>) -> <span class='typeidentifier'>UnsafeMutablePointer</span>&lt;<span class='typeidentifier'>FILE</span>> {
<span class=linenum>0312</span>            <span class='keyword'>var</span> <span class='identifier'><a name='312_12' title='usrString3'>input</a></span> = <span class='keyword'>Self</span>.<span class='identifier'><a name='312_25' href='Resources.swift.html#10_15' title='usrString1'>resources</a></span>[<span class='identifier'><a name='312_35' href='Siteify.swift.html#311_22' title='usrString1'>template</a></span>]!
<span class=linenum>0313</span>            <span class='keyword'>for</span> (<span class='identifier'><a name='313_13' title='usrString3'>tag</a></span>, <span class='identifier'><a name='313_18' title='usrString3'>value</a></span>) <span class='keyword'>in</span> <span class='identifier'><a name='313_28' href='Siteify.swift.html#311_40' title='usrString1'>patches</a></span> {
<span class=linenum>0314</span>                <span class='identifier'><a name='314_12' href='Siteify.swift.html#312_12' title='usrString1'>input</a></span> = <span class='identifier'><a name='314_20' href='Siteify.swift.html#312_12' title='usrString1'>input</a></span>.<span class='identifier'>replacingOccurrences</span>(<span class='identifier'>of</span>: <span class='identifier'><a name='314_51' href='Siteify.swift.html#313_13' title='usrString1'>tag</a></span>, <span class='identifier'>with</span>: <span class='identifier'><a name='314_62' href='Siteify.swift.html#313_18' title='usrString1'>value</a></span>)
<span class=linenum>0315</span>            }
<span class=linenum>0316</span>            <span class='keyword'>let</span> <span class='identifier'><a name='316_12' title='usrString3'>out</a></span> = <span class='identifier'>fopen</span>(<span class='identifier'><a name='316_24' href='Siteify.swift.html#311_72' title='usrString1'>dest</a></span> ?? <span class='string'>"html/"</span>+<span class='identifier'><a name='316_40' href='Siteify.swift.html#311_22' title='usrString1'>template</a></span>, <span class='string'>"w"</span>)!
<span class=linenum>0317</span>            <span class='keyword'>_</span> = <span class='identifier'><a name='317_12' href='Siteify.swift.html#312_12' title='usrString1'>input</a></span>.<span class='identifier'>withCString</span> {
<span class=linenum>0318</span>                <span class='identifier'>fputs</span>(<span class='identifier'><a name='318_18' href='Siteify.swift.html#317_30' title='usrString1'>$0</a></span>, <span class='identifier'><a name='318_22' href='Siteify.swift.html#316_12' title='usrString1'>out</a></span>)
<span class=linenum>0319</span>            }
<span class=linenum>0320</span>            <span class='keyword'>return</span> <span class='identifier'><a name='320_15' href='Siteify.swift.html#316_12' title='usrString1'>out</a></span>
<span class=linenum>0321</span>        }
<span class=linenum>0322</span>    
<span class=linenum>0323</span>        <span class='builtin'>public</span> <span class='keyword'>func</span> <span class='identifier'><a name='323_16' title='usrString3'>languageServerInitialized</a></span>(<span class='keyword'>_</span> <span class='identifier'><a name='323_44' title='usrString3'>server</a></span>: <span class='typeidentifier'>LanguageServer</span>) {
<span class=linenum>0324</span>        }
<span class=linenum>0325</span>    
<span class=linenum>0326</span>        <span class='builtin'>public</span> <span class='keyword'>func</span> <span class='identifier'><a name='326_16' title='usrString3'>languageServer</a></span>(<span class='keyword'>_</span> <span class='identifier'><a name='326_33' title='usrString3'>server</a></span>: <span class='typeidentifier'>LanguageServer</span>, <span class='identifier'><a name='326_57' href='Siteify.swift.html#326_16' title='usrString1'>logMessage</a></span> <span class='identifier'><a name='326_68' title='usrString3'>message</a></span>: <span class='typeidentifier'>LogMessageParams</span>) {
<span class=linenum>0327</span>            <span class='keyword'>if</span> !<span class='identifier'><a name='327_12' href='Siteify.swift.html#326_68' title='usrString1'>message</a></span>.<span class='identifier'>message</span>.<span class='identifier'>starts</span>(<span class='identifier'>with</span>: <span class='string'>"could not open compilation"</span>) {
<span class=linenum>0328</span>                <span class='identifier'>NSLog</span>(<span class='string'>"logMessage: </span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='328_33' href='Siteify.swift.html#326_68' title='usrString1'>message</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>"</span>)
<span class=linenum>0329</span>            }
<span class=linenum>0330</span>        }
<span class=linenum>0331</span>    
<span class=linenum>0332</span>        <span class='builtin'>public</span> <span class='keyword'>func</span> <span class='identifier'><a name='332_16' title='usrString3'>languageServer</a></span>(<span class='keyword'>_</span> <span class='identifier'><a name='332_33' title='usrString3'>server</a></span>: <span class='typeidentifier'>LanguageServer</span>, <span class='identifier'><a name='332_57' href='Siteify.swift.html#332_16' title='usrString1'>showMessage</a></span> <span class='identifier'><a name='332_69' title='usrString3'>message</a></span>: <span class='typeidentifier'>ShowMessageParams</span>) {
<span class=linenum>0333</span>            <span class='identifier'>NSLog</span>(<span class='string'>"showMessage: </span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='333_30' href='Siteify.swift.html#332_69' title='usrString1'>message</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>"</span>)
<span class=linenum>0334</span>        }
<span class=linenum>0335</span>    
<span class=linenum>0336</span>        <span class='builtin'>public</span> <span class='keyword'>func</span> <span class='identifier'><a name='336_16' title='usrString3'>languageServer</a></span>(<span class='keyword'>_</span> <span class='identifier'><a name='336_33' title='usrString3'>server</a></span>: <span class='typeidentifier'>LanguageServer</span>, <span class='identifier'><a name='336_57' href='Siteify.swift.html#336_16' title='usrString1'>showMessageRequest</a></span> <span class='identifier'><a name='336_76' title='usrString3'>messageRequest</a></span>: <span class='typeidentifier'>ShowMessageRequestParams</span>) {
<span class=linenum>0337</span>            <span class='identifier'>NSLog</span>(<span class='string'>"showMessageRequest: </span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='337_37' href='Siteify.swift.html#336_76' title='usrString1'>messageRequest</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>"</span>)
<span class=linenum>0338</span>        }
<span class=linenum>0339</span>    
<span class=linenum>0340</span>        <span class='builtin'>public</span> <span class='keyword'>func</span> <span class='identifier'><a name='340_16' title='usrString3'>languageServer</a></span>(<span class='keyword'>_</span> <span class='identifier'><a name='340_33' title='usrString3'>server</a></span>: <span class='typeidentifier'>LanguageServer</span>, <span class='identifier'><a name='340_57' href='Siteify.swift.html#340_16' title='usrString1'>publishDiagnostics</a></span> <span class='identifier'><a name='340_76' title='usrString3'>diagnosticsParams</a></span>: <span class='typeidentifier'>PublishDiagnosticsParams</span>) {
<span class=linenum>0341</span>            <span class='keyword'>if</span> <span class='identifier'><a name='341_11' href='Siteify.swift.html#340_76' title='usrString1'>diagnosticsParams</a></span>.<span class='identifier'>diagnostics</span>.<span class='identifier'>count</span> > <span class='number'>1</span> {
<span class=linenum>0342</span>                <span class='identifier'>NSLog</span>(<span class='string'>"publishDiagnostics: </span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='342_41' href='Siteify.swift.html#340_76' title='usrString1'>diagnosticsParams</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>"</span>)
<span class=linenum>0343</span>            }
<span class=linenum>0344</span>        }
<span class=linenum>0345</span>    
<span class=linenum>0346</span>        <span class='builtin'>public</span> <span class='keyword'>func</span> <span class='identifier'><a name='346_16' title='usrString3'>languageServer</a></span>(<span class='keyword'>_</span> <span class='identifier'><a name='346_33' title='usrString3'>server</a></span>: <span class='typeidentifier'>LanguageServer</span>, <span class='identifier'><a name='346_57' href='Siteify.swift.html#346_16' title='usrString1'>failedToDecodeNotification</a></span> <span class='identifier'><a name='346_84' title='usrString3'>notificationName</a></span>: <span class='typeidentifier'>String</span>, <span class='identifier'><a name='346_110' href='Siteify.swift.html#346_16' title='usrString1'>with</a></span> <span class='identifier'><a name='346_115' title='usrString3'>error</a></span>: <span class='typeidentifier'>Error</span>) {
<span class=linenum>0347</span>            <span class='identifier'>NSLog</span>(<span class='string'>"failedToDecodeNotification: </span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='347_45' href='Siteify.swift.html#346_84' title='usrString1'>notificationName</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>  </span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='347_66' href='Siteify.swift.html#346_115' title='usrString1'>error</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>"</span>)
<span class=linenum>0348</span>        }
<span class=linenum>0349</span>    }
<span class=linenum>0350</span>    
<span class=linenum>0351</span>    <span class='keyword'>extension</span> <span class='typeidentifier'>Position</span> {
<span class=linenum>0352</span>    
<span class=linenum>0353</span>        <span class='keyword'>var</span> <span class='identifier'><a name='353_8' title='usrString3'>anchor</a></span>: <span class='typeidentifier'>String</span> { <span class='string'>"</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'>line</span>+<span class='number'>1</span><span class='string_interpolation_anchor'>)</span><span class='string'>_</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'>character</span><span class='string_interpolation_anchor'>)</span><span class='string'>"</span> }
<span class=linenum>0354</span>    }
<span class=linenum>0355</span>    
<span class=linenum>0356</span>    <span class='keyword'>extension</span> <span class='typeidentifier'>Location</span> {
<span class=linenum>0357</span>    
<span class=linenum>0358</span>        <span class='keyword'>var</span> <span class='identifier'><a name='358_8' title='usrString3'>file</a></span>: <span class='typeidentifier'>String</span> { <span class='identifier'>URL</span>(<span class='identifier'>string</span>: <span class='identifier'>uri</span>)!.<span class='identifier'>path</span> }
<span class=linenum>0359</span>        <span class='keyword'>var</span> <span class='identifier'><a name='359_8' title='usrString3'>filename</a></span>: <span class='typeidentifier'>String</span> { <span class='identifier'>fileFilename</span>(<span class='identifier'>file</span>: <span class='identifier'>URL</span>(<span class='identifier'>string</span>: <span class='identifier'>uri</span>)!.<span class='identifier'>path</span>) }
<span class=linenum>0360</span>        <span class='keyword'>var</span> <span class='identifier'><a name='360_8' title='usrString3'>filebase</a></span>: <span class='typeidentifier'>String</span> { <span class='identifier'>URL</span>(<span class='identifier'>string</span>: <span class='identifier'>uri</span>)!.<span class='identifier'>lastPathComponent</span> }
<span class=linenum>0361</span>        <span class='keyword'>var</span> <span class='identifier'><a name='361_8' title='usrString3'>line</a></span>: <span class='typeidentifier'>Int</span> { <span class='identifier'>range</span>.<span class='identifier'>start</span>.<span class='identifier'>line</span> }
<span class=linenum>0362</span>        <span class='keyword'>var</span> <span class='identifier'><a name='362_8' title='usrString3'>anchor</a></span>: <span class='typeidentifier'>String</span> { <span class='identifier'>range</span>.<span class='identifier'>start</span>.<span class='identifier'>anchor</span> }
<span class=linenum>0363</span>        <span class='keyword'>var</span> <span class='identifier'><a name='363_8' title='usrString3'>href</a></span>: <span class='typeidentifier'>String</span> { <span class='string'>"</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'>filename</span><span class='string_interpolation_anchor'>)</span><span class='string'>.html#</span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'>anchor</span><span class='string_interpolation_anchor'>)</span><span class='string'>"</span> }
<span class=linenum>0364</span>    }
<span class=linenum>0365</span>    