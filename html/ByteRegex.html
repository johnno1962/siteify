<html><head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="siteify.css">
<script>

var lastlink;

function expand(a) {
    if ( a.children[0].style.display != "block" ) {
        if ( lastlink )
            lastlink.style.display = "none";
        a.children[0].style.display = "block";
        lastlink = a.children[0];
    }
    else {
        a.children[0].style.display = "none";
        lastlink = null;
    }
    return false;
}

</script></head><body><pre>
0001    <span class='comment'><a name='1_0'>//
0002    </a></span><span class='comment'><a name='2_0'>//  ByteRegex.swift
0003    </a></span><span class='comment'><a name='3_0'>//  refactord
0004    </a></span><span class='comment'><a name='4_0'>//
0005    </a></span><span class='comment'><a name='5_0'>//  Created by John Holdsworth on 20/12/2015.
0006    </a></span><span class='comment'><a name='6_0'>//  Copyright Â© 2015 John Holdsworth. All rights reserved.
0007    </a></span><span class='comment'><a name='7_0'>//
0008    </a></span><span class='comment'><a name='8_0'>//  $Id: //depot/Refactorator/refactord/ByteRegex.swift#10 $
0009    </a></span><span class='comment'><a name='9_0'>//
0010    </a></span><span class='comment'><a name='10_0'>//  Repo: </a></span><span class='url'><a href='https://github.com/johnno1962/Refactorator'>https://github.com/johnno1962/Refactorator</a></span><span class='comment'><a name='10_52'>
0011    </a></span><span class='comment'><a name='11_0'>//
0012    </a></span>
0013    <span class='keyword'><a name='13_0'>import</a></span> <span class='identifier'><a name='13_7'>Foundation</a></span>
0014    
0015    <span class='keyword'><a name='15_0'>extension</a></span> <span class='typeidentifier'><a name='15_10'>regmatch_t</a></span> {
0016    
0017        <span class='keyword'><a name='17_4'>var</a></span> <span class='identifier'><a name='17_8' href='#' title='usrString2' onclick='return expand(this);'>range<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Entity.html#62_26"; event.stopPropagation(); return false;'>Entity.swift:62</td><td><pre></pre></td></table></span></a></span>: <span class='typeidentifier'><a name='17_15'>NSRange</a></span> {
0018            <span class='keyword'><a name='18_8'>return</a></span> <span class='identifier'><a name='18_15'>NSMakeRange</a></span>( <span class='identifier'><a name='18_28'>Int</a></span>(<span class='identifier'><a name='18_32'>rm_so</a></span>), <span class='identifier'><a name='18_40'>Int</a></span>(<span class='identifier'><a name='18_44'>rm_eo</a></span>-<span class='identifier'><a name='18_50'>rm_so</a></span>) )
0019        }
0020    
0021    }
0022    
0023    <span class='keyword'><a name='23_0'>class</a></span> <span class='identifier'><a name='23_6' href='#' title='usrString2' onclick='return expand(this);'>ByteRegex<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Entity.html#31_34"; event.stopPropagation(); return false;'>Entity.swift:31</td><td><pre></pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="Entity.html#44_15"; event.stopPropagation(); return false;'>Entity.swift:44</td><td><pre></pre></td></table></span></a></span> {
0024    
0025        <span class='keyword'><a name='25_4'>var</a></span> <span class='identifier'><a name='25_8' href='#' title='usrString2' onclick='return expand(this);'>regex<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ByteRegex.html#29_30"; return false;'>ByteRegex.swift:29</td><td><pre>        let error = regcomp( &amp;regex, pattern, cflags )</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ByteRegex.html#32_30"; return false;'>ByteRegex.swift:32</td><td><pre>            regerror( error, &amp;regex, &amp;errbuff, errbuff.count )</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ByteRegex.html#40_30"; return false;'>ByteRegex.swift:40</td><td><pre>        let error = regexec( &amp;regex, input.bytes.assumingMemoryBound(to: Int8.self), matches.count, &amp;matches, mflags )</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ByteRegex.html#43_30"; return false;'>ByteRegex.swift:43</td><td><pre>            regerror( error, &amp;regex, &amp;errbuff, errbuff.count )</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ByteRegex.html#50_18"; return false;'>ByteRegex.swift:50</td><td><pre>        regfree( &amp;regex )</pre></td></table></span></a></span> = <span class='identifier'><a name='25_16'>regex_t</a></span>()
0026        <span class='keyword'><a name='26_4'>let</a></span> <span class='identifier'><a name='26_8' href='#' title='usrString2' onclick='return expand(this);'>groups<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ByteRegex.html#35_8"; return false;'>ByteRegex.swift:35</td><td><pre>        groups = 1 + pattern.filter { $0 == "(" } .count</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ByteRegex.html#39_68"; return false;'>ByteRegex.swift:39</td><td><pre>        var matches = [regmatch_t]( repeating: regmatch_t(), count: groups )</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='26_16'>Int</a></span>
0027    
0028        <span class='keyword'><a name='28_4'>init</a></span>( <span class='identifier'><a name='28_10' href='#' title='usrString2' onclick='return expand(this);'>pattern<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ByteRegex.html#29_37"; return false;'>ByteRegex.swift:29</td><td><pre>        let error = regcomp( &amp;regex, pattern, cflags )</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ByteRegex.html#33_49"; return false;'>ByteRegex.swift:33</td><td><pre>            print( "ByteRegex: Error in regex '\(pattern)': \(String( cString: errbuff ))" )</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ByteRegex.html#35_21"; return false;'>ByteRegex.swift:35</td><td><pre>        groups = 1 + pattern.filter { $0 == "(" } .count</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='28_19'>String</a></span>, <span class='identifier'><a name='28_27' href='#' title='usrString2' onclick='return expand(this);'>cflags<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ByteRegex.html#29_46"; return false;'>ByteRegex.swift:29</td><td><pre>        let error = regcomp( &amp;regex, pattern, cflags )</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='28_35'>Int32</a></span> = <span class='identifier'><a name='28_43'>REG_EXTENDED</a></span>|<span class='identifier'><a name='28_56'>REG_ENHANCED</a></span> ) {
0029            <span class='keyword'><a name='29_8'>let</a></span> <span class='identifier'><a name='29_12' title='usrString3'>error</a></span> = <span class='identifier'><a name='29_20'>regcomp</a></span>( &amp;<span class='identifier'><a name='29_30' href='ByteRegex.html#25_8' title='usrString1'>regex</a></span>, <span class='identifier'><a name='29_37' href='ByteRegex.html#28_10' title='usrString1'>pattern</a></span>, <span class='identifier'><a name='29_46' href='ByteRegex.html#28_27' title='usrString1'>cflags</a></span> )
0030            <span class='keyword'><a name='30_8'>if</a></span> <span class='identifier'><a name='30_11' href='ByteRegex.html#29_12' title='usrString1'>error</a></span> != <span class='number'><a name='30_20'>0</a></span> {
0031                <span class='keyword'><a name='31_12'>var</a></span> <span class='identifier'><a name='31_16' title='usrString3'>errbuff</a></span> = [<span class='identifier'><a name='31_27'>Int8</a></span>]( <span class='identifier'><a name='31_34'>repeating</a></span>: <span class='number'><a name='31_45'>0</a></span>, <span class='identifier'><a name='31_48'>count</a></span>: <span class='number'><a name='31_55'>1024</a></span> )
0032                <span class='identifier'><a name='32_12'>regerror</a></span>( <span class='identifier'><a name='32_22' href='ByteRegex.html#29_12' title='usrString1'>error</a></span>, &amp;<span class='identifier'><a name='32_30' href='ByteRegex.html#25_8' title='usrString1'>regex</a></span>, &amp;<span class='identifier'><a name='32_38' href='ByteRegex.html#31_16' title='usrString1'>errbuff</a></span>, <span class='identifier'><a name='32_47' href='ByteRegex.html#31_16' title='usrString1'>errbuff</a></span>.<span class='identifier'><a name='32_55'>count</a></span> )
0033                <span class='identifier'><a name='33_12'>print</a></span>( <span class='string'><a name='33_19'>"ByteRegex: Error in regex '</a></span>\<span class='string_interpolation_anchor'><a name='33_48'>(</a></span><span class='identifier'><a name='33_49' href='ByteRegex.html#28_10' title='usrString1'>pattern</a></span><span class='string_interpolation_anchor'><a name='33_56'>)</a></span><span class='string'><a name='33_57'>': </a></span>\<span class='string_interpolation_anchor'><a name='33_61'>(</a></span><span class='identifier'><a name='33_62'>String</a></span>( <span class='identifier'><a name='33_70'>cString</a></span>: <span class='identifier'><a name='33_79' href='ByteRegex.html#31_16' title='usrString1'>errbuff</a></span> )<span class='string_interpolation_anchor'><a name='33_88'>)</a></span><span class='string'><a name='33_89'>"</a></span> )
0034            }
0035            <span class='identifier'><a name='35_8' href='ByteRegex.html#26_8' title='usrString1'>groups</a></span> = <span class='number'><a name='35_17'>1</a></span> + <span class='identifier'><a name='35_21' href='ByteRegex.html#28_10' title='usrString1'>pattern</a></span>.<span class='identifier'><a name='35_29'>filter</a></span> { <span class='identifier'><a name='35_38' href='ByteRegex.html#35_36' title='usrString1'>$0</a></span> == <span class='string'><a name='35_44'>"("</a></span> } .<span class='identifier'><a name='35_51'>count</a></span>
0036        }
0037    
0038        <span class='keyword'><a name='38_4'>func</a></span> <span class='identifier'><a name='38_9' href='#' title='usrString2' onclick='return expand(this);'>match<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="Entity.html#48_46"; event.stopPropagation(); return false;'>Entity.swift:48</td><td><pre></pre></td></table></span></a></span>( <span class='identifier'><a name='38_16' href='#' title='usrString2' onclick='return expand(this);'>input<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ByteRegex.html#40_37"; return false;'>ByteRegex.swift:40</td><td><pre>        let error = regexec( &amp;regex, input.bytes.assumingMemoryBound(to: Int8.self), matches.count, &amp;matches, mflags )</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='38_23'>NSData</a></span>, <span class='identifier'><a name='38_31' href='#' title='usrString2' onclick='return expand(this);'>mflags<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ByteRegex.html#40_110"; return false;'>ByteRegex.swift:40</td><td><pre>        let error = regexec( &amp;regex, input.bytes.assumingMemoryBound(to: Int8.self), matches.count, &amp;matches, mflags )</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='38_39'>Int32</a></span> = <span class='number'><a name='38_47'>0</a></span> ) -> [<span class='typeidentifier'><a name='38_55'>regmatch_t</a></span>]? {
0039            <span class='keyword'><a name='39_8'>var</a></span> <span class='identifier'><a name='39_12' title='usrString3'>matches</a></span> = [<span class='identifier'><a name='39_23'>regmatch_t</a></span>]( <span class='identifier'><a name='39_36'>repeating</a></span>: <span class='identifier'><a name='39_47'>regmatch_t</a></span>(), <span class='identifier'><a name='39_61'>count</a></span>: <span class='identifier'><a name='39_68' href='ByteRegex.html#26_8' title='usrString1'>groups</a></span> )
0040            <span class='keyword'><a name='40_8'>let</a></span> <span class='identifier'><a name='40_12' title='usrString3'>error</a></span> = <span class='identifier'><a name='40_20'>regexec</a></span>( &amp;<span class='identifier'><a name='40_30' href='ByteRegex.html#25_8' title='usrString1'>regex</a></span>, <span class='identifier'><a name='40_37' href='ByteRegex.html#38_16' title='usrString1'>input</a></span>.<span class='identifier'><a name='40_43'>bytes</a></span>.<span class='identifier'><a name='40_49'>assumingMemoryBound</a></span>(<span class='identifier'><a name='40_69'>to</a></span>: <span class='identifier'><a name='40_73'>Int8</a></span>.<span class='keyword'><a name='40_78'>self</a></span>), <span class='identifier'><a name='40_85' href='ByteRegex.html#39_12' title='usrString1'>matches</a></span>.<span class='identifier'><a name='40_93'>count</a></span>, &amp;<span class='identifier'><a name='40_101' href='ByteRegex.html#39_12' title='usrString1'>matches</a></span>, <span class='identifier'><a name='40_110' href='ByteRegex.html#38_31' title='usrString1'>mflags</a></span> )
0041            <span class='keyword'><a name='41_8'>if</a></span> <span class='identifier'><a name='41_11' href='ByteRegex.html#40_12' title='usrString1'>error</a></span> != <span class='number'><a name='41_20'>0</a></span> &amp;&amp; <span class='identifier'><a name='41_25' href='ByteRegex.html#40_12' title='usrString1'>error</a></span> != <span class='identifier'><a name='41_34'>REG_NOMATCH</a></span> {
0042                <span class='keyword'><a name='42_12'>var</a></span> <span class='identifier'><a name='42_16' title='usrString3'>errbuff</a></span> = [<span class='identifier'><a name='42_27'>Int8</a></span>]( <span class='identifier'><a name='42_34'>repeating</a></span>: <span class='number'><a name='42_45'>0</a></span>, <span class='identifier'><a name='42_48'>count</a></span>: <span class='number'><a name='42_55'>1024</a></span> )
0043                <span class='identifier'><a name='43_12'>regerror</a></span>( <span class='identifier'><a name='43_22' href='ByteRegex.html#40_12' title='usrString1'>error</a></span>, &amp;<span class='identifier'><a name='43_30' href='ByteRegex.html#25_8' title='usrString1'>regex</a></span>, &amp;<span class='identifier'><a name='43_38' href='ByteRegex.html#42_16' title='usrString1'>errbuff</a></span>, <span class='identifier'><a name='43_47' href='ByteRegex.html#42_16' title='usrString1'>errbuff</a></span>.<span class='identifier'><a name='43_55'>count</a></span> )
0044                <span class='identifier'><a name='44_12'>print</a></span>( <span class='string'><a name='44_19'>"ByteRegex: Error in match: </a></span>\<span class='string_interpolation_anchor'><a name='44_48'>(</a></span><span class='identifier'><a name='44_49'>String</a></span>( <span class='identifier'><a name='44_57'>cString</a></span>: <span class='identifier'><a name='44_66' href='ByteRegex.html#42_16' title='usrString1'>errbuff</a></span> )<span class='string_interpolation_anchor'><a name='44_75'>)</a></span><span class='string'><a name='44_76'>"</a></span> )
0045            }
0046            <span class='keyword'><a name='46_8'>return</a></span> <span class='identifier'><a name='46_15' href='ByteRegex.html#40_12' title='usrString1'>error</a></span> == <span class='number'><a name='46_24'>0</a></span> ? <span class='identifier'><a name='46_28' href='ByteRegex.html#39_12' title='usrString1'>matches</a></span> : <span class='keyword'><a name='46_38'>nil</a></span>
0047        }
0048    
0049        <span class='keyword'><a name='49_4'>deinit</a></span> {
0050            <span class='identifier'><a name='50_8'>regfree</a></span>( &amp;<span class='identifier'><a name='50_18' href='ByteRegex.html#25_8' title='usrString1'>regex</a></span> )
0051        }
0052    
0053    }
0054    