<html><head>
    <meta charset="UTF-8">
    <title>.build/checkouts/SwiftLSPClient/SwiftLSPClientTests/MessageTransportTests.swift</title>
    <link rel="stylesheet" type="text/css" href="siteify.css">
<script>

var lastlink;

function expand(a) {
    if ( a.children[0].style.display != "block" ) {
        if ( lastlink )
            lastlink.style.display = "none";
        a.children[0].style.display = "block";
        lastlink = a.children[0];
    }
    else {
        a.children[0].style.display = "none";
        lastlink = null;
    }
    return false;
}

</script></head><body><h3>.build/checkouts/SwiftLSPClient/SwiftLSPClientTests/MessageTransportTests.swift</h3><pre><a class=linenum name='L1'>0001</a>    <span class='comment' title='source.lang.swift.syntaxtype.comment'>//
<a class=linenum name='L2'>0002</a>    </span><span class='comment' title='source.lang.swift.syntaxtype.comment'>//  MessageTransportTests.swift
<a class=linenum name='L3'>0003</a>    </span><span class='comment' title='source.lang.swift.syntaxtype.comment'>//  SwiftLSPClientTests
<a class=linenum name='L4'>0004</a>    </span><span class='comment' title='source.lang.swift.syntaxtype.comment'>//
<a class=linenum name='L5'>0005</a>    </span><span class='comment' title='source.lang.swift.syntaxtype.comment'>//  Created by Matt Massicotte on 2018-10-15.
<a class=linenum name='L6'>0006</a>    </span><span class='comment' title='source.lang.swift.syntaxtype.comment'>//  Copyright Â© 2018 Chime Systems. All rights reserved.
<a class=linenum name='L7'>0007</a>    </span><span class='comment' title='source.lang.swift.syntaxtype.comment'>//
<a class=linenum name='L8'>0008</a>    </span>
<a class=linenum name='L9'>0009</a>    <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>import</span> <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTest</span>
<a class=linenum name='L10'>0010</a>    <span class='builtin' title='source.lang.swift.syntaxtype.attribute.builtin'>@testable</span> <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>import</span> <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>SwiftLSPClient</span>
<a class=linenum name='L11'>0011</a>    
<a class=linenum name='L12'>0012</a>    <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>class</span> <span class='identifier' title='MessageTransportTests.swift'><a name='12_6'>MessageTransportTests</a></span>: <span class='typeidentifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTestCase</span> {
<a class=linenum name='L13'>0013</a>        <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>func</span> <span class='identifier' title='MessageTransportTests.swift'><a name='13_9'>writeMessageAndReadResult</a></span>(<span class='keyword' title='source.lang.swift.syntaxtype.keyword'>_</span> <span class='identifier' title='MessageTransportTests.swift'><a name='13_37'>message</a></span>: <span class='typeidentifier' title='x86_64-apple-macos.swiftmodule'>String</span>) -> <span class='typeidentifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>Data</span>? {
<a class=linenum name='L14'>0014</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='14_12'>results</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>writeMessagesAndReadResult</span>([<span class='identifier' title='MessageTransportTests.swift'><a name='14_50' href='MessageTransportTests.swift.html#13_37'>message</a></span>])
<a class=linenum name='L15'>0015</a>            
<a class=linenum name='L16'>0016</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>guard</span> <span class='identifier' title='MessageTransportTests.swift'><a name='16_14' href='MessageTransportTests.swift.html#14_12'>results</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>count</span> == <span class='number' title='source.lang.swift.syntaxtype.number'>1</span> <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>else</span> {
<a class=linenum name='L17'>0017</a>                <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>return</span> <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>nil</span>
<a class=linenum name='L18'>0018</a>            }
<a class=linenum name='L19'>0019</a>            
<a class=linenum name='L20'>0020</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>return</span> <span class='identifier' title='MessageTransportTests.swift'><a name='20_15' href='MessageTransportTests.swift.html#14_12'>results</a></span>[<span class='number' title='source.lang.swift.syntaxtype.number'>0</span>]
<a class=linenum name='L21'>0021</a>        }
<a class=linenum name='L22'>0022</a>        
<a class=linenum name='L23'>0023</a>        <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>func</span> <span class='identifier' title='MessageTransportTests.swift'><a name='23_9'>writeMessagesAndReadResult</a></span>(<span class='keyword' title='source.lang.swift.syntaxtype.keyword'>_</span> <span class='identifier' title='MessageTransportTests.swift'><a name='23_38'>messages</a></span>: [<span class='typeidentifier' title='x86_64-apple-macos.swiftmodule'>String</span>], <span class='identifier' title='MessageTransportTests.swift'><a name='23_58'>resultCount</a></span>: <span class='typeidentifier' title='x86_64-apple-macos.swiftmodule'>Int</span> = <span class='number' title='source.lang.swift.syntaxtype.number'>1</span>) -> [<span class='typeidentifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>Data</span>] {
<a class=linenum name='L24'>0024</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='24_12'>dataTransport</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>MockDataTransport</span>()
<a class=linenum name='L25'>0025</a>            
<a class=linenum name='L26'>0026</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='26_12'>transport</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>MessageTransport</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>dataTransport</span>: <span class='identifier' title='MessageTransportTests.swift'><a name='26_56' href='MessageTransportTests.swift.html#24_12'>dataTransport</a></span>)
<a class=linenum name='L27'>0027</a>            
<a class=linenum name='L28'>0028</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>var</span> <span class='identifier' title='MessageTransportTests.swift'><a name='28_12'>receivedData</a></span>: [<span class='typeidentifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>Data</span>] = []
<a class=linenum name='L29'>0029</a>    
<a class=linenum name='L30'>0030</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='30_12'>exp</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTestExpectation</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>description</span>: <span class='string' title='source.lang.swift.syntaxtype.string'>"Message Content"</span>)
<a class=linenum name='L31'>0031</a>            <span class='identifier' title='MessageTransportTests.swift'><a name='31_8' href='MessageTransportTests.swift.html#30_12'>exp</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>expectedFulfillmentCount</span> = <span class='identifier' title='MessageTransportTests.swift'><a name='31_39' href='MessageTransportTests.swift.html#23_58'>resultCount</a></span>
<a class=linenum name='L32'>0032</a>    
<a class=linenum name='L33'>0033</a>            <span class='identifier' title='MessageTransportTests.swift'><a name='33_8' href='MessageTransportTests.swift.html#26_12'>transport</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>dataHandler</span> = { (<span class='identifier' title='MessageTransportTests.swift'><a name='33_35'>data</a></span>) <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>in</span>
<a class=linenum name='L34'>0034</a>                <span class='identifier' title='MessageTransportTests.swift'><a name='34_12' href='MessageTransportTests.swift.html#28_12'>receivedData</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>append</span>(<span class='identifier' title='MessageTransportTests.swift'><a name='34_32' href='MessageTransportTests.swift.html#33_35'>data</a></span>)
<a class=linenum name='L35'>0035</a>    
<a class=linenum name='L36'>0036</a>                <span class='identifier' title='MessageTransportTests.swift'><a name='36_12' href='MessageTransportTests.swift.html#30_12'>exp</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>fulfill</span>()
<a class=linenum name='L37'>0037</a>            }
<a class=linenum name='L38'>0038</a>    
<a class=linenum name='L39'>0039</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>for</span> <span class='identifier' title='MessageTransportTests.swift'><a name='39_12'>message</a></span> <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>in</span> <span class='identifier' title='MessageTransportTests.swift'><a name='39_23' href='MessageTransportTests.swift.html#23_38'>messages</a></span> {
<a class=linenum name='L40'>0040</a>                <span class='identifier' title='MessageTransportTests.swift'><a name='40_12' href='MessageTransportTests.swift.html#24_12'>dataTransport</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>mockRead</span>(<span class='identifier' title='MessageTransportTests.swift'><a name='40_35' href='MessageTransportTests.swift.html#39_12'>message</a></span>)
<a class=linenum name='L41'>0041</a>            }
<a class=linenum name='L42'>0042</a>    
<a class=linenum name='L43'>0043</a>            <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>wait</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>for</span>: [<span class='identifier' title='MessageTransportTests.swift'><a name='43_19' href='MessageTransportTests.swift.html#30_12'>exp</a></span>], <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>timeout</span>: <span class='number' title='source.lang.swift.syntaxtype.number'>1.0</span>)
<a class=linenum name='L44'>0044</a>    
<a class=linenum name='L45'>0045</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>return</span> <span class='identifier' title='MessageTransportTests.swift'><a name='45_15' href='MessageTransportTests.swift.html#28_12'>receivedData</a></span>
<a class=linenum name='L46'>0046</a>        }
<a class=linenum name='L47'>0047</a>        
<a class=linenum name='L48'>0048</a>        <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>func</span> <span class='identifier' title='MessageTransportTests.swift'><a name='48_9'>testBasicMessageDecode</a></span>() {
<a class=linenum name='L49'>0049</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='49_12'>content</a></span> = <span class='string' title='source.lang.swift.syntaxtype.string'>"{\"jsonrpc\":\"2.0\",\"params\":\"Something\"}"</span>
<a class=linenum name='L50'>0050</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='50_12'>message</a></span> = <span class='string' title='source.lang.swift.syntaxtype.string'>"Content-Length: 38\r\n\r\n</span>\<span class='string_interpolation_anchor' title='source.lang.swift.syntaxtype.string_interpolation_anchor'>(</span><span class='identifier' title='MessageTransportTests.swift'><a name='50_51' href='MessageTransportTests.swift.html#49_12'>content</a></span><span class='string_interpolation_anchor' title='source.lang.swift.syntaxtype.string_interpolation_anchor'>)</span><span class='string' title='source.lang.swift.syntaxtype.string'>"</span>
<a class=linenum name='L51'>0051</a>            
<a class=linenum name='L52'>0052</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='52_12'>data</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>writeMessageAndReadResult</span>(<span class='identifier' title='MessageTransportTests.swift'><a name='52_45' href='MessageTransportTests.swift.html#50_12'>message</a></span>)
<a class=linenum name='L53'>0053</a>            
<a class=linenum name='L54'>0054</a>            <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTAssertEqual</span>(<span class='identifier' title='MessageTransportTests.swift'><a name='54_23' href='MessageTransportTests.swift.html#52_12'>data</a></span>, <span class='identifier' title='MessageTransportTests.swift'><a name='54_29' href='MessageTransportTests.swift.html#49_12'>content</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>data</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>using</span>: .<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>utf8</span>)!)
<a class=linenum name='L55'>0055</a>        }
<a class=linenum name='L56'>0056</a>        
<a class=linenum name='L57'>0057</a>        <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>func</span> <span class='identifier' title='MessageTransportTests.swift'><a name='57_9'>testMultiHeaderMessage</a></span>() {
<a class=linenum name='L58'>0058</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='58_12'>content</a></span> = <span class='string' title='source.lang.swift.syntaxtype.string'>"{\"jsonrpc\":\"2.0\",\"params\":\"Something\"}"</span>
<a class=linenum name='L59'>0059</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='59_12'>header1</a></span> = <span class='string' title='source.lang.swift.syntaxtype.string'>"Content-Length: 38\r\n"</span>
<a class=linenum name='L60'>0060</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='60_12'>header2</a></span> = <span class='string' title='source.lang.swift.syntaxtype.string'>"Another-Header: Something\r\n"</span>
<a class=linenum name='L61'>0061</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='61_12'>header3</a></span> = <span class='string' title='source.lang.swift.syntaxtype.string'>"And-Another: third\r\n"</span>
<a class=linenum name='L62'>0062</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='62_12'>message</a></span> = <span class='identifier' title='MessageTransportTests.swift'><a name='62_22' href='MessageTransportTests.swift.html#59_12'>header1</a></span> + <span class='identifier' title='MessageTransportTests.swift'><a name='62_32' href='MessageTransportTests.swift.html#60_12'>header2</a></span> + <span class='identifier' title='MessageTransportTests.swift'><a name='62_42' href='MessageTransportTests.swift.html#61_12'>header3</a></span> + <span class='string' title='source.lang.swift.syntaxtype.string'>"\r\n"</span> + <span class='identifier' title='MessageTransportTests.swift'><a name='62_61' href='MessageTransportTests.swift.html#58_12'>content</a></span>
<a class=linenum name='L63'>0063</a>            
<a class=linenum name='L64'>0064</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='64_12'>data</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>writeMessageAndReadResult</span>(<span class='identifier' title='MessageTransportTests.swift'><a name='64_45' href='MessageTransportTests.swift.html#62_12'>message</a></span>)
<a class=linenum name='L65'>0065</a>            
<a class=linenum name='L66'>0066</a>            <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTAssertEqual</span>(<span class='identifier' title='MessageTransportTests.swift'><a name='66_23' href='MessageTransportTests.swift.html#64_12'>data</a></span>, <span class='identifier' title='MessageTransportTests.swift'><a name='66_29' href='MessageTransportTests.swift.html#58_12'>content</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>data</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>using</span>: .<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>utf8</span>)!)
<a class=linenum name='L67'>0067</a>        }
<a class=linenum name='L68'>0068</a>        
<a class=linenum name='L69'>0069</a>        <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>func</span> <span class='identifier' title='MessageTransportTests.swift'><a name='69_9'>testMultiReadMessage</a></span>() {
<a class=linenum name='L70'>0070</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='70_12'>messages</a></span> = [
<a class=linenum name='L71'>0071</a>                <span class='string' title='source.lang.swift.syntaxtype.string'>"Content-Le"</span>,
<a class=linenum name='L72'>0072</a>                <span class='string' title='source.lang.swift.syntaxtype.string'>"ngth: 30\r\n"</span>,
<a class=linenum name='L73'>0073</a>                <span class='string' title='source.lang.swift.syntaxtype.string'>"Header2: h"</span>,
<a class=linenum name='L74'>0074</a>                <span class='string' title='source.lang.swift.syntaxtype.string'>"llo\r\n\r\n"</span>,
<a class=linenum name='L75'>0075</a>                <span class='string' title='source.lang.swift.syntaxtype.string'>"abcdefghij"</span>,
<a class=linenum name='L76'>0076</a>                <span class='string' title='source.lang.swift.syntaxtype.string'>"klmnopqurs"</span>,
<a class=linenum name='L77'>0077</a>                <span class='string' title='source.lang.swift.syntaxtype.string'>"tuvwxyz123"</span>
<a class=linenum name='L78'>0078</a>            ]
<a class=linenum name='L79'>0079</a>            
<a class=linenum name='L80'>0080</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='80_12'>content</a></span> = <span class='string' title='source.lang.swift.syntaxtype.string'>"abcdefghijklmnopqurstuvwxyz123"</span>
<a class=linenum name='L81'>0081</a>    
<a class=linenum name='L82'>0082</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='82_12'>results</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>writeMessagesAndReadResult</span>(<span class='identifier' title='MessageTransportTests.swift'><a name='82_49' href='MessageTransportTests.swift.html#70_12'>messages</a></span>)
<a class=linenum name='L83'>0083</a>    
<a class=linenum name='L84'>0084</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>if</span> <span class='identifier' title='MessageTransportTests.swift'><a name='84_11' href='MessageTransportTests.swift.html#82_12'>results</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>count</span> != <span class='number' title='source.lang.swift.syntaxtype.number'>1</span> {
<a class=linenum name='L85'>0085</a>                <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTFail</span>()
<a class=linenum name='L86'>0086</a>                <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>return</span>
<a class=linenum name='L87'>0087</a>            }
<a class=linenum name='L88'>0088</a>    
<a class=linenum name='L89'>0089</a>            <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTAssertEqual</span>(<span class='identifier' title='MessageTransportTests.swift'><a name='89_23' href='MessageTransportTests.swift.html#82_12'>results</a></span>[<span class='number' title='source.lang.swift.syntaxtype.number'>0</span>], <span class='identifier' title='MessageTransportTests.swift'><a name='89_35' href='MessageTransportTests.swift.html#80_12'>content</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>data</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>using</span>: .<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>utf8</span>)!)
<a class=linenum name='L90'>0090</a>        }
<a class=linenum name='L91'>0091</a>        
<a class=linenum name='L92'>0092</a>        <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>func</span> <span class='identifier' title='MessageTransportTests.swift'><a name='92_9'>testMultiReadMessageWithSecondMessageInARead</a></span>() {
<a class=linenum name='L93'>0093</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='93_12'>messages</a></span> = [
<a class=linenum name='L94'>0094</a>                <span class='string' title='source.lang.swift.syntaxtype.string'>"Content-Length: 6\r\n"</span>,
<a class=linenum name='L95'>0095</a>                <span class='string' title='source.lang.swift.syntaxtype.string'>"Another-Header: hello\r\n\r\n"</span>,
<a class=linenum name='L96'>0096</a>                <span class='string' title='source.lang.swift.syntaxtype.string'>"abcdefContent-Length: 10\r\n"</span>,
<a class=linenum name='L97'>0097</a>                <span class='string' title='source.lang.swift.syntaxtype.string'>"\r\nabcdefghij"</span>,
<a class=linenum name='L98'>0098</a>            ]
<a class=linenum name='L99'>0099</a>            
<a class=linenum name='L100'>0100</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='100_12'>results</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>writeMessagesAndReadResult</span>(<span class='identifier' title='MessageTransportTests.swift'><a name='100_49' href='MessageTransportTests.swift.html#93_12'>messages</a></span>, <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>resultCount</span>: <span class='number' title='source.lang.swift.syntaxtype.number'>2</span>)
<a class=linenum name='L101'>0101</a>    
<a class=linenum name='L102'>0102</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>if</span> <span class='identifier' title='MessageTransportTests.swift'><a name='102_11' href='MessageTransportTests.swift.html#100_12'>results</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>count</span> != <span class='number' title='source.lang.swift.syntaxtype.number'>2</span> {
<a class=linenum name='L103'>0103</a>                <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTFail</span>()
<a class=linenum name='L104'>0104</a>                <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>return</span>
<a class=linenum name='L105'>0105</a>            }
<a class=linenum name='L106'>0106</a>    
<a class=linenum name='L107'>0107</a>            <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTAssertEqual</span>(<span class='identifier' title='MessageTransportTests.swift'><a name='107_23' href='MessageTransportTests.swift.html#100_12'>results</a></span>[<span class='number' title='source.lang.swift.syntaxtype.number'>0</span>], <span class='string' title='source.lang.swift.syntaxtype.string'>"abcdef"</span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>data</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>using</span>: .<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>utf8</span>)!)
<a class=linenum name='L108'>0108</a>            <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTAssertEqual</span>(<span class='identifier' title='MessageTransportTests.swift'><a name='108_23' href='MessageTransportTests.swift.html#100_12'>results</a></span>[<span class='number' title='source.lang.swift.syntaxtype.number'>1</span>], <span class='string' title='source.lang.swift.syntaxtype.string'>"abcdefghij"</span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>data</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>using</span>: .<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>utf8</span>)!)
<a class=linenum name='L109'>0109</a>        }
<a class=linenum name='L110'>0110</a>        
<a class=linenum name='L111'>0111</a>        <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>func</span> <span class='identifier' title='MessageTransportTests.swift'><a name='111_9'>testDecodeMessagePerformance</a></span>() {
<a class=linenum name='L112'>0112</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='112_12'>dataTransport</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>MockDataTransport</span>()
<a class=linenum name='L113'>0113</a>            
<a class=linenum name='L114'>0114</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='114_12'>transport</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>MessageTransport</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>dataTransport</span>: <span class='identifier' title='MessageTransportTests.swift'><a name='114_56' href='MessageTransportTests.swift.html#112_12'>dataTransport</a></span>)
<a class=linenum name='L115'>0115</a>            
<a class=linenum name='L116'>0116</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>var</span> <span class='identifier' title='MessageTransportTests.swift'><a name='116_12'>receiveCount</a></span>: <span class='typeidentifier' title='x86_64-apple-macos.swiftmodule'>Int</span> = <span class='number' title='source.lang.swift.syntaxtype.number'>0</span>
<a class=linenum name='L117'>0117</a>            
<a class=linenum name='L118'>0118</a>            <span class='identifier' title='MessageTransportTests.swift'><a name='118_8' href='MessageTransportTests.swift.html#114_12'>transport</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>dataHandler</span> = { (<span class='identifier' title='MessageTransportTests.swift'><a name='118_35'>data</a></span>) <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>in</span>
<a class=linenum name='L119'>0119</a>                <span class='identifier' title='MessageTransportTests.swift'><a name='119_12' href='MessageTransportTests.swift.html#116_12'>receiveCount</a></span> += <span class='number' title='source.lang.swift.syntaxtype.number'>1</span>
<a class=linenum name='L120'>0120</a>            }
<a class=linenum name='L121'>0121</a>            
<a class=linenum name='L122'>0122</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='122_12'>content</a></span> = <span class='string' title='source.lang.swift.syntaxtype.string'>"{\"jsonrpc\":\"2.0\",\"params\":\"Something\"}"</span>
<a class=linenum name='L123'>0123</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='123_12'>message</a></span> = <span class='string' title='source.lang.swift.syntaxtype.string'>"Content-Length: 38\r\n\r\n</span>\<span class='string_interpolation_anchor' title='source.lang.swift.syntaxtype.string_interpolation_anchor'>(</span><span class='identifier' title='MessageTransportTests.swift'><a name='123_51' href='MessageTransportTests.swift.html#122_12'>content</a></span><span class='string_interpolation_anchor' title='source.lang.swift.syntaxtype.string_interpolation_anchor'>)</span><span class='string' title='source.lang.swift.syntaxtype.string'>"</span>
<a class=linenum name='L124'>0124</a>            
<a class=linenum name='L125'>0125</a>            <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>measure</span> {
<a class=linenum name='L126'>0126</a>                <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>for</span> <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>_</span> <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>in</span> <span class='number' title='source.lang.swift.syntaxtype.number'>0</span>..&lt;<span class='number' title='source.lang.swift.syntaxtype.number'>1000</span> {
<a class=linenum name='L127'>0127</a>                    <span class='identifier' title='MessageTransportTests.swift'><a name='127_16' href='MessageTransportTests.swift.html#112_12'>dataTransport</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>mockRead</span>(<span class='identifier' title='MessageTransportTests.swift'><a name='127_39' href='MessageTransportTests.swift.html#123_12'>message</a></span>)
<a class=linenum name='L128'>0128</a>                }
<a class=linenum name='L129'>0129</a>            }
<a class=linenum name='L130'>0130</a>            
<a class=linenum name='L131'>0131</a>            <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTAssert</span>(<span class='identifier' title='MessageTransportTests.swift'><a name='131_18' href='MessageTransportTests.swift.html#116_12'>receiveCount</a></span> >= <span class='number' title='source.lang.swift.syntaxtype.number'>1000</span>)
<a class=linenum name='L132'>0132</a>        }
<a class=linenum name='L133'>0133</a>    
<a class=linenum name='L134'>0134</a>        <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>func</span> <span class='identifier' title='MessageTransportTests.swift'><a name='134_9'>testTwoFullMessagesInOneRead</a></span>() {
<a class=linenum name='L135'>0135</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='135_12'>messages</a></span> = [
<a class=linenum name='L136'>0136</a>                <span class='string' title='source.lang.swift.syntaxtype.string'>"Content-Length: 6\r\n\r\nabcdefContent-Length: 10\r\n\r\nabcdefghij"</span>
<a class=linenum name='L137'>0137</a>            ]
<a class=linenum name='L138'>0138</a>    
<a class=linenum name='L139'>0139</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='MessageTransportTests.swift'><a name='139_12'>results</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>writeMessagesAndReadResult</span>(<span class='identifier' title='MessageTransportTests.swift'><a name='139_49' href='MessageTransportTests.swift.html#135_12'>messages</a></span>, <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>resultCount</span>: <span class='number' title='source.lang.swift.syntaxtype.number'>2</span>)
<a class=linenum name='L140'>0140</a>    
<a class=linenum name='L141'>0141</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>if</span> <span class='identifier' title='MessageTransportTests.swift'><a name='141_11' href='MessageTransportTests.swift.html#139_12'>results</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>count</span> != <span class='number' title='source.lang.swift.syntaxtype.number'>2</span> {
<a class=linenum name='L142'>0142</a>                <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTFail</span>()
<a class=linenum name='L143'>0143</a>                <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>return</span>
<a class=linenum name='L144'>0144</a>            }
<a class=linenum name='L145'>0145</a>    
<a class=linenum name='L146'>0146</a>            <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTAssertEqual</span>(<span class='identifier' title='MessageTransportTests.swift'><a name='146_23' href='MessageTransportTests.swift.html#139_12'>results</a></span>[<span class='number' title='source.lang.swift.syntaxtype.number'>0</span>], <span class='string' title='source.lang.swift.syntaxtype.string'>"abcdef"</span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>data</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>using</span>: .<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>utf8</span>)!)
<a class=linenum name='L147'>0147</a>            <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTAssertEqual</span>(<span class='identifier' title='MessageTransportTests.swift'><a name='147_23' href='MessageTransportTests.swift.html#139_12'>results</a></span>[<span class='number' title='source.lang.swift.syntaxtype.number'>1</span>], <span class='string' title='source.lang.swift.syntaxtype.string'>"abcdefghij"</span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>data</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>using</span>: .<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>utf8</span>)!)
<a class=linenum name='L148'>0148</a>        }
<a class=linenum name='L149'>0149</a>    }
<a class=linenum name='L150'>0150</a>    