<html><head>
    <meta charset="UTF-8">
    <title>.build/checkouts/SwiftLSPClient/SwiftLSPClientTests/ProtocolTransportTests.swift</title>
    <link rel="stylesheet" type="text/css" href="siteify.css">
<script>

var lastlink;

function expand(a) {
    if ( a.children[0].style.display != "block" ) {
        if ( lastlink )
            lastlink.style.display = "none";
        a.children[0].style.display = "block";
        lastlink = a.children[0];
    }
    else {
        a.children[0].style.display = "none";
        lastlink = null;
    }
    return false;
}

</script></head><body><h3>.build/checkouts/SwiftLSPClient/SwiftLSPClientTests/ProtocolTransportTests.swift</h3><pre><a class=linenum name='L1'>0001</a>    <span class='comment' title='source.lang.swift.syntaxtype.comment'>//
<a class=linenum name='L2'>0002</a>    </span><span class='comment' title='source.lang.swift.syntaxtype.comment'>//  ProtocolTransportTests.swift
<a class=linenum name='L3'>0003</a>    </span><span class='comment' title='source.lang.swift.syntaxtype.comment'>//  SwiftLSPClientTests
<a class=linenum name='L4'>0004</a>    </span><span class='comment' title='source.lang.swift.syntaxtype.comment'>//
<a class=linenum name='L5'>0005</a>    </span><span class='comment' title='source.lang.swift.syntaxtype.comment'>//  Created by Matt Massicotte on 2019-02-07.
<a class=linenum name='L6'>0006</a>    </span><span class='comment' title='source.lang.swift.syntaxtype.comment'>//  Copyright Â© 2019 Chime Systems. All rights reserved.
<a class=linenum name='L7'>0007</a>    </span><span class='comment' title='source.lang.swift.syntaxtype.comment'>//
<a class=linenum name='L8'>0008</a>    </span>
<a class=linenum name='L9'>0009</a>    <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>import</span> <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTest</span>
<a class=linenum name='L10'>0010</a>    <span class='builtin' title='source.lang.swift.syntaxtype.attribute.builtin'>@testable</span> <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>import</span> <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>SwiftLSPClient</span>
<a class=linenum name='L11'>0011</a>    
<a class=linenum name='L12'>0012</a>    <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>class</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='12_6'>ProtocolTransportTests</a></span>: <span class='typeidentifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTestCase</span> {
<a class=linenum name='L13'>0013</a>        <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>typealias</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='13_14'>TestResult</a></span> = <span class='typeidentifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>Result</span>&lt;<span class='typeidentifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>JSONRPCResultResponse</span>&lt;<span class='typeidentifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>TextDocumentIdentifier</span>>, <span class='typeidentifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>ProtocolTransportError</span>>
<a class=linenum name='L14'>0014</a>    
<a class=linenum name='L15'>0015</a>        <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>func</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='15_9'>testSendRequest</a></span>() {
<a class=linenum name='L16'>0016</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='16_12'>dataTransport</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>MockDataTransport</span>()
<a class=linenum name='L17'>0017</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='17_12'>messageTransport</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>MessageTransport</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>dataTransport</span>: <span class='identifier' title='ProtocolTransportTests.swift'><a name='17_63' href='ProtocolTransportTests.swift.html#16_12'>dataTransport</a></span>)
<a class=linenum name='L18'>0018</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='18_12'>transport</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>ProtocolTransport</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>messageTransport</span>: <span class='identifier' title='ProtocolTransportTests.swift'><a name='18_60' href='ProtocolTransportTests.swift.html#17_12'>messageTransport</a></span>)
<a class=linenum name='L19'>0019</a>    
<a class=linenum name='L20'>0020</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='20_12'>expectation</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTestExpectation</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>description</span>: <span class='string' title='source.lang.swift.syntaxtype.string'>"Response Message"</span>)
<a class=linenum name='L21'>0021</a>    
<a class=linenum name='L22'>0022</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='22_12'>request</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>TextDocumentIdentifier</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>uri</span>: <span class='string' title='source.lang.swift.syntaxtype.string'>"hello"</span>)
<a class=linenum name='L23'>0023</a>            <span class='identifier' title='ProtocolTransportTests.swift'><a name='23_8' href='ProtocolTransportTests.swift.html#18_12'>transport</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>sendRequest</span>(<span class='identifier' title='ProtocolTransportTests.swift'><a name='23_30' href='ProtocolTransportTests.swift.html#22_12'>request</a></span>, <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>method</span>: <span class='string' title='source.lang.swift.syntaxtype.string'>"mymethod"</span>) { (<span class='identifier' title='ProtocolTransportTests.swift'><a name='23_62'>result</a></span>: <span class='typeidentifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>TestResult</span>) <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>in</span>
<a class=linenum name='L24'>0024</a>                <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='24_16'>value</a></span> = <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>try</span>? <span class='identifier' title='ProtocolTransportTests.swift'><a name='24_29' href='ProtocolTransportTests.swift.html#23_62'>result</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>get</span>()
<a class=linenum name='L25'>0025</a>                <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTAssertEqual</span>(<span class='identifier' title='ProtocolTransportTests.swift'><a name='25_27' href='ProtocolTransportTests.swift.html#24_16'>value</a></span>?.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>result</span>, <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>TextDocumentIdentifier</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>uri</span>: <span class='string' title='source.lang.swift.syntaxtype.string'>"goodbye"</span>))
<a class=linenum name='L26'>0026</a>    
<a class=linenum name='L27'>0027</a>                <span class='identifier' title='ProtocolTransportTests.swift'><a name='27_12' href='ProtocolTransportTests.swift.html#20_12'>expectation</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>fulfill</span>()
<a class=linenum name='L28'>0028</a>            }
<a class=linenum name='L29'>0029</a>    
<a class=linenum name='L30'>0030</a>            <span class='identifier' title='ProtocolTransportTests.swift'><a name='30_8' href='ProtocolTransportTests.swift.html#16_12'>dataTransport</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>mockRead</span>(<span class='string' title='source.lang.swift.syntaxtype.string'>"Content-Length: 51\r\n\r\n"</span>)
<a class=linenum name='L31'>0031</a>            <span class='identifier' title='ProtocolTransportTests.swift'><a name='31_8' href='ProtocolTransportTests.swift.html#16_12'>dataTransport</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>mockRead</span>(<span class='string' title='source.lang.swift.syntaxtype.string'>"""
<a class=linenum name='L32'>0032</a>    {"jsonrpc":"2.0","id":1,"result":{"uri":"goodbye"}}
<a class=linenum name='L33'>0033</a>    """</span>)
<a class=linenum name='L34'>0034</a>    
<a class=linenum name='L35'>0035</a>            <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>wait</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>for</span>: [<span class='identifier' title='ProtocolTransportTests.swift'><a name='35_19' href='ProtocolTransportTests.swift.html#20_12'>expectation</a></span>], <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>timeout</span>: <span class='number' title='source.lang.swift.syntaxtype.number'>1.0</span>)
<a class=linenum name='L36'>0036</a>        }
<a class=linenum name='L37'>0037</a>    
<a class=linenum name='L38'>0038</a>        <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>func</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='38_9'>testManySendRequestsWithResponsesDeliveredOnABackgroundQueueTest</a></span>() {
<a class=linenum name='L39'>0039</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='39_12'>dataTransport</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>MockDataTransport</span>()
<a class=linenum name='L40'>0040</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='40_12'>messageTransport</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>MessageTransport</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>dataTransport</span>: <span class='identifier' title='ProtocolTransportTests.swift'><a name='40_63' href='ProtocolTransportTests.swift.html#39_12'>dataTransport</a></span>)
<a class=linenum name='L41'>0041</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='41_12'>transport</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>ProtocolTransport</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>messageTransport</span>: <span class='identifier' title='ProtocolTransportTests.swift'><a name='41_60' href='ProtocolTransportTests.swift.html#40_12'>messageTransport</a></span>)
<a class=linenum name='L42'>0042</a>    
<a class=linenum name='L43'>0043</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='43_12'>iterations</a></span> = <span class='number' title='source.lang.swift.syntaxtype.number'>1000</span>
<a class=linenum name='L44'>0044</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='44_12'>expectation</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTestExpectation</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>description</span>: <span class='string' title='source.lang.swift.syntaxtype.string'>"Response Message"</span>)
<a class=linenum name='L45'>0045</a>            <span class='identifier' title='ProtocolTransportTests.swift'><a name='45_8' href='ProtocolTransportTests.swift.html#44_12'>expectation</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>expectedFulfillmentCount</span> = <span class='identifier' title='ProtocolTransportTests.swift'><a name='45_47' href='ProtocolTransportTests.swift.html#43_12'>iterations</a></span>
<a class=linenum name='L46'>0046</a>    
<a class=linenum name='L47'>0047</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='47_12'>request</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>TextDocumentIdentifier</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>uri</span>: <span class='string' title='source.lang.swift.syntaxtype.string'>"hello"</span>)
<a class=linenum name='L48'>0048</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='48_12'>encoder</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>JSONEncoder</span>()
<a class=linenum name='L49'>0049</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='49_12'>queue</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>DispatchQueue</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>label</span>: <span class='string' title='source.lang.swift.syntaxtype.string'>"SimluatedFileHandleQueue"</span>)
<a class=linenum name='L50'>0050</a>    
<a class=linenum name='L51'>0051</a>            <span class='comment' title='source.lang.swift.syntaxtype.comment'>// be sure to start at 1, to match ProtocolTransport's id generation
<a class=linenum name='L52'>0052</a>    </span>        <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>for</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='52_12'>i</a></span> <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>in</span> <span class='number' title='source.lang.swift.syntaxtype.number'>1</span>...<span class='identifier' title='ProtocolTransportTests.swift'><a name='52_21' href='ProtocolTransportTests.swift.html#43_12'>iterations</a></span> {
<a class=linenum name='L53'>0053</a>                <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='53_16'>responseDocIdentifier</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>TextDocumentIdentifier</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>uri</span>: <span class='string' title='source.lang.swift.syntaxtype.string'>"goodbye-</span>\<span class='string_interpolation_anchor' title='source.lang.swift.syntaxtype.string_interpolation_anchor'>(</span><span class='identifier' title='ProtocolTransportTests.swift'><a name='53_79' href='ProtocolTransportTests.swift.html#52_12'>i</a></span><span class='string_interpolation_anchor' title='source.lang.swift.syntaxtype.string_interpolation_anchor'>)</span><span class='string' title='source.lang.swift.syntaxtype.string'>"</span>)
<a class=linenum name='L54'>0054</a>    
<a class=linenum name='L55'>0055</a>                <span class='identifier' title='ProtocolTransportTests.swift'><a name='55_12' href='ProtocolTransportTests.swift.html#41_12'>transport</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>sendRequest</span>(<span class='identifier' title='ProtocolTransportTests.swift'><a name='55_34' href='ProtocolTransportTests.swift.html#47_12'>request</a></span>, <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>method</span>: <span class='string' title='source.lang.swift.syntaxtype.string'>"mymethod"</span>) { (<span class='identifier' title='ProtocolTransportTests.swift'><a name='55_66'>result</a></span>: <span class='typeidentifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>TestResult</span>) <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>in</span>
<a class=linenum name='L56'>0056</a>                    <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='56_20'>value</a></span> = <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>try</span>? <span class='identifier' title='ProtocolTransportTests.swift'><a name='56_33' href='ProtocolTransportTests.swift.html#55_66'>result</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>get</span>()
<a class=linenum name='L57'>0057</a>                    <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTAssertEqual</span>(<span class='identifier' title='ProtocolTransportTests.swift'><a name='57_31' href='ProtocolTransportTests.swift.html#56_20'>value</a></span>?.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>result</span>, <span class='identifier' title='ProtocolTransportTests.swift'><a name='57_46' href='ProtocolTransportTests.swift.html#53_16'>responseDocIdentifier</a></span>)
<a class=linenum name='L58'>0058</a>    
<a class=linenum name='L59'>0059</a>                    <span class='identifier' title='ProtocolTransportTests.swift'><a name='59_16' href='ProtocolTransportTests.swift.html#44_12'>expectation</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>fulfill</span>()
<a class=linenum name='L60'>0060</a>                }
<a class=linenum name='L61'>0061</a>    
<a class=linenum name='L62'>0062</a>                <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='62_16'>response</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>JSONRPCResultResponse</span>&lt;<span class='typeidentifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>TextDocumentIdentifier</span>>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>id</span>: <span class='identifier' title='ProtocolTransportTests.swift'><a name='62_77' href='ProtocolTransportTests.swift.html#52_12'>i</a></span>, <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>result</span>: <span class='identifier' title='ProtocolTransportTests.swift'><a name='62_88' href='ProtocolTransportTests.swift.html#53_16'>responseDocIdentifier</a></span>)
<a class=linenum name='L63'>0063</a>                <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='63_16'>responseData</a></span> = <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>try</span>! <span class='identifier' title='ProtocolTransportTests.swift'><a name='63_36' href='ProtocolTransportTests.swift.html#48_12'>encoder</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>encode</span>(<span class='identifier' title='ProtocolTransportTests.swift'><a name='63_51' href='ProtocolTransportTests.swift.html#62_16'>response</a></span>)
<a class=linenum name='L64'>0064</a>                <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='64_16'>responseMessage</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>MessageTransport</span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>createMessage</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>with</span>: <span class='identifier' title='ProtocolTransportTests.swift'><a name='64_71' href='ProtocolTransportTests.swift.html#63_16'>responseData</a></span>)
<a class=linenum name='L65'>0065</a>    
<a class=linenum name='L66'>0066</a>                <span class='comment' title='source.lang.swift.syntaxtype.comment'>// this must happen asynchronously to match the behavior of NSFileHandle
<a class=linenum name='L67'>0067</a>    </span>            <span class='identifier' title='ProtocolTransportTests.swift'><a name='67_12' href='ProtocolTransportTests.swift.html#49_12'>queue</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>async</span> {
<a class=linenum name='L68'>0068</a>                    <span class='identifier' title='ProtocolTransportTests.swift'><a name='68_16' href='ProtocolTransportTests.swift.html#39_12'>dataTransport</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>mockRead</span>(<span class='identifier' title='ProtocolTransportTests.swift'><a name='68_39' href='ProtocolTransportTests.swift.html#64_16'>responseMessage</a></span>)
<a class=linenum name='L69'>0069</a>                }
<a class=linenum name='L70'>0070</a>            }
<a class=linenum name='L71'>0071</a>    
<a class=linenum name='L72'>0072</a>            <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>wait</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>for</span>: [<span class='identifier' title='ProtocolTransportTests.swift'><a name='72_19' href='ProtocolTransportTests.swift.html#44_12'>expectation</a></span>], <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>timeout</span>: <span class='number' title='source.lang.swift.syntaxtype.number'>2.0</span>)
<a class=linenum name='L73'>0073</a>        }
<a class=linenum name='L74'>0074</a>    
<a class=linenum name='L75'>0075</a>        <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>func</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='75_9'>testSendNotification</a></span>() {
<a class=linenum name='L76'>0076</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='76_12'>dataTransport</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>MockDataTransport</span>()
<a class=linenum name='L77'>0077</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='77_12'>messageTransport</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>MessageTransport</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>dataTransport</span>: <span class='identifier' title='ProtocolTransportTests.swift'><a name='77_63' href='ProtocolTransportTests.swift.html#76_12'>dataTransport</a></span>)
<a class=linenum name='L78'>0078</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='78_12'>transport</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>ProtocolTransport</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>messageTransport</span>: <span class='identifier' title='ProtocolTransportTests.swift'><a name='78_60' href='ProtocolTransportTests.swift.html#77_12'>messageTransport</a></span>)
<a class=linenum name='L79'>0079</a>    
<a class=linenum name='L80'>0080</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='80_12'>expectation</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTestExpectation</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>description</span>: <span class='string' title='source.lang.swift.syntaxtype.string'>"Notification Message"</span>)
<a class=linenum name='L81'>0081</a>    
<a class=linenum name='L82'>0082</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='82_12'>request</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>TextDocumentIdentifier</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>uri</span>: <span class='string' title='source.lang.swift.syntaxtype.string'>"hello"</span>)
<a class=linenum name='L83'>0083</a>    
<a class=linenum name='L84'>0084</a>            <span class='identifier' title='ProtocolTransportTests.swift'><a name='84_8' href='ProtocolTransportTests.swift.html#78_12'>transport</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>sendNotification</span>(<span class='identifier' title='ProtocolTransportTests.swift'><a name='84_35' href='ProtocolTransportTests.swift.html#82_12'>request</a></span>, <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>method</span>: <span class='string' title='source.lang.swift.syntaxtype.string'>"mynotification"</span>) { (<span class='identifier' title='ProtocolTransportTests.swift'><a name='84_73'>error</a></span>) <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>in</span>
<a class=linenum name='L85'>0085</a>                <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTAssertNil</span>(<span class='identifier' title='ProtocolTransportTests.swift'><a name='85_25' href='ProtocolTransportTests.swift.html#84_73'>error</a></span>)
<a class=linenum name='L86'>0086</a>                <span class='identifier' title='ProtocolTransportTests.swift'><a name='86_12' href='ProtocolTransportTests.swift.html#80_12'>expectation</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>fulfill</span>()
<a class=linenum name='L87'>0087</a>            }
<a class=linenum name='L88'>0088</a>    
<a class=linenum name='L89'>0089</a>            <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>wait</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>for</span>: [<span class='identifier' title='ProtocolTransportTests.swift'><a name='89_19' href='ProtocolTransportTests.swift.html#80_12'>expectation</a></span>], <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>timeout</span>: <span class='number' title='source.lang.swift.syntaxtype.number'>1.0</span>)
<a class=linenum name='L90'>0090</a>    
<a class=linenum name='L91'>0091</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='91_12'>result</a></span> = <span class='string' title='source.lang.swift.syntaxtype.string'>"Content-Length: 68\r\n\r\n{\"jsonrpc\":\"2.0\",\"method\":\"mynotification\",\"params\":{\"uri\":\"hello\"}}"</span>
<a class=linenum name='L92'>0092</a>    
<a class=linenum name='L93'>0093</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='93_12'>writtenStrings</a></span> = <span class='identifier' title='ProtocolTransportTests.swift'><a name='93_29' href='ProtocolTransportTests.swift.html#76_12'>dataTransport</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>writtenData</span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>compactMap</span>({ <span class='identifier' title='x86_64-apple-macos.swiftmodule'>String</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>data</span>: <span class='identifier' title='ProtocolTransportTests.swift'><a name='93_81' href='ProtocolTransportTests.swift.html#93_66'>$0</a></span>, <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>encoding</span>: .<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>utf8</span>) })
<a class=linenum name='L94'>0094</a>    
<a class=linenum name='L95'>0095</a>            <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTAssertEqual</span>(<span class='identifier' title='ProtocolTransportTests.swift'><a name='95_23' href='ProtocolTransportTests.swift.html#93_12'>writtenStrings</a></span>, [<span class='identifier' title='ProtocolTransportTests.swift'><a name='95_40' href='ProtocolTransportTests.swift.html#91_12'>result</a></span>])
<a class=linenum name='L96'>0096</a>        }
<a class=linenum name='L97'>0097</a>    
<a class=linenum name='L98'>0098</a>        <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>func</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='98_9'>testServerToClientNotification</a></span>() {
<a class=linenum name='L99'>0099</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='99_12'>dataTransport</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>MockDataTransport</span>()
<a class=linenum name='L100'>0100</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='100_12'>messageTransport</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>MessageTransport</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>dataTransport</span>: <span class='identifier' title='ProtocolTransportTests.swift'><a name='100_63' href='ProtocolTransportTests.swift.html#99_12'>dataTransport</a></span>)
<a class=linenum name='L101'>0101</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='101_12'>transport</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>ProtocolTransport</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>messageTransport</span>: <span class='identifier' title='ProtocolTransportTests.swift'><a name='101_60' href='ProtocolTransportTests.swift.html#100_12'>messageTransport</a></span>)
<a class=linenum name='L102'>0102</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='102_12'>transportDelegate</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>MockProtocolTransportDelegate</span>()
<a class=linenum name='L103'>0103</a>    
<a class=linenum name='L104'>0104</a>            <span class='identifier' title='ProtocolTransportTests.swift'><a name='104_8' href='ProtocolTransportTests.swift.html#101_12'>transport</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>delegate</span> = <span class='identifier' title='ProtocolTransportTests.swift'><a name='104_29' href='ProtocolTransportTests.swift.html#102_12'>transportDelegate</a></span>
<a class=linenum name='L105'>0105</a>    
<a class=linenum name='L106'>0106</a>            <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='106_12'>expectation</a></span> = <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTestExpectation</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>description</span>: <span class='string' title='source.lang.swift.syntaxtype.string'>"Notification Message"</span>)
<a class=linenum name='L107'>0107</a>    
<a class=linenum name='L108'>0108</a>            <span class='identifier' title='ProtocolTransportTests.swift'><a name='108_8' href='ProtocolTransportTests.swift.html#102_12'>transportDelegate</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>notificationHandler</span> = { (<span class='identifier' title='ProtocolTransportTests.swift'><a name='108_51'>method</a></span>, <span class='identifier' title='ProtocolTransportTests.swift'><a name='108_59'>data</a></span>) <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>in</span>
<a class=linenum name='L109'>0109</a>                <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTAssertEqual</span>(<span class='identifier' title='ProtocolTransportTests.swift'><a name='109_27' href='ProtocolTransportTests.swift.html#108_51'>method</a></span>, <span class='string' title='source.lang.swift.syntaxtype.string'>"iamnotification"</span>)
<a class=linenum name='L110'>0110</a>    
<a class=linenum name='L111'>0111</a>                <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>let</span> <span class='identifier' title='ProtocolTransportTests.swift'><a name='111_16'>result</a></span> = <span class='keyword' title='source.lang.swift.syntaxtype.keyword'>try</span>? <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>JSONDecoder</span>().<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>decode</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>JSONRPCNotificationParams</span>&lt;<span class='typeidentifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>String</span>>.<span class='keyword' title='source.lang.swift.syntaxtype.keyword'>self</span>, <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>from</span>: <span class='identifier' title='ProtocolTransportTests.swift'><a name='111_97' href='ProtocolTransportTests.swift.html#108_59'>data</a></span>)
<a class=linenum name='L112'>0112</a>    
<a class=linenum name='L113'>0113</a>                <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>XCTAssertEqual</span>(<span class='identifier' title='ProtocolTransportTests.swift'><a name='113_27' href='ProtocolTransportTests.swift.html#111_16'>result</a></span>?.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>params</span>, <span class='string' title='source.lang.swift.syntaxtype.string'>"iamstring"</span>)
<a class=linenum name='L114'>0114</a>                <span class='identifier' title='ProtocolTransportTests.swift'><a name='114_12' href='ProtocolTransportTests.swift.html#106_12'>expectation</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>fulfill</span>()
<a class=linenum name='L115'>0115</a>            }
<a class=linenum name='L116'>0116</a>    
<a class=linenum name='L117'>0117</a>            <span class='identifier' title='ProtocolTransportTests.swift'><a name='117_8' href='ProtocolTransportTests.swift.html#99_12'>dataTransport</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>mockRead</span>(<span class='string' title='source.lang.swift.syntaxtype.string'>"Content-Length: 65\r\n\r\n"</span>)
<a class=linenum name='L118'>0118</a>            <span class='identifier' title='ProtocolTransportTests.swift'><a name='118_8' href='ProtocolTransportTests.swift.html#99_12'>dataTransport</a></span>.<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>mockRead</span>(<span class='string' title='source.lang.swift.syntaxtype.string'>"""
<a class=linenum name='L119'>0119</a>    {"jsonrpc":"2.0","method":"iamnotification","params":"iamstring"}
<a class=linenum name='L120'>0120</a>    """</span>)
<a class=linenum name='L121'>0121</a>    
<a class=linenum name='L122'>0122</a>            <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>wait</span>(<span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>for</span>: [<span class='identifier' title='ProtocolTransportTests.swift'><a name='122_19' href='ProtocolTransportTests.swift.html#106_12'>expectation</a></span>], <span class='identifier' title='success(Optional(SwiftLSPClient.TypeDefinitionResponse.locationArray([])))'>timeout</span>: <span class='number' title='source.lang.swift.syntaxtype.number'>1.0</span>)
<a class=linenum name='L123'>0123</a>        }
<a class=linenum name='L124'>0124</a>    }
<a class=linenum name='L125'>0125</a>    