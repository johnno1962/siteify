<html><head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="siteify.css">
<script>

var lastlink;

function expand(a) {
    if ( a.children[0].style.display != "block" ) {
        if ( lastlink )
            lastlink.style.display = "none";
        a.children[0].style.display = "block";
        lastlink = a.children[0];
    }
    else {
        a.children[0].style.display = "none";
        lastlink = null;
    }
    return false;
}

</script></head><body><pre>
0001    <span class='comment'><a name='1_0'>//
0002    </a></span><span class='comment'><a name='2_0'>//  Entity.swift
0003    </a></span><span class='comment'><a name='3_0'>//  refactord
0004    </a></span><span class='comment'><a name='4_0'>//
0005    </a></span><span class='comment'><a name='5_0'>//  Created by John Holdsworth on 19/02/2016.
0006    </a></span><span class='comment'><a name='6_0'>//  Copyright Â© 2016 John Holdsworth. All rights reserved.
0007    </a></span><span class='comment'><a name='7_0'>//
0008    </a></span><span class='comment'><a name='8_0'>//  $Id: //depot/siteify/siteify/Entity.swift#7 $
0009    </a></span><span class='comment'><a name='9_0'>//
0010    </a></span><span class='comment'><a name='10_0'>//  Repo: </a></span><span class='url'><a href='https://github.com/johnno1962/Refactorator'>https://github.com/johnno1962/Refactorator</a></span><span class='comment'><a name='10_52'>
0011    </a></span><span class='comment'><a name='11_0'>//
0012    </a></span>
0013    <span class='keyword'><a name='13_0'>import</a></span> <span class='identifier'><a name='13_7'>Foundation</a></span>
0014    
0015    <span class='keyword'><a name='15_0'>class</a></span> <span class='identifier'><a name='15_6'>Entity</a></span>: <span class='typeidentifier'><a name='15_14'>Hashable</a></span> {
0016    
0017        <span class='keyword'><a name='17_4'>let</a></span> <span class='identifier'><a name='17_8'>file</a></span>: <span class='typeidentifier'><a name='17_14'>String</a></span>, <span class='identifier'><a name='17_22'>line</a></span>: <span class='typeidentifier'><a name='17_28'>Int</a></span>, <span class='identifier'><a name='17_33'>col</a></span>: <span class='typeidentifier'><a name='17_38'>Int</a></span>, <span class='identifier'><a name='17_43'>kind</a></span>: <span class='typeidentifier'><a name='17_49'>String</a></span>?, <span class='identifier'><a name='17_58'>decl</a></span>: <span class='typeidentifier'><a name='17_64'>Bool</a></span>
0018    
0019        <span class='keyword'><a name='19_4' title='usrString3'>init</a></span>( <span class='identifier'><a name='19_10'>file</a></span>: <span class='typeidentifier'><a name='19_16'>String</a></span>, <span class='identifier'><a name='19_24'>line</a></span>: <span class='typeidentifier'><a name='19_30'>Int</a></span>, <span class='identifier'><a name='19_35'>col</a></span>: <span class='typeidentifier'><a name='19_40'>Int</a></span>, <span class='identifier'><a name='19_45'>kind</a></span>: <span class='typeidentifier'><a name='19_51'>String</a></span>? = <span class='keyword'><a name='19_61'>nil</a></span>, <span class='identifier'><a name='19_66'>decl</a></span>: <span class='typeidentifier'><a name='19_72'>Bool</a></span> = <span class='keyword'><a name='19_79'>false</a></span> ) {
0020            <span class='keyword'><a name='20_8' href='Entity.html#19_4' title='usrString1'>self</a></span>.<span class='identifier'><a name='20_13'>file</a></span> = <span class='identifier'><a name='20_20'>file</a></span>
0021            <span class='keyword'><a name='21_8' href='Entity.html#19_4' title='usrString1'>self</a></span>.<span class='identifier'><a name='21_13'>line</a></span> = <span class='identifier'><a name='21_20'>line</a></span>
0022            <span class='keyword'><a name='22_8' href='Entity.html#19_4' title='usrString1'>self</a></span>.<span class='identifier'><a name='22_13'>col</a></span> = <span class='identifier'><a name='22_19'>col</a></span>
0023            <span class='keyword'><a name='23_8' href='Entity.html#19_4' title='usrString1'>self</a></span>.<span class='identifier'><a name='23_13'>kind</a></span> = <span class='identifier'><a name='23_20'>kind</a></span>
0024            <span class='keyword'><a name='24_8' href='Entity.html#19_4' title='usrString1'>self</a></span>.<span class='identifier'><a name='24_13'>decl</a></span> = <span class='identifier'><a name='24_20'>decl</a></span>
0025        }
0026    
0027        <span class='keyword'><a name='27_4'>var</a></span> <span class='identifier'><a name='27_8'>hashValue</a></span>: <span class='typeidentifier'><a name='27_19'>Int</a></span> {
0028            <span class='keyword'><a name='28_8'>return</a></span> <span class='identifier'><a name='28_15'>line</a></span> + <span class='identifier'><a name='28_22'>col</a></span>
0029        }
0030    
0031        <span class='keyword'><a name='31_4'>func</a></span> <span class='identifier'><a name='31_9'>regex</a></span>( <span class='identifier'><a name='31_16'>text</a></span>: <span class='typeidentifier'><a name='31_22'>String</a></span> ) -> <span class='typeidentifier'><a name='31_34' href='ByteRegex.html#23_6' title='usrString1'>ByteRegex</a></span> {
0032            <span class='keyword'><a name='32_8'>var</a></span> <span class='identifier'><a name='32_12'>pattern</a></span> = <span class='string'><a name='32_22'>"^"</a></span>
0033            <span class='keyword'><a name='33_8'>var</a></span> <span class='identifier'><a name='33_12'>line</a></span> = <span class='keyword'><a name='33_19' href='Entity.html#31_9' title='usrString1'>self</a></span>.<span class='identifier'><a name='33_24'>line</a></span>
0034            <span class='keyword'><a name='34_8'>while</a></span> <span class='identifier'><a name='34_14'>line</a></span> > <span class='number'><a name='34_21'>100</a></span> {
0035                <span class='identifier'><a name='35_12'>pattern</a></span> += <span class='string'><a name='35_23'>"(?:[^\n]*\n){100}"</a></span>
0036                <span class='identifier'><a name='36_12'>line</a></span> -= <span class='number'><a name='36_20'>100</a></span>
0037            }
0038            <span class='keyword'><a name='38_8'>var</a></span> <span class='identifier'><a name='38_12'>col</a></span> = <span class='keyword'><a name='38_18' href='Entity.html#31_9' title='usrString1'>self</a></span>.<span class='identifier'><a name='38_23'>col</a></span>, <span class='identifier'><a name='38_28'>largecol</a></span> = <span class='string'><a name='38_39'>""</a></span>
0039            <span class='keyword'><a name='39_8'>while</a></span> <span class='identifier'><a name='39_14'>col</a></span> > <span class='number'><a name='39_20'>100</a></span> {
0040                <span class='identifier'><a name='40_12'>largecol</a></span> += <span class='string'><a name='40_24'>".{100}"</a></span>
0041                <span class='identifier'><a name='41_12'>col</a></span> -= <span class='number'><a name='41_19'>100</a></span>
0042            }
0043            <span class='identifier'><a name='43_8'>pattern</a></span> += <span class='string'><a name='43_19'>"(?:[^\n]*\n){</a></span>\<span class='string_interpolation_anchor'><a name='43_34'>(</a></span><span class='identifier'><a name='43_35'>line</a></span>-<span class='number'><a name='43_40'>1</a></span><span class='string_interpolation_anchor'><a name='43_41'>)</a></span><span class='string'><a name='43_42'>}(</a></span>\<span class='string_interpolation_anchor'><a name='43_45'>(</a></span><span class='identifier'><a name='43_46'>largecol</a></span><span class='string_interpolation_anchor'><a name='43_54'>)</a></span><span class='string'><a name='43_55'>.{</a></span>\<span class='string_interpolation_anchor'><a name='43_58'>(</a></span><span class='identifier'><a name='43_59'>col</a></span>-<span class='number'><a name='43_63'>1</a></span><span class='string_interpolation_anchor'><a name='43_64'>)</a></span><span class='string'><a name='43_65'>}[^\n]*?)(</a></span>\<span class='string_interpolation_anchor'><a name='43_76'>(</a></span><span class='identifier'><a name='43_77'>text</a></span><span class='string_interpolation_anchor'><a name='43_81'>)</a></span><span class='string'><a name='43_82'>)([^\n]*)"</a></span>
0044            <span class='keyword'><a name='44_8'>return</a></span> <span class='identifier'><a name='44_15'>ByteRegex</a></span>( <span class='identifier'><a name='44_26'>pattern</a></span>: <span class='identifier'><a name='44_35'>pattern</a></span> )
0045        }
0046    
0047        <span class='keyword'><a name='47_4'>func</a></span> <span class='identifier'><a name='47_9'>patchText</a></span>( <span class='identifier'><a name='47_20'>contents</a></span>: <span class='typeidentifier'><a name='47_30'>NSData</a></span>, <span class='identifier'><a name='47_38'>value</a></span>: <span class='typeidentifier'><a name='47_45'>String</a></span> ) -> <span class='typeidentifier'><a name='47_57'>String</a></span>? {
0048            <span class='keyword'><a name='48_8'>if</a></span> <span class='keyword'><a name='48_11'>let</a></span> <span class='identifier'><a name='48_15'>matches</a></span> = <span class='identifier'><a name='48_25'>regex</a></span>( <span class='identifier'><a name='48_32'>text</a></span>: <span class='identifier'><a name='48_38'>value</a></span> ).<span class='identifier'><a name='48_46'>match</a></span>( <span class='identifier'><a name='48_53'>input</a></span>: <span class='identifier'><a name='48_60'>contents</a></span> ) {
0049                <span class='keyword'><a name='49_12'>var</a></span> <span class='identifier'><a name='49_16'>b</a></span> = <span class='string'><a name='49_20'>"&lt;b title='"</a></span> + (<span class='identifier'><a name='49_36'>kind</a></span> ?? <span class='string'><a name='49_44'>"UNKNOWN"</a></span>) + <span class='string'><a name='49_57'>"'"</a></span>
0050                <span class='keyword'><a name='50_12'>if</a></span> <span class='identifier'><a name='50_15'>decl</a></span> {
0051                    <span class='identifier'><a name='51_16'>b</a></span> += <span class='string'><a name='51_21'>" style='color: blue'"</a></span>
0052                }
0053                <span class='identifier'><a name='53_12'>b</a></span> += <span class='string'><a name='53_17'>">"</a></span>
0054                <span class='keyword'><a name='54_12'>return</a></span> <span class='identifier'><a name='54_19'>htmlClean</a></span>( <span class='identifier'><a name='54_30'>contents</a></span>: <span class='identifier'><a name='54_40'>contents</a></span>, <span class='identifier'><a name='54_50'>match</a></span>: <span class='identifier'><a name='54_57'>matches</a></span>[<span class='number'><a name='54_65'>1</a></span>] ) +
0055                    <span class='identifier'><a name='55_16'>b</a></span> + <span class='identifier'><a name='55_20'>htmlClean</a></span>( <span class='identifier'><a name='55_31'>contents</a></span>: <span class='identifier'><a name='55_41'>contents</a></span>, <span class='identifier'><a name='55_51'>match</a></span>: <span class='identifier'><a name='55_58'>matches</a></span>[<span class='number'><a name='55_66'>2</a></span>] ) + <span class='string'><a name='55_73'>"&lt;/b>"</a></span> +
0056                    <span class='identifier'><a name='56_16'>htmlClean</a></span>( <span class='identifier'><a name='56_27'>contents</a></span>: <span class='identifier'><a name='56_37'>contents</a></span>, <span class='identifier'><a name='56_47'>match</a></span>: <span class='identifier'><a name='56_54'>matches</a></span>[<span class='number'><a name='56_62'>3</a></span>] )
0057            }
0058            <span class='keyword'><a name='58_8'>return</a></span> <span class='string'><a name='58_15'>"MATCH FAILED line:</a></span>\<span class='string_interpolation_anchor'><a name='58_35'>(</a></span><span class='identifier'><a name='58_36'>line</a></span><span class='string_interpolation_anchor'><a name='58_40'>)</a></span><span class='string'><a name='58_41'> column:</a></span>\<span class='string_interpolation_anchor'><a name='58_50'>(</a></span><span class='identifier'><a name='58_51'>col</a></span><span class='string_interpolation_anchor'><a name='58_54'>)</a></span><span class='string'><a name='58_55'>"</a></span>
0059        }
0060    
0061        <span class='keyword'><a name='61_4'>func</a></span> <span class='identifier'><a name='61_9'>htmlClean</a></span>( <span class='identifier'><a name='61_20'>contents</a></span>: <span class='typeidentifier'><a name='61_30'>NSData</a></span>, <span class='identifier'><a name='61_38'>match</a></span>: <span class='typeidentifier'><a name='61_45'>regmatch_t</a></span> ) -> <span class='typeidentifier'><a name='61_61'>String</a></span> {
0062            <span class='keyword'><a name='62_8'>var</a></span> <span class='identifier'><a name='62_12'>range</a></span> = <span class='identifier'><a name='62_20'>match</a></span>.<span class='identifier'><a name='62_26'>range</a></span>
0063            <span class='keyword'><a name='63_8'>if</a></span> <span class='identifier'><a name='63_11'>range</a></span>.<span class='identifier'><a name='63_17'>length</a></span> > <span class='identifier'><a name='63_26'>contents</a></span>.<span class='identifier'><a name='63_35'>length</a></span> - <span class='identifier'><a name='63_44'>range</a></span>.<span class='identifier'><a name='63_50'>location</a></span> {
0064                <span class='identifier'><a name='64_12'>range</a></span>.<span class='identifier'><a name='64_18'>length</a></span> = <span class='identifier'><a name='64_27'>contents</a></span>.<span class='identifier'><a name='64_36'>length</a></span> - <span class='identifier'><a name='64_45'>range</a></span>.<span class='identifier'><a name='64_51'>location</a></span>
0065            }
0066            <span class='keyword'><a name='66_8'>return</a></span> <span class='identifier'><a name='66_15'>String</a></span>.<span class='identifier'><a name='66_22'>fromData</a></span>( <span class='identifier'><a name='66_32'>data</a></span>: <span class='identifier'><a name='66_38'>contents</a></span>.<span class='identifier'><a name='66_47'>subdata</a></span>( <span class='identifier'><a name='66_56'>with</a></span>: <span class='identifier'><a name='66_62'>range</a></span> ) <span class='keyword'><a name='66_70'>as</a></span> <span class='typeidentifier'><a name='66_73'>NSData</a></span> )?
0067                .<span class='identifier'><a name='67_13'>replacingOccurrences</a></span>( <span class='identifier'><a name='67_35'>of</a></span>: <span class='string'><a name='67_39'>"&amp;"</a></span>, <span class='identifier'><a name='67_44'>with</a></span>: <span class='string'><a name='67_50'>"&amp;amp;"</a></span> )
0068                .<span class='identifier'><a name='68_13'>replacingOccurrences</a></span>( <span class='identifier'><a name='68_35'>of</a></span>: <span class='string'><a name='68_39'>"&lt;"</a></span>, <span class='identifier'><a name='68_44'>with</a></span>: <span class='string'><a name='68_50'>"&amp;lt;"</a></span> ) ?? <span class='string'><a name='68_62'>"CONVERSION FAILED"</a></span>
0069        }
0070    
0071    }
0072    
0073    <span class='keyword'><a name='73_0'>func</a></span> ==(<span class='identifier'><a name='73_8'>lhs</a></span>: <span class='typeidentifier'><a name='73_13' href='Entity.html#15_6' title='usrString1'>Entity</a></span>, <span class='identifier'><a name='73_21'>rhs</a></span>: <span class='typeidentifier'><a name='73_26' href='Entity.html#15_6' title='usrString1'>Entity</a></span>) -> <span class='typeidentifier'><a name='73_37'>Bool</a></span> {
0074        <span class='keyword'><a name='74_4'>return</a></span> <span class='identifier'><a name='74_11'>lhs</a></span>.<span class='identifier'><a name='74_15'>line</a></span> == <span class='identifier'><a name='74_23'>rhs</a></span>.<span class='identifier'><a name='74_27'>line</a></span> &amp;&amp; <span class='identifier'><a name='74_35'>lhs</a></span>.<span class='identifier'><a name='74_39'>col</a></span> == <span class='identifier'><a name='74_46'>rhs</a></span>.<span class='identifier'><a name='74_50'>col</a></span> &amp;&amp; <span class='identifier'><a name='74_57'>lhs</a></span>.<span class='identifier'><a name='74_61'>file</a></span> == <span class='identifier'><a name='74_69'>rhs</a></span>.<span class='identifier'><a name='74_73'>file</a></span>
0075    }
0076    
0077    <span class='keyword'><a name='77_0'>func</a></span> &lt;(<span class='identifier'><a name='77_7'>e1</a></span>: <span class='typeidentifier'><a name='77_11' href='Entity.html#15_6' title='usrString1'>Entity</a></span>, <span class='identifier'><a name='77_19'>e2</a></span>: <span class='typeidentifier'><a name='77_23' href='Entity.html#15_6' title='usrString1'>Entity</a></span>) -> <span class='typeidentifier'><a name='77_34'>Bool</a></span> {
0078        <span class='keyword'><a name='78_4'>let</a></span> <span class='identifier'><a name='78_8'>file1</a></span> = <span class='identifier'><a name='78_16'>NSURL</a></span>( <span class='identifier'><a name='78_23'>fileURLWithPath</a></span>: <span class='identifier'><a name='78_40'>e1</a></span>.<span class='identifier'><a name='78_43'>file</a></span> ).<span class='identifier'><a name='78_50'>lastPathComponent</a></span>!,
0079        <span class='identifier'><a name='79_4'>file2</a></span> = <span class='identifier'><a name='79_12'>NSURL</a></span>( <span class='identifier'><a name='79_19'>fileURLWithPath</a></span>: <span class='identifier'><a name='79_36'>e2</a></span>.<span class='identifier'><a name='79_39'>file</a></span> ).<span class='identifier'><a name='79_46'>lastPathComponent</a></span>!
0080        <span class='keyword'><a name='80_4'>if</a></span> <span class='identifier'><a name='80_7'>file1</a></span> &lt; <span class='identifier'><a name='80_15'>file2</a></span> { <span class='keyword'><a name='80_23'>return</a></span> <span class='keyword'><a name='80_30'>true</a></span> }
0081        <span class='keyword'><a name='81_4'>if</a></span> <span class='identifier'><a name='81_7'>file1</a></span> > <span class='identifier'><a name='81_15'>file2</a></span> { <span class='keyword'><a name='81_23'>return</a></span> <span class='keyword'><a name='81_30'>false</a></span> }
0082        <span class='keyword'><a name='82_4'>if</a></span> <span class='identifier'><a name='82_7'>e1</a></span>.<span class='identifier'><a name='82_10'>line</a></span> &lt; <span class='identifier'><a name='82_17'>e2</a></span>.<span class='identifier'><a name='82_20'>line</a></span> { <span class='keyword'><a name='82_27'>return</a></span> <span class='keyword'><a name='82_34'>true</a></span> }
0083        <span class='keyword'><a name='83_4'>if</a></span> <span class='identifier'><a name='83_7'>e1</a></span>.<span class='identifier'><a name='83_10'>line</a></span> > <span class='identifier'><a name='83_17'>e2</a></span>.<span class='identifier'><a name='83_20'>line</a></span> { <span class='keyword'><a name='83_27'>return</a></span> <span class='keyword'><a name='83_34'>false</a></span> }
0084        <span class='keyword'><a name='84_4'>return</a></span> <span class='identifier'><a name='84_11'>e1</a></span>.<span class='identifier'><a name='84_14'>col</a></span> &lt; <span class='identifier'><a name='84_20'>e2</a></span>.<span class='identifier'><a name='84_23'>col</a></span>
0085    }
0086    