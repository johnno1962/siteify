<html><head>
    <meta charset="UTF-8">
    <title>.build/checkouts/SwiftLSPClient/SwiftLSPClient/JSONRPC/ProtocolTransport.swift</title>
    <link rel="stylesheet" type="text/css" href="siteify.css">
<script>

var lastlink;

function expand(a) {
    if ( a.children[0].style.display != "block" ) {
        if ( lastlink )
            lastlink.style.display = "none";
        a.children[0].style.display = "block";
        lastlink = a.children[0];
    }
    else {
        a.children[0].style.display = "none";
        lastlink = null;
    }
    return false;
}

</script></head><body><h3>.build/checkouts/SwiftLSPClient/SwiftLSPClient/JSONRPC/ProtocolTransport.swift</h3><pre><span class=linenum>0001</span>    <span class='comment'>//
<span class=linenum>0002</span>    </span><span class='comment'>//  ProtocolTransport.swift
<span class=linenum>0003</span>    </span><span class='comment'>//  SwiftLSPClient
<span class=linenum>0004</span>    </span><span class='comment'>//
<span class=linenum>0005</span>    </span><span class='comment'>//  Created by Matt Massicotte on 2018-10-14.
<span class=linenum>0006</span>    </span><span class='comment'>//  Copyright Â© 2018 Chime Systems. All rights reserved.
<span class=linenum>0007</span>    </span><span class='comment'>//
<span class=linenum>0008</span>    </span>
<span class=linenum>0009</span>    <span class='keyword'>import</span> <span class='identifier'>Foundation</span>
<span class=linenum>0010</span>    
<span class=linenum>0011</span>    <span class='builtin'>public</span> <span class='keyword'>enum</span> <span class='identifier'><a name='11_12' href='#' title='usrString2' onclick='return expand(this);'>ProtocolTransportError<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#24_83"; return false;'>ProtocolTransport.swift:24</td><td><pre>    public typealias ResponseResult&lt;T: Codable> = Result&lt;JSONRPCResultResponse&lt;T>, ProtocolTransportError></pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#25_47"; return false;'>ProtocolTransport.swift:25</td><td><pre>    public typealias DataResult = Result&lt;Data, ProtocolTransportError></pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#102_83"; return false;'>ProtocolTransport.swift:102</td><td><pre>    public func sendNotification&lt;T>(_ params: T, method: String, block: @escaping (ProtocolTransportError?) -> Void) where T: Codable {</pre></td></table></span></a></span>: <span class='typeidentifier'>Error</span> {
<span class=linenum>0012</span>        <span class='keyword'>case</span> <span class='identifier'><a name='12_9' href='#' title='usrString2' onclick='return expand(this);'>encodingFailure<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#73_42"; return false;'>ProtocolTransport.swift:73</td><td><pre>                responseHandler(.failure(.encodingFailure(error)))</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#111_23"; return false;'>ProtocolTransport.swift:111</td><td><pre>                block(.encodingFailure(error))</pre></td></table></span></a></span>(<span class='typeidentifier'>Error</span>)
<span class=linenum>0013</span>        <span class='keyword'>case</span> <span class='identifier'><a name='13_9' href='#' title='usrString2' onclick='return expand(this);'>decodingFailure<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#96_46"; return false;'>ProtocolTransport.swift:96</td><td><pre>                    responseHandler(.failure(.decodingFailure(error)))</pre></td></table></span></a></span>(<span class='typeidentifier'>Error</span>)
<span class=linenum>0014</span>        <span class='keyword'>case</span> <span class='identifier'><a name='14_9' title='usrString2' onclick='return expand(this);'>transportSendFailure<span class='references'><table></table></span></a></span>(<span class='typeidentifier'>Error</span>)
<span class=linenum>0015</span>        <span class='keyword'>case</span> <span class='identifier'><a name='15_9' href='#' title='usrString2' onclick='return expand(this);'>responderRelayFailure<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#88_38"; return false;'>ProtocolTransport.swift:88</td><td><pre>            responseHandler(.failure(.responderRelayFailure(error)))</pre></td></table></span></a></span>(<span class='typeidentifier'>Error</span>)
<span class=linenum>0016</span>    }
<span class=linenum>0017</span>    
<span class=linenum>0018</span>    <span class='builtin'>public</span> <span class='keyword'>protocol</span> <span class='identifier'><a name='18_16' href='#' title='usrString2' onclick='return expand(this);'>ProtocolTransportDelegate<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#25_33"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:25</td><td><pre>extension JSONRPCLanguageServer: ProtocolTransportDelegate {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#33_30"; return false;'>ProtocolTransport.swift:33</td><td><pre>    public weak var delegate: ProtocolTransportDelegate?</pre></td></table></span></a></span>: <span class='typeidentifier'>class</span> {
<span class=linenum>0019</span>        <span class='keyword'>func</span> <span class='identifier'><a name='19_9' href='#' title='usrString2' onclick='return expand(this);'>transportReceived<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#134_27"; return false;'>ProtocolTransport.swift:134</td><td><pre>            self.delegate?.transportReceived(self, undecodableData: data)</pre></td></table></span></a></span>(<span class='keyword'>_</span> <span class='identifier'><a name='19_29' title='usrString2' onclick='return expand(this);'>transport<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='19_40' href='ProtocolTransport.swift.html#23_13' title='usrString1'>ProtocolTransport</a></span>, <span class='identifier'><a name='19_59' href='ProtocolTransport.swift.html#19_9' title='usrString1'>undecodableData</a></span> <span class='identifier'><a name='19_75' title='usrString2' onclick='return expand(this);'>data<span class='references'><table></table></span></a></span>: <span class='typeidentifier'>Data</span>)
<span class=linenum>0020</span>        <span class='keyword'>func</span> <span class='identifier'><a name='20_9' href='#' title='usrString2' onclick='return expand(this);'>transportReceived<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#158_23"; return false;'>ProtocolTransport.swift:158</td><td><pre>        self.delegate?.transportReceived(self, notificationMethod: method, data: data)</pre></td></table></span></a></span>(<span class='keyword'>_</span> <span class='identifier'><a name='20_29' title='usrString2' onclick='return expand(this);'>transport<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='20_40' href='ProtocolTransport.swift.html#23_13' title='usrString1'>ProtocolTransport</a></span>, <span class='identifier'><a name='20_59' title='usrString2' onclick='return expand(this);'>notificationMethod<span class='references'><table></table></span></a></span>: <span class='typeidentifier'>String</span>, <span class='identifier'><a name='20_87' title='usrString2' onclick='return expand(this);'>data<span class='references'><table></table></span></a></span>: <span class='typeidentifier'>Data</span>)
<span class=linenum>0021</span>    }
<span class=linenum>0022</span>    
<span class=linenum>0023</span>    <span class='builtin'>public</span> <span class='keyword'>class</span> <span class='identifier'><a name='23_13' href='#' title='usrString2' onclick='return expand(this);'>ProtocolTransport<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#13_35"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:13</td><td><pre>    private let protocolTransport: ProtocolTransport</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#19_33"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:19</td><td><pre>        self.protocolTransport = ProtocolTransport(dataTransport: dataTransport)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#26_47"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:26</td><td><pre>    public func transportReceived(_ transport: ProtocolTransport, undecodableData data: Data) {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#34_47"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:34</td><td><pre>    public func transportReceived(_ transport: ProtocolTransport, notificationMethod: String, data: Data) {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#108_45"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:108</td><td><pre>    typealias ProtocolResponse&lt;T: Codable> = ProtocolTransport.ResponseResult&lt;T></pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#19_40"; return false;'>ProtocolTransport.swift:19</td><td><pre>    func transportReceived(_ transport: ProtocolTransport, undecodableData data: Data)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#20_40"; return false;'>ProtocolTransport.swift:20</td><td><pre>    func transportReceived(_ transport: ProtocolTransport, notificationMethod: String, data: Data)</pre></td></table></span></a></span> {
<span class=linenum>0024</span>        <span class='builtin'>public</span> <span class='keyword'>typealias</span> <span class='identifier'><a name='24_21' href='#' title='usrString2' onclick='return expand(this);'>ResponseResult<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#108_63"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:108</td><td><pre>    typealias ProtocolResponse&lt;T: Codable> = ProtocolTransport.ResponseResult&lt;T></pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#62_92"; return false;'>ProtocolTransport.swift:62</td><td><pre>    public func sendRequest&lt;T, U>(_ request: T, method: String, responseHandler: @escaping (ResponseResult&lt;U>) -> Void) where T: Codable, U: Decodable {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#85_82"; return false;'>ProtocolTransport.swift:85</td><td><pre>    private func relayResponse&lt;T>(result: DataResult, responseHandler: @escaping (ResponseResult&lt;T>) -> Void) where T: Decodable {</pre></td></table></span></a></span>&lt;<span class='identifier'><a name='24_36' href='#' title='usrString2' onclick='return expand(this);'>T<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#24_79"; return false;'>ProtocolTransport.swift:24</td><td><pre>    public typealias ResponseResult&lt;T: Codable> = Result&lt;JSONRPCResultResponse&lt;T>, ProtocolTransportError></pre></td></table></span></a></span>: <span class='typeidentifier'>Codable</span>> = <span class='typeidentifier'>Result</span>&lt;<span class='typeidentifier'><a name='24_57' href='JSONRPC.swift.html#78_14' title='usrString1'>JSONRPCResultResponse</a></span>&lt;<span class='typeidentifier'><a name='24_79' href='ProtocolTransport.swift.html#24_36' title='usrString1'>T</a></span>>, <span class='typeidentifier'><a name='24_83' href='ProtocolTransport.swift.html#11_12' title='usrString1'>ProtocolTransportError</a></span>>
<span class=linenum>0025</span>        <span class='builtin'>public</span> <span class='keyword'>typealias</span> <span class='identifier'><a name='25_21' href='#' title='usrString2' onclick='return expand(this);'>DataResult<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#26_41"; return false;'>ProtocolTransport.swift:26</td><td><pre>    public typealias MessageResponder = (DataResult) -> Void</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#85_42"; return false;'>ProtocolTransport.swift:85</td><td><pre>    private func relayResponse&lt;T>(result: DataResult, responseHandler: @escaping (ResponseResult&lt;T>) -> Void) where T: Decodable {</pre></td></table></span></a></span> = <span class='typeidentifier'>Result</span>&lt;<span class='typeidentifier'>Data</span>, <span class='typeidentifier'><a name='25_47' href='ProtocolTransport.swift.html#11_12' title='usrString1'>ProtocolTransportError</a></span>>
<span class=linenum>0026</span>        <span class='builtin'>public</span> <span class='keyword'>typealias</span> <span class='identifier'><a name='26_21' href='#' title='usrString2' onclick='return expand(this);'>MessageResponder<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#30_37"; return false;'>ProtocolTransport.swift:30</td><td><pre>    private var responders: [JSONId: MessageResponder]</pre></td></table></span></a></span> = (<span class='typeidentifier'><a name='26_41' href='ProtocolTransport.swift.html#25_21' title='usrString1'>DataResult</a></span>) -> <span class='typeidentifier'>Void</span>
<span class=linenum>0027</span>        
<span class=linenum>0028</span>        <span class='builtin'>private</span> <span class='keyword'>var</span> <span class='identifier'><a name='28_16' href='#' title='usrString2' onclick='return expand(this);'>id<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#55_40"; return false;'>ProtocolTransport.swift:55</td><td><pre>        let issuedId = JSONId.numericId(id)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#57_8"; return false;'>ProtocolTransport.swift:57</td><td><pre>        id += 1</pre></td></table></span></a></span> = <span class='number'>1</span>
<span class=linenum>0029</span>        <span class='builtin'>private</span> <span class='keyword'>let</span> <span class='identifier'><a name='29_16' href='#' title='usrString2' onclick='return expand(this);'>messageTransport<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#37_13"; return false;'>ProtocolTransport.swift:37</td><td><pre>        self.messageTransport = messageTransport</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#43_13"; return false;'>ProtocolTransport.swift:43</td><td><pre>        self.messageTransport.dataHandler = { [unowned self] (data) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#77_17"; return false;'>ProtocolTransport.swift:77</td><td><pre>            self.messageTransport.write(jsonData)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#115_17"; return false;'>ProtocolTransport.swift:115</td><td><pre>            self.messageTransport.write(jsonData)</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='29_34' href='MessageTransport.swift.html#11_13' title='usrString1'>MessageTransport</a></span>
<span class=linenum>0030</span>        <span class='builtin'>private</span> <span class='keyword'>var</span> <span class='identifier'><a name='30_16' href='#' title='usrString2' onclick='return expand(this);'>responders<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#38_13"; return false;'>ProtocolTransport.swift:38</td><td><pre>        self.responders = [:]</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#79_17"; return false;'>ProtocolTransport.swift:79</td><td><pre>            self.responders[issuedId] = { [unowned self] (result) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#143_30"; return false;'>ProtocolTransport.swift:143</td><td><pre>        guard let responder = responders[message.id] else {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#152_8"; return false;'>ProtocolTransport.swift:152</td><td><pre>        responders.removeValue(forKey: message.id)</pre></td></table></span></a></span>: [<span class='typeidentifier'><a name='30_29' href='JSONRPC.swift.html#11_12' title='usrString1'>JSONId</a></span>: <span class='typeidentifier'><a name='30_37' href='ProtocolTransport.swift.html#26_21' title='usrString1'>MessageResponder</a></span>]
<span class=linenum>0031</span>        <span class='builtin'>private</span> <span class='keyword'>let</span> <span class='identifier'><a name='31_16' href='#' title='usrString2' onclick='return expand(this);'>encoder<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#39_13"; return false;'>ProtocolTransport.swift:39</td><td><pre>        self.encoder = JSONEncoder()</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#71_36"; return false;'>ProtocolTransport.swift:71</td><td><pre>                jsonData = try self.encoder.encode(rpcRequest)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#109_36"; return false;'>ProtocolTransport.swift:109</td><td><pre>                jsonData = try self.encoder.encode(notification)</pre></td></table></span></a></span>: <span class='typeidentifier'>JSONEncoder</span>
<span class=linenum>0032</span>        <span class='builtin'>private</span> <span class='keyword'>let</span> <span class='identifier'><a name='32_16' href='#' title='usrString2' onclick='return expand(this);'>decoder<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#40_13"; return false;'>ProtocolTransport.swift:40</td><td><pre>        self.decoder = JSONDecoder()</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#92_46"; return false;'>ProtocolTransport.swift:92</td><td><pre>                    let jsonResult = try self.decoder.decode(JSONRPCResultResponse&lt;T>.self, from: data)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#124_39"; return false;'>ProtocolTransport.swift:124</td><td><pre>            if let message = try? self.decoder.decode(JSONRPCResponse.self, from: data) {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#129_44"; return false;'>ProtocolTransport.swift:129</td><td><pre>            if let notification = try? self.decoder.decode(JSONRPCNotification.self, from: data) {</pre></td></table></span></a></span>: <span class='typeidentifier'>JSONDecoder</span>
<span class=linenum>0033</span>        <span class='builtin'>public</span> <span class='builtin'>weak</span> <span class='keyword'>var</span> <span class='identifier'><a name='33_20' href='#' title='usrString2' onclick='return expand(this);'>delegate<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#21_31"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:21</td><td><pre>        self.protocolTransport.delegate = self</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#134_17"; return false;'>ProtocolTransport.swift:134</td><td><pre>            self.delegate?.transportReceived(self, undecodableData: data)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#158_13"; return false;'>ProtocolTransport.swift:158</td><td><pre>        self.delegate?.transportReceived(self, notificationMethod: method, data: data)</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='33_30' href='ProtocolTransport.swift.html#18_16' title='usrString1'>ProtocolTransportDelegate</a></span>?
<span class=linenum>0034</span>        <span class='builtin'>private</span> <span class='keyword'>let</span> <span class='identifier'><a name='34_16' href='#' title='usrString2' onclick='return expand(this);'>queue<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#41_13"; return false;'>ProtocolTransport.swift:41</td><td><pre>        self.queue = DispatchQueue(label: "com.chimehq.SwiftLSPClient.ProtocolTransport")</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#63_8"; return false;'>ProtocolTransport.swift:63</td><td><pre>        queue.async {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#90_12"; return false;'>ProtocolTransport.swift:90</td><td><pre>            queue.async {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#105_8"; return false;'>ProtocolTransport.swift:105</td><td><pre>        queue.async {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#123_8"; return false;'>ProtocolTransport.swift:123</td><td><pre>        queue.async {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#140_53"; return false;'>ProtocolTransport.swift:140</td><td><pre>            dispatchPrecondition(condition: .onQueue(queue))</pre></td></table></span></a></span>: <span class='typeidentifier'>DispatchQueue</span>
<span class=linenum>0035</span>        
<span class=linenum>0036</span>        <span class='builtin'>public</span> <span class='keyword'>init</span>(<span class='identifier'><a name='36_16' href='#' title='usrString2' onclick='return expand(this);'>messageTransport<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#37_32"; return false;'>ProtocolTransport.swift:37</td><td><pre>        self.messageTransport = messageTransport</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='36_34' href='MessageTransport.swift.html#11_13' title='usrString1'>MessageTransport</a></span>) {
<span class=linenum>0037</span>            <span class='keyword'>self</span>.<span class='identifier'><a name='37_13' href='ProtocolTransport.swift.html#29_16' title='usrString1'>messageTransport</a></span> = <span class='identifier'><a name='37_32' href='ProtocolTransport.swift.html#36_16' title='usrString1'>messageTransport</a></span>
<span class=linenum>0038</span>            <span class='keyword'>self</span>.<span class='identifier'><a name='38_13' href='ProtocolTransport.swift.html#30_16' title='usrString1'>responders</a></span> = [:]
<span class=linenum>0039</span>            <span class='keyword'>self</span>.<span class='identifier'><a name='39_13' href='ProtocolTransport.swift.html#31_16' title='usrString1'>encoder</a></span> = <span class='identifier'>JSONEncoder</span>()
<span class=linenum>0040</span>            <span class='keyword'>self</span>.<span class='identifier'><a name='40_13' href='ProtocolTransport.swift.html#32_16' title='usrString1'>decoder</a></span> = <span class='identifier'>JSONDecoder</span>()
<span class=linenum>0041</span>            <span class='keyword'>self</span>.<span class='identifier'><a name='41_13' href='ProtocolTransport.swift.html#34_16' title='usrString1'>queue</a></span> = <span class='identifier'>DispatchQueue</span>(<span class='identifier'>label</span>: <span class='string'>"com.chimehq.SwiftLSPClient.ProtocolTransport"</span>)
<span class=linenum>0042</span>            
<span class=linenum>0043</span>            <span class='keyword'>self</span>.<span class='identifier'><a name='43_13' href='ProtocolTransport.swift.html#29_16' title='usrString1'>messageTransport</a></span>.<span class='identifier'><a name='43_30' href='MessageTransport.swift.html#13_8' title='usrString1'>dataHandler</a></span> = { [<span class='builtin'>unowned</span> <span class='keyword'>self</span>] (<span class='identifier'><a name='43_62' title='usrString3'>data</a></span>) <span class='keyword'>in</span>
<span class=linenum>0044</span>                <span class='keyword'>self</span>.<span class='identifier'><a name='44_17' href='ProtocolTransport.swift.html#121_17' title='usrString1'>dataAvailable</a></span>(<span class='identifier'><a name='44_31' href='ProtocolTransport.swift.html#43_62' title='usrString1'>data</a></span>)
<span class=linenum>0045</span>            }
<span class=linenum>0046</span>        }
<span class=linenum>0047</span>    
<span class=linenum>0048</span>        <span class='builtin'>public</span> <span class='builtin'>convenience</span> <span class='keyword'>init</span>(<span class='identifier'><a name='48_28' href='#' title='usrString2' onclick='return expand(this);'>dataTransport<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#49_63"; return false;'>ProtocolTransport.swift:49</td><td><pre>        let messageTransport = MessageTransport(dataTransport: dataTransport)</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='48_43' href='DataTransport.swift.html#11_16' title='usrString1'>DataTransport</a></span>) {
<span class=linenum>0049</span>            <span class='keyword'>let</span> <span class='identifier'><a name='49_12' title='usrString3'>messageTransport</a></span> = <span class='identifier'><a name='49_31' href='MessageTransport.swift.html#11_13' title='usrString1'>MessageTransport</a></span>(<span class='identifier'><a name='49_48' href='MessageTransport.swift.html#19_11' title='usrString1'>dataTransport</a></span>: <span class='identifier'><a name='49_63' href='ProtocolTransport.swift.html#48_28' title='usrString1'>dataTransport</a></span>)
<span class=linenum>0050</span>            
<span class=linenum>0051</span>            <span class='keyword'>self</span>.<span class='identifier'><a name='51_13' href='ProtocolTransport.swift.html#36_11' title='usrString1'>init</a></span>(<span class='identifier'>messageTransport</span>: <span class='identifier'><a name='51_36' href='ProtocolTransport.swift.html#49_12' title='usrString1'>messageTransport</a></span>)
<span class=linenum>0052</span>        }
<span class=linenum>0053</span>        
<span class=linenum>0054</span>        <span class='builtin'>private</span> <span class='keyword'>func</span> <span class='identifier'><a name='54_17' href='#' title='usrString2' onclick='return expand(this);'>generateID<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#64_32"; return false;'>ProtocolTransport.swift:64</td><td><pre>            let issuedId = self.generateID()</pre></td></table></span></a></span>() -> <span class='typeidentifier'><a name='54_33' href='JSONRPC.swift.html#11_12' title='usrString1'>JSONId</a></span> {
<span class=linenum>0055</span>            <span class='keyword'>let</span> <span class='identifier'><a name='55_12' title='usrString3'>issuedId</a></span> = <span class='identifier'><a name='55_23' href='JSONRPC.swift.html#11_12' title='usrString1'>JSONId</a></span>.<span class='identifier'><a name='55_30' href='JSONRPC.swift.html#12_9' title='usrString1'>numericId</a></span>(<span class='identifier'><a name='55_40' href='ProtocolTransport.swift.html#28_16' title='usrString1'>id</a></span>)
<span class=linenum>0056</span>            
<span class=linenum>0057</span>            <span class='identifier'><a name='57_8' href='ProtocolTransport.swift.html#28_16' title='usrString1'>id</a></span> += <span class='number'>1</span>
<span class=linenum>0058</span>            
<span class=linenum>0059</span>            <span class='keyword'>return</span> <span class='identifier'><a name='59_15' href='ProtocolTransport.swift.html#55_12' title='usrString1'>issuedId</a></span>
<span class=linenum>0060</span>        }
<span class=linenum>0061</span>        
<span class=linenum>0062</span>        <span class='builtin'>public</span> <span class='keyword'>func</span> <span class='identifier'><a name='62_16' href='#' title='usrString2' onclick='return expand(this);'>sendRequest<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#113_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:113</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;InitializationResponse>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#121_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:121</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;Hover>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#174_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:174</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;WillSaveWaitUntilResponse>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#191_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:191</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;CompletionResponse>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#199_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:199</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;SignatureHelp>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#207_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:207</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;DeclarationResponse?>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#216_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:216</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;DefinitionResponse?>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#224_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:224</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;TypeDefinitionResponse?>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#232_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:232</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;ImplementationResponse?>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#240_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:240</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;DocumentSymbolResponse>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#248_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:248</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;FormattingResult>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#256_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:256</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;FormattingResult>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#264_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:264</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;FormattingResult>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#272_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:272</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;ReferenceResponse?>) in</pre></td></table></span></a></span>&lt;<span class='identifier'><a name='62_28' title='usrString3'>T</a></span>, <span class='identifier'><a name='62_31' title='usrString3'>U</a></span>>(<span class='keyword'>_</span> <span class='identifier'><a name='62_36' title='usrString2' onclick='return expand(this);'>request<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='62_45' href='ProtocolTransport.swift.html#62_28' title='usrString1'>T</a></span>, <span class='identifier'><a name='62_48' href='#' title='usrString2' onclick='return expand(this);'>method<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#66_66"; return false;'>ProtocolTransport.swift:66</td><td><pre>            let rpcRequest = JSONRPCRequest(id: issuedId, method: method, params: request)</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>, <span class='identifier'><a name='62_64' href='#' title='usrString2' onclick='return expand(this);'>responseHandler<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#73_16"; return false;'>ProtocolTransport.swift:73</td><td><pre>                responseHandler(.failure(.encodingFailure(error)))</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#80_68"; return false;'>ProtocolTransport.swift:80</td><td><pre>                self.relayResponse(result: result, responseHandler: responseHandler)</pre></td></table></span></a></span>: <span class='builtin'>@escaping</span> (<span class='typeidentifier'><a name='62_92' href='ProtocolTransport.swift.html#24_21' title='usrString1'>ResponseResult</a></span>&lt;<span class='typeidentifier'><a name='62_107' href='ProtocolTransport.swift.html#62_31' title='usrString1'>U</a></span>>) -> <span class='typeidentifier'>Void</span>) <span class='keyword'>where</span> <span class='typeidentifier'><a name='62_126' href='ProtocolTransport.swift.html#62_28' title='usrString1'>T</a></span>: <span class='typeidentifier'>Codable</span>, <span class='typeidentifier'><a name='62_138' href='ProtocolTransport.swift.html#62_31' title='usrString1'>U</a></span>: <span class='typeidentifier'>Decodable</span> {
<span class=linenum>0063</span>            <span class='identifier'><a name='63_8' href='ProtocolTransport.swift.html#34_16' title='usrString1'>queue</a></span>.<span class='identifier'>async</span> {
<span class=linenum>0064</span>                <span class='keyword'>let</span> <span class='identifier'><a name='64_16' title='usrString3'>issuedId</a></span> = <span class='keyword'>self</span>.<span class='identifier'><a name='64_32' href='ProtocolTransport.swift.html#54_17' title='usrString1'>generateID</a></span>()
<span class=linenum>0065</span>    
<span class=linenum>0066</span>                <span class='keyword'>let</span> <span class='identifier'><a name='66_16' title='usrString3'>rpcRequest</a></span> = <span class='identifier'><a name='66_29' href='JSONRPC.swift.html#55_14' title='usrString1'>JSONRPCRequest</a></span>(<span class='identifier'><a name='66_44' href='JSONRPC.swift.html#55_14' title='usrString1'>id</a></span>: <span class='identifier'><a name='66_48' href='ProtocolTransport.swift.html#64_16' title='usrString1'>issuedId</a></span>, <span class='identifier'><a name='66_58' href='JSONRPC.swift.html#55_14' title='usrString1'>method</a></span>: <span class='identifier'><a name='66_66' href='ProtocolTransport.swift.html#62_48' title='usrString1'>method</a></span>, <span class='identifier'><a name='66_74' href='JSONRPC.swift.html#55_14' title='usrString1'>params</a></span>: <span class='identifier'><a name='66_82' href='ProtocolTransport.swift.html#62_36' title='usrString1'>request</a></span>)
<span class=linenum>0067</span>    
<span class=linenum>0068</span>                <span class='keyword'>let</span> <span class='identifier'><a name='68_16' title='usrString3'>jsonData</a></span>: <span class='typeidentifier'>Data</span>
<span class=linenum>0069</span>    
<span class=linenum>0070</span>                <span class='keyword'>do</span> {
<span class=linenum>0071</span>                    <span class='identifier'><a name='71_16' href='ProtocolTransport.swift.html#68_16' title='usrString1'>jsonData</a></span> = <span class='keyword'>try</span> <span class='keyword'>self</span>.<span class='identifier'><a name='71_36' href='ProtocolTransport.swift.html#31_16' title='usrString1'>encoder</a></span>.<span class='identifier'>encode</span>(<span class='identifier'><a name='71_51' href='ProtocolTransport.swift.html#66_16' title='usrString1'>rpcRequest</a></span>)
<span class=linenum>0072</span>                } <span class='keyword'>catch</span> {
<span class=linenum>0073</span>                    <span class='identifier'><a name='73_16' href='ProtocolTransport.swift.html#62_64' title='usrString1'>responseHandler</a></span>(.<span class='identifier'>failure</span>(.<span class='identifier'><a name='73_42' href='ProtocolTransport.swift.html#12_9' title='usrString1'>encodingFailure</a></span>(<span class='identifier'><a name='73_58' href='ProtocolTransport.swift.html#72_20' title='usrString1'>error</a></span>)))
<span class=linenum>0074</span>                    <span class='keyword'>return</span>
<span class=linenum>0075</span>                }
<span class=linenum>0076</span>    
<span class=linenum>0077</span>                <span class='keyword'>self</span>.<span class='identifier'><a name='77_17' href='ProtocolTransport.swift.html#29_16' title='usrString1'>messageTransport</a></span>.<span class='identifier'><a name='77_34' href='MessageTransport.swift.html#156_16' title='usrString1'>write</a></span>(<span class='identifier'><a name='77_40' href='ProtocolTransport.swift.html#68_16' title='usrString1'>jsonData</a></span>)
<span class=linenum>0078</span>    
<span class=linenum>0079</span>                <span class='keyword'>self</span>.<span class='identifier'><a name='79_17' href='ProtocolTransport.swift.html#30_16' title='usrString1'>responders</a></span>[<span class='identifier'><a name='79_28' href='ProtocolTransport.swift.html#64_16' title='usrString1'>issuedId</a></span>] = { [<span class='builtin'>unowned</span> <span class='keyword'>self</span>] (<span class='identifier'><a name='79_58' title='usrString3'>result</a></span>) <span class='keyword'>in</span>
<span class=linenum>0080</span>                    <span class='keyword'>self</span>.<span class='identifier'><a name='80_21' href='ProtocolTransport.swift.html#85_17' title='usrString1'>relayResponse</a></span>(<span class='identifier'><a name='80_35' href='ProtocolTransport.swift.html#85_17' title='usrString1'>result</a></span>: <span class='identifier'><a name='80_43' href='ProtocolTransport.swift.html#79_58' title='usrString1'>result</a></span>, <span class='identifier'><a name='80_51' href='ProtocolTransport.swift.html#85_17' title='usrString1'>responseHandler</a></span>: <span class='identifier'><a name='80_68' href='ProtocolTransport.swift.html#62_64' title='usrString1'>responseHandler</a></span>)
<span class=linenum>0081</span>                }
<span class=linenum>0082</span>            }
<span class=linenum>0083</span>        }
<span class=linenum>0084</span>    
<span class=linenum>0085</span>        <span class='builtin'>private</span> <span class='keyword'>func</span> <span class='identifier'><a name='85_17' href='#' title='usrString2' onclick='return expand(this);'>relayResponse<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#80_21"; return false;'>ProtocolTransport.swift:80</td><td><pre>                self.relayResponse(result: result, responseHandler: responseHandler)</pre></td></table></span></a></span>&lt;<span class='identifier'><a name='85_31' title='usrString3'>T</a></span>>(<span class='identifier'><a name='85_34' href='#' title='usrString2' onclick='return expand(this);'>result<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#86_15"; return false;'>ProtocolTransport.swift:86</td><td><pre>        switch result {</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='85_42' href='ProtocolTransport.swift.html#25_21' title='usrString1'>DataResult</a></span>, <span class='identifier'><a name='85_54' href='#' title='usrString2' onclick='return expand(this);'>responseHandler<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#88_12"; return false;'>ProtocolTransport.swift:88</td><td><pre>            responseHandler(.failure(.responderRelayFailure(error)))</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#94_20"; return false;'>ProtocolTransport.swift:94</td><td><pre>                    responseHandler(.success(jsonResult))</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#96_20"; return false;'>ProtocolTransport.swift:96</td><td><pre>                    responseHandler(.failure(.decodingFailure(error)))</pre></td></table></span></a></span>: <span class='builtin'>@escaping</span> (<span class='typeidentifier'><a name='85_82' href='ProtocolTransport.swift.html#24_21' title='usrString1'>ResponseResult</a></span>&lt;<span class='typeidentifier'><a name='85_97' href='ProtocolTransport.swift.html#85_31' title='usrString1'>T</a></span>>) -> <span class='typeidentifier'>Void</span>) <span class='keyword'>where</span> <span class='typeidentifier'><a name='85_116' href='ProtocolTransport.swift.html#85_31' title='usrString1'>T</a></span>: <span class='typeidentifier'>Decodable</span> {
<span class=linenum>0086</span>            <span class='keyword'>switch</span> <span class='identifier'><a name='86_15' href='ProtocolTransport.swift.html#85_34' title='usrString1'>result</a></span> {
<span class=linenum>0087</span>            <span class='keyword'>case</span> .<span class='identifier'>failure</span>(<span class='keyword'>let</span> <span class='identifier'><a name='87_26' title='usrString3'>error</a></span>):
<span class=linenum>0088</span>                <span class='identifier'><a name='88_12' href='ProtocolTransport.swift.html#85_54' title='usrString1'>responseHandler</a></span>(.<span class='identifier'>failure</span>(.<span class='identifier'><a name='88_38' href='ProtocolTransport.swift.html#15_9' title='usrString1'>responderRelayFailure</a></span>(<span class='identifier'><a name='88_60' href='ProtocolTransport.swift.html#87_26' title='usrString1'>error</a></span>)))
<span class=linenum>0089</span>            <span class='keyword'>case</span> .<span class='identifier'>success</span>(<span class='keyword'>let</span> <span class='identifier'><a name='89_26' title='usrString3'>data</a></span>):
<span class=linenum>0090</span>                <span class='identifier'><a name='90_12' href='ProtocolTransport.swift.html#34_16' title='usrString1'>queue</a></span>.<span class='identifier'>async</span> {
<span class=linenum>0091</span>                    <span class='keyword'>do</span> {
<span class=linenum>0092</span>                        <span class='keyword'>let</span> <span class='identifier'><a name='92_24' title='usrString3'>jsonResult</a></span> = <span class='keyword'>try</span> <span class='keyword'>self</span>.<span class='identifier'><a name='92_46' href='ProtocolTransport.swift.html#32_16' title='usrString1'>decoder</a></span>.<span class='identifier'>decode</span>(<span class='identifier'><a name='92_61' href='JSONRPC.swift.html#78_14' title='usrString1'>JSONRPCResultResponse</a></span>&lt;<span class='typeidentifier'><a name='92_83' href='ProtocolTransport.swift.html#85_31' title='usrString1'>T</a></span>>.<span class='keyword'>self</span>, <span class='identifier'>from</span>: <span class='identifier'><a name='92_98' href='ProtocolTransport.swift.html#89_26' title='usrString1'>data</a></span>)
<span class=linenum>0093</span>    
<span class=linenum>0094</span>                        <span class='identifier'><a name='94_20' href='ProtocolTransport.swift.html#85_54' title='usrString1'>responseHandler</a></span>(.<span class='identifier'>success</span>(<span class='identifier'><a name='94_45' href='ProtocolTransport.swift.html#92_24' title='usrString1'>jsonResult</a></span>))
<span class=linenum>0095</span>                    } <span class='keyword'>catch</span> {
<span class=linenum>0096</span>                        <span class='identifier'><a name='96_20' href='ProtocolTransport.swift.html#85_54' title='usrString1'>responseHandler</a></span>(.<span class='identifier'>failure</span>(.<span class='identifier'><a name='96_46' href='ProtocolTransport.swift.html#13_9' title='usrString1'>decodingFailure</a></span>(<span class='identifier'><a name='96_62' href='ProtocolTransport.swift.html#95_24' title='usrString1'>error</a></span>)))
<span class=linenum>0097</span>                    }
<span class=linenum>0098</span>                }
<span class=linenum>0099</span>            }
<span class=linenum>0100</span>        }
<span class=linenum>0101</span>        
<span class=linenum>0102</span>        <span class='builtin'>public</span> <span class='keyword'>func</span> <span class='identifier'><a name='102_16' href='#' title='usrString2' onclick='return expand(this);'>sendNotification<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#129_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:129</td><td><pre>        protocolTransport.sendNotification(params, method: method) { (error) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#138_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:138</td><td><pre>        protocolTransport.sendNotification(params, method: method) { (error) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#147_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:147</td><td><pre>        protocolTransport.sendNotification(params, method: method) { (error) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#156_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:156</td><td><pre>        protocolTransport.sendNotification(params, method: method) { (error) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#165_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:165</td><td><pre>        protocolTransport.sendNotification(params, method: method)  { (error) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.swift.html#182_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:182</td><td><pre>        protocolTransport.sendNotification(params, method: method) { (error) in</pre></td></table></span></a></span>&lt;<span class='identifier'><a name='102_33' title='usrString3'>T</a></span>>(<span class='keyword'>_</span> <span class='identifier'><a name='102_38' title='usrString2' onclick='return expand(this);'>params<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='102_46' href='ProtocolTransport.swift.html#102_33' title='usrString1'>T</a></span>, <span class='identifier'><a name='102_49' href='#' title='usrString2' onclick='return expand(this);'>method<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#103_61"; return false;'>ProtocolTransport.swift:103</td><td><pre>        let notification = JSONRPCNotificationParams(method: method, params: params)</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>, <span class='identifier'><a name='102_65' href='#' title='usrString2' onclick='return expand(this);'>block<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#111_16"; return false;'>ProtocolTransport.swift:111</td><td><pre>                block(.encodingFailure(error))</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#117_12"; return false;'>ProtocolTransport.swift:117</td><td><pre>            block(nil)</pre></td></table></span></a></span>: <span class='builtin'>@escaping</span> (<span class='typeidentifier'><a name='102_83' href='ProtocolTransport.swift.html#11_12' title='usrString1'>ProtocolTransportError</a></span>?) -> <span class='typeidentifier'>Void</span>) <span class='keyword'>where</span> <span class='typeidentifier'><a name='102_123' href='ProtocolTransport.swift.html#102_33' title='usrString1'>T</a></span>: <span class='typeidentifier'>Codable</span> {
<span class=linenum>0103</span>            <span class='keyword'>let</span> <span class='identifier'><a name='103_12' title='usrString3'>notification</a></span> = <span class='identifier'><a name='103_27' href='JSONRPC.swift.html#111_14' title='usrString1'>JSONRPCNotificationParams</a></span>(<span class='identifier'><a name='103_53' href='JSONRPC.swift.html#111_14' title='usrString1'>method</a></span>: <span class='identifier'><a name='103_61' href='ProtocolTransport.swift.html#102_49' title='usrString1'>method</a></span>, <span class='identifier'><a name='103_69' href='JSONRPC.swift.html#111_14' title='usrString1'>params</a></span>: <span class='identifier'><a name='103_77' href='ProtocolTransport.swift.html#102_38' title='usrString1'>params</a></span>)
<span class=linenum>0104</span>    
<span class=linenum>0105</span>            <span class='identifier'><a name='105_8' href='ProtocolTransport.swift.html#34_16' title='usrString1'>queue</a></span>.<span class='identifier'>async</span> {
<span class=linenum>0106</span>                <span class='keyword'>let</span> <span class='identifier'><a name='106_16' title='usrString3'>jsonData</a></span>: <span class='typeidentifier'>Data</span>
<span class=linenum>0107</span>    
<span class=linenum>0108</span>                <span class='keyword'>do</span> {
<span class=linenum>0109</span>                    <span class='identifier'><a name='109_16' href='ProtocolTransport.swift.html#106_16' title='usrString1'>jsonData</a></span> = <span class='keyword'>try</span> <span class='keyword'>self</span>.<span class='identifier'><a name='109_36' href='ProtocolTransport.swift.html#31_16' title='usrString1'>encoder</a></span>.<span class='identifier'>encode</span>(<span class='identifier'><a name='109_51' href='ProtocolTransport.swift.html#103_12' title='usrString1'>notification</a></span>)
<span class=linenum>0110</span>                } <span class='keyword'>catch</span> {
<span class=linenum>0111</span>                    <span class='identifier'><a name='111_16' href='ProtocolTransport.swift.html#102_65' title='usrString1'>block</a></span>(.<span class='identifier'><a name='111_23' href='ProtocolTransport.swift.html#12_9' title='usrString1'>encodingFailure</a></span>(<span class='identifier'><a name='111_39' href='ProtocolTransport.swift.html#110_20' title='usrString1'>error</a></span>))
<span class=linenum>0112</span>                    <span class='keyword'>return</span>
<span class=linenum>0113</span>                }
<span class=linenum>0114</span>    
<span class=linenum>0115</span>                <span class='keyword'>self</span>.<span class='identifier'><a name='115_17' href='ProtocolTransport.swift.html#29_16' title='usrString1'>messageTransport</a></span>.<span class='identifier'><a name='115_34' href='MessageTransport.swift.html#156_16' title='usrString1'>write</a></span>(<span class='identifier'><a name='115_40' href='ProtocolTransport.swift.html#106_16' title='usrString1'>jsonData</a></span>)
<span class=linenum>0116</span>    
<span class=linenum>0117</span>                <span class='identifier'><a name='117_12' href='ProtocolTransport.swift.html#102_65' title='usrString1'>block</a></span>(<span class='keyword'>nil</span>)
<span class=linenum>0118</span>            }
<span class=linenum>0119</span>        }
<span class=linenum>0120</span>        
<span class=linenum>0121</span>        <span class='builtin'>private</span> <span class='keyword'>func</span> <span class='identifier'><a name='121_17' href='#' title='usrString2' onclick='return expand(this);'>dataAvailable<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#44_17"; return false;'>ProtocolTransport.swift:44</td><td><pre>            self.dataAvailable(data)</pre></td></table></span></a></span>(<span class='keyword'>_</span> <span class='identifier'><a name='121_33' title='usrString2' onclick='return expand(this);'>data<span class='references'><table></table></span></a></span>: <span class='typeidentifier'>Data</span>) {
<span class=linenum>0122</span>    <span class='comment'>//        print(String(data: data, encoding: .utf8))
<span class=linenum>0123</span>    </span>        <span class='identifier'><a name='123_8' href='ProtocolTransport.swift.html#34_16' title='usrString1'>queue</a></span>.<span class='identifier'>async</span> {
<span class=linenum>0124</span>                <span class='keyword'>if</span> <span class='keyword'>let</span> <span class='identifier'><a name='124_19' title='usrString3'>message</a></span> = <span class='keyword'>try</span>? <span class='keyword'>self</span>.<span class='identifier'><a name='124_39' href='ProtocolTransport.swift.html#32_16' title='usrString1'>decoder</a></span>.<span class='identifier'>decode</span>(<span class='identifier'><a name='124_54' href='JSONRPC.swift.html#72_14' title='usrString1'>JSONRPCResponse</a></span>.<span class='keyword'>self</span>, <span class='identifier'>from</span>: <span class='identifier'><a name='124_82' href='ProtocolTransport.swift.html#121_33' title='usrString1'>data</a></span>) {
<span class=linenum>0125</span>                    <span class='keyword'>self</span>.<span class='identifier'><a name='125_21' href='ProtocolTransport.swift.html#138_17' title='usrString1'>dispatchMessage</a></span>(<span class='identifier'><a name='125_37' href='ProtocolTransport.swift.html#124_19' title='usrString1'>message</a></span>, <span class='identifier'><a name='125_46' href='ProtocolTransport.swift.html#138_17' title='usrString1'>originalData</a></span>: <span class='identifier'><a name='125_60' href='ProtocolTransport.swift.html#121_33' title='usrString1'>data</a></span>)
<span class=linenum>0126</span>                    <span class='keyword'>return</span>
<span class=linenum>0127</span>                }
<span class=linenum>0128</span>    
<span class=linenum>0129</span>                <span class='keyword'>if</span> <span class='keyword'>let</span> <span class='identifier'><a name='129_19' title='usrString3'>notification</a></span> = <span class='keyword'>try</span>? <span class='keyword'>self</span>.<span class='identifier'><a name='129_44' href='ProtocolTransport.swift.html#32_16' title='usrString1'>decoder</a></span>.<span class='identifier'>decode</span>(<span class='identifier'><a name='129_59' href='JSONRPC.swift.html#106_14' title='usrString1'>JSONRPCNotification</a></span>.<span class='keyword'>self</span>, <span class='identifier'>from</span>: <span class='identifier'><a name='129_91' href='ProtocolTransport.swift.html#121_33' title='usrString1'>data</a></span>) {
<span class=linenum>0130</span>                    <span class='keyword'>self</span>.<span class='identifier'><a name='130_21' href='ProtocolTransport.swift.html#155_17' title='usrString1'>dispatchNotification</a></span>(<span class='identifier'><a name='130_42' href='ProtocolTransport.swift.html#129_19' title='usrString1'>notification</a></span>, <span class='identifier'><a name='130_56' href='ProtocolTransport.swift.html#155_17' title='usrString1'>originalData</a></span>: <span class='identifier'><a name='130_70' href='ProtocolTransport.swift.html#121_33' title='usrString1'>data</a></span>)
<span class=linenum>0131</span>                    <span class='keyword'>return</span>
<span class=linenum>0132</span>                }
<span class=linenum>0133</span>    
<span class=linenum>0134</span>                <span class='keyword'>self</span>.<span class='identifier'><a name='134_17' href='ProtocolTransport.swift.html#33_20' title='usrString1'>delegate</a></span>?.<span class='identifier'><a name='134_27' href='ProtocolTransport.swift.html#19_9' title='usrString1'>transportReceived</a></span>(<span class='keyword'>self</span>, <span class='identifier'><a name='134_51' href='ProtocolTransport.swift.html#19_9' title='usrString1'>undecodableData</a></span>: <span class='identifier'><a name='134_68' href='ProtocolTransport.swift.html#121_33' title='usrString1'>data</a></span>)
<span class=linenum>0135</span>            }
<span class=linenum>0136</span>        }
<span class=linenum>0137</span>        
<span class=linenum>0138</span>        <span class='builtin'>private</span> <span class='keyword'>func</span> <span class='identifier'><a name='138_17' href='#' title='usrString2' onclick='return expand(this);'>dispatchMessage<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#125_21"; return false;'>ProtocolTransport.swift:125</td><td><pre>                self.dispatchMessage(message, originalData: data)</pre></td></table></span></a></span>(<span class='keyword'>_</span> <span class='identifier'><a name='138_35' title='usrString2' onclick='return expand(this);'>message<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='138_44' href='JSONRPC.swift.html#72_14' title='usrString1'>JSONRPCResponse</a></span>, <span class='identifier'><a name='138_61' href='ProtocolTransport.swift.html#138_17' title='usrString1'>originalData</a></span> <span class='identifier'><a name='138_74' title='usrString2' onclick='return expand(this);'>data<span class='references'><table></table></span></a></span>: <span class='typeidentifier'>Data</span>) {
<span class=linenum>0139</span>            <span class='keyword'>if</span> <span class='keyword'>#available</span>(<span class='keyword'>OSX</span> <span class='number'>10.12</span>, *) {
<span class=linenum>0140</span>                <span class='identifier'>dispatchPrecondition</span>(<span class='identifier'>condition</span>: .<span class='identifier'>onQueue</span>(<span class='identifier'><a name='140_53' href='ProtocolTransport.swift.html#34_16' title='usrString1'>queue</a></span>))
<span class=linenum>0141</span>            }
<span class=linenum>0142</span>    
<span class=linenum>0143</span>            <span class='keyword'>guard</span> <span class='keyword'>let</span> <span class='identifier'><a name='143_18' title='usrString3'>responder</a></span> = <span class='identifier'><a name='143_30' href='ProtocolTransport.swift.html#30_16' title='usrString1'>responders</a></span>[<span class='identifier'><a name='143_41' href='ProtocolTransport.swift.html#138_35' title='usrString1'>message</a></span>.<span class='identifier'><a name='143_49' href='JSONRPC.swift.html#74_15' title='usrString1'>id</a></span>] <span class='keyword'>else</span> {
<span class=linenum>0144</span>                <span class='comment'>// hrm, got a message without a matching responder
<span class=linenum>0145</span>    </span>            <span class='identifier'>print</span>(<span class='string'>"not matching responder for </span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='145_48' href='ProtocolTransport.swift.html#138_35' title='usrString1'>message</a></span>.<span class='identifier'><a name='145_56' href='JSONRPC.swift.html#74_15' title='usrString1'>id</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>, dropping message"</span>)
<span class=linenum>0146</span>                <span class='keyword'>return</span>
<span class=linenum>0147</span>            }
<span class=linenum>0148</span>    
<span class=linenum>0149</span>            <span class='identifier'><a name='149_8' href='ProtocolTransport.swift.html#143_18' title='usrString1'>responder</a></span>(.<span class='identifier'>success</span>(<span class='identifier'><a name='149_27' href='ProtocolTransport.swift.html#138_74' title='usrString1'>data</a></span>))
<span class=linenum>0150</span>    
<span class=linenum>0151</span>            <span class='comment'>// TODO: This doesn't seem to be threadsafe
<span class=linenum>0152</span>    </span>        <span class='identifier'><a name='152_8' href='ProtocolTransport.swift.html#30_16' title='usrString1'>responders</a></span>.<span class='identifier'>removeValue</span>(<span class='identifier'>forKey</span>: <span class='identifier'><a name='152_39' href='ProtocolTransport.swift.html#138_35' title='usrString1'>message</a></span>.<span class='identifier'><a name='152_47' href='JSONRPC.swift.html#74_15' title='usrString1'>id</a></span>)
<span class=linenum>0153</span>        }
<span class=linenum>0154</span>        
<span class=linenum>0155</span>        <span class='builtin'>private</span> <span class='keyword'>func</span> <span class='identifier'><a name='155_17' href='#' title='usrString2' onclick='return expand(this);'>dispatchNotification<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.swift.html#130_21"; return false;'>ProtocolTransport.swift:130</td><td><pre>                self.dispatchNotification(notification, originalData: data)</pre></td></table></span></a></span>(<span class='keyword'>_</span> <span class='identifier'><a name='155_40' title='usrString2' onclick='return expand(this);'>notification<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='155_54' href='JSONRPC.swift.html#106_14' title='usrString1'>JSONRPCNotification</a></span>, <span class='identifier'><a name='155_75' href='ProtocolTransport.swift.html#155_17' title='usrString1'>originalData</a></span> <span class='identifier'><a name='155_88' title='usrString2' onclick='return expand(this);'>data<span class='references'><table></table></span></a></span>: <span class='typeidentifier'>Data</span>) {
<span class=linenum>0156</span>            <span class='keyword'>let</span> <span class='identifier'><a name='156_12' title='usrString3'>method</a></span> = <span class='identifier'><a name='156_21' href='ProtocolTransport.swift.html#155_40' title='usrString1'>notification</a></span>.<span class='identifier'><a name='156_34' href='JSONRPC.swift.html#108_15' title='usrString1'>method</a></span>
<span class=linenum>0157</span>    
<span class=linenum>0158</span>            <span class='keyword'>self</span>.<span class='identifier'><a name='158_13' href='ProtocolTransport.swift.html#33_20' title='usrString1'>delegate</a></span>?.<span class='identifier'><a name='158_23' href='ProtocolTransport.swift.html#20_9' title='usrString1'>transportReceived</a></span>(<span class='keyword'>self</span>, <span class='identifier'><a name='158_47' href='ProtocolTransport.swift.html#20_9' title='usrString1'>notificationMethod</a></span>: <span class='identifier'><a name='158_67' href='ProtocolTransport.swift.html#156_12' title='usrString1'>method</a></span>, <span class='identifier'><a name='158_75' href='ProtocolTransport.swift.html#20_9' title='usrString1'>data</a></span>: <span class='identifier'><a name='158_81' href='ProtocolTransport.swift.html#155_88' title='usrString1'>data</a></span>)
<span class=linenum>0159</span>        }
<span class=linenum>0160</span>    }
<span class=linenum>0161</span>    
<span class=linenum>0162</span>    