<html><head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="siteify.css">
<script>

var lastlink;

function expand(a) {
    if ( a.children[0].style.display != "block" ) {
        if ( lastlink )
            lastlink.style.display = "none";
        a.children[0].style.display = "block";
        lastlink = a.children[0];
    }
    else {
        a.children[0].style.display = "none";
        lastlink = null;
    }
    return false;
}

</script></head><body><pre>0001    <span class='comment'><a name='1_0'>//
0002    </a></span><span class='comment'><a name='2_0'>//  ProtocolTransport.swift
0003    </a></span><span class='comment'><a name='3_0'>//  SwiftLSPClient
0004    </a></span><span class='comment'><a name='4_0'>//
0005    </a></span><span class='comment'><a name='5_0'>//  Created by Matt Massicotte on 2018-10-14.
0006    </a></span><span class='comment'><a name='6_0'>//  Copyright Â© 2018 Chime Systems. All rights reserved.
0007    </a></span><span class='comment'><a name='7_0'>//
0008    </a></span>
0009    <span class='keyword'><a name='9_0'>import</a></span> <span class='identifier'><a name='9_7'>Foundation</a></span>
0010    
0011    <span class='builtin'><a name='11_0'>public</a></span> <span class='keyword'><a name='11_7'>enum</a></span> <span class='identifier'><a name='11_12' href='#' title='usrString2' onclick='return expand(this);'>ProtocolTransportError<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#24_83"; return false;'>ProtocolTransport.swift:24</td><td><pre>    public typealias ResponseResult&lt;T: Codable> = Result&lt;JSONRPCResultResponse&lt;T>, ProtocolTransportError></pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#25_47"; return false;'>ProtocolTransport.swift:25</td><td><pre>    public typealias DataResult = Result&lt;Data, ProtocolTransportError></pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#102_83"; return false;'>ProtocolTransport.swift:102</td><td><pre>    public func sendNotification&lt;T>(_ params: T, method: String, block: @escaping (ProtocolTransportError?) -> Void) where T: Codable {</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='11_36'>Error</a></span> {
0012        <span class='keyword'><a name='12_4'>case</a></span> <span class='identifier'><a name='12_9' href='#' title='usrString2' onclick='return expand(this);'>encodingFailure<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#73_42"; return false;'>ProtocolTransport.swift:73</td><td><pre>                responseHandler(.failure(.encodingFailure(error)))</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#111_23"; return false;'>ProtocolTransport.swift:111</td><td><pre>                block(.encodingFailure(error))</pre></td></table></span></a></span>(<span class='typeidentifier'><a name='12_25'>Error</a></span>)
0013        <span class='keyword'><a name='13_4'>case</a></span> <span class='identifier'><a name='13_9' href='#' title='usrString2' onclick='return expand(this);'>decodingFailure<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#96_46"; return false;'>ProtocolTransport.swift:96</td><td><pre>                    responseHandler(.failure(.decodingFailure(error)))</pre></td></table></span></a></span>(<span class='typeidentifier'><a name='13_25'>Error</a></span>)
0014        <span class='keyword'><a name='14_4'>case</a></span> <span class='identifier'><a name='14_9' title='usrString2' onclick='return expand(this);'>transportSendFailure<span class='references'><table></table></span></a></span>(<span class='typeidentifier'><a name='14_30'>Error</a></span>)
0015        <span class='keyword'><a name='15_4'>case</a></span> <span class='identifier'><a name='15_9' href='#' title='usrString2' onclick='return expand(this);'>responderRelayFailure<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#88_38"; return false;'>ProtocolTransport.swift:88</td><td><pre>            responseHandler(.failure(.responderRelayFailure(error)))</pre></td></table></span></a></span>(<span class='typeidentifier'><a name='15_31'>Error</a></span>)
0016    }
0017    
0018    <span class='builtin'><a name='18_0'>public</a></span> <span class='keyword'><a name='18_7'>protocol</a></span> <span class='identifier'><a name='18_16' href='#' title='usrString2' onclick='return expand(this);'>ProtocolTransportDelegate<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#33_30"; return false;'>ProtocolTransport.swift:33</td><td><pre>    public weak var delegate: ProtocolTransportDelegate?</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#25_33"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:25</td><td><pre>extension JSONRPCLanguageServer: ProtocolTransportDelegate {</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='18_43'>class</a></span> {
0019        <span class='keyword'><a name='19_4'>func</a></span> <span class='identifier'><a name='19_9' href='#' title='usrString2' onclick='return expand(this);'>transportReceived<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#133_27"; return false;'>ProtocolTransport.swift:133</td><td><pre>            self.delegate?.transportReceived(self, undecodableData: data)</pre></td></table></span></a></span>(<span class='keyword'><a name='19_27'>_</a></span> <span class='identifier'><a name='19_29' title='usrString2' onclick='return expand(this);'>transport<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='19_40'>ProtocolTransport</a></span>, <span class='identifier'><a name='19_59' href='ProtocolTransport.html#19_9' title='usrString1'>undecodableData</a></span> <span class='identifier'><a name='19_75' title='usrString2' onclick='return expand(this);'>data<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='19_81'>Data</a></span>)
0020        <span class='keyword'><a name='20_4'>func</a></span> <span class='identifier'><a name='20_9' href='#' title='usrString2' onclick='return expand(this);'>transportReceived<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#157_23"; return false;'>ProtocolTransport.swift:157</td><td><pre>        self.delegate?.transportReceived(self, notificationMethod: method, data: data)</pre></td></table></span></a></span>(<span class='keyword'><a name='20_27'>_</a></span> <span class='identifier'><a name='20_29' title='usrString2' onclick='return expand(this);'>transport<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='20_40'>ProtocolTransport</a></span>, <span class='identifier'><a name='20_59' title='usrString2' onclick='return expand(this);'>notificationMethod<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='20_79'>String</a></span>, <span class='identifier'><a name='20_87' title='usrString2' onclick='return expand(this);'>data<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='20_93'>Data</a></span>)
0021    }
0022    
0023    <span class='builtin'><a name='23_0'>public</a></span> <span class='keyword'><a name='23_7'>class</a></span> <span class='identifier'><a name='23_13' href='#' title='usrString2' onclick='return expand(this);'>ProtocolTransport<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#19_40"; return false;'>ProtocolTransport.swift:19</td><td><pre>    func transportReceived(_ transport: ProtocolTransport, undecodableData data: Data)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#20_40"; return false;'>ProtocolTransport.swift:20</td><td><pre>    func transportReceived(_ transport: ProtocolTransport, notificationMethod: String, data: Data)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#13_35"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:13</td><td><pre>    private let protocolTransport: ProtocolTransport</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#19_33"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:19</td><td><pre>        self.protocolTransport = ProtocolTransport(dataTransport: dataTransport)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#26_47"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:26</td><td><pre>    public func transportReceived(_ transport: ProtocolTransport, undecodableData data: Data) {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#34_47"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:34</td><td><pre>    public func transportReceived(_ transport: ProtocolTransport, notificationMethod: String, data: Data) {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#101_45"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:101</td><td><pre>    typealias ProtocolResponse&lt;T: Codable> = ProtocolTransport.ResponseResult&lt;T></pre></td></table></span></a></span> {
0024        <span class='builtin'><a name='24_4'>public</a></span> <span class='keyword'><a name='24_11'>typealias</a></span> <span class='identifier'><a name='24_21' href='#' title='usrString2' onclick='return expand(this);'>ResponseResult<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#62_92"; return false;'>ProtocolTransport.swift:62</td><td><pre>    public func sendRequest&lt;T, U>(_ request: T, method: String, responseHandler: @escaping (ResponseResult&lt;U>) -> Void) where T: Codable, U: Decodable {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#85_82"; return false;'>ProtocolTransport.swift:85</td><td><pre>    private func relayResponse&lt;T>(result: DataResult, responseHandler: @escaping (ResponseResult&lt;T>) -> Void) where T: Decodable {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#101_63"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:101</td><td><pre>    typealias ProtocolResponse&lt;T: Codable> = ProtocolTransport.ResponseResult&lt;T></pre></td></table></span></a></span>&lt;<span class='identifier'><a name='24_36' href='#' title='usrString2' onclick='return expand(this);'>T<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#24_79"; return false;'>ProtocolTransport.swift:24</td><td><pre>    public typealias ResponseResult&lt;T: Codable> = Result&lt;JSONRPCResultResponse&lt;T>, ProtocolTransportError></pre></td></table></span></a></span>: <span class='typeidentifier'><a name='24_39'>Codable</a></span>> = <span class='typeidentifier'><a name='24_50'>Result</a></span>&lt;<span class='typeidentifier'><a name='24_57'>JSONRPCResultResponse</a></span>&lt;<span class='typeidentifier'><a name='24_79'>T</a></span>>, <span class='typeidentifier'><a name='24_83'>ProtocolTransportError</a></span>>
0025        <span class='builtin'><a name='25_4'>public</a></span> <span class='keyword'><a name='25_11'>typealias</a></span> <span class='identifier'><a name='25_21' href='#' title='usrString2' onclick='return expand(this);'>DataResult<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#26_41"; return false;'>ProtocolTransport.swift:26</td><td><pre>    public typealias MessageResponder = (DataResult) -> Void</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#85_42"; return false;'>ProtocolTransport.swift:85</td><td><pre>    private func relayResponse&lt;T>(result: DataResult, responseHandler: @escaping (ResponseResult&lt;T>) -> Void) where T: Decodable {</pre></td></table></span></a></span> = <span class='typeidentifier'><a name='25_34'>Result</a></span>&lt;<span class='typeidentifier'><a name='25_41'>Data</a></span>, <span class='typeidentifier'><a name='25_47'>ProtocolTransportError</a></span>>
0026        <span class='builtin'><a name='26_4'>public</a></span> <span class='keyword'><a name='26_11'>typealias</a></span> <span class='identifier'><a name='26_21' href='#' title='usrString2' onclick='return expand(this);'>MessageResponder<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#30_37"; return false;'>ProtocolTransport.swift:30</td><td><pre>    private var responders: [JSONId: MessageResponder]</pre></td></table></span></a></span> = (<span class='typeidentifier'><a name='26_41'>DataResult</a></span>) -> <span class='typeidentifier'><a name='26_56'>Void</a></span>
0027        
0028        <span class='builtin'><a name='28_4'>private</a></span> <span class='keyword'><a name='28_12'>var</a></span> <span class='identifier'><a name='28_16' href='#' title='usrString2' onclick='return expand(this);'>id<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#55_40"; return false;'>ProtocolTransport.swift:55</td><td><pre>        let issuedId = JSONId.numericId(id)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#57_8"; return false;'>ProtocolTransport.swift:57</td><td><pre>        id += 1</pre></td></table></span></a></span> = <span class='number'><a name='28_21'>1</a></span>
0029        <span class='builtin'><a name='29_4'>private</a></span> <span class='keyword'><a name='29_12'>let</a></span> <span class='identifier'><a name='29_16' href='#' title='usrString2' onclick='return expand(this);'>messageTransport<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#37_13"; return false;'>ProtocolTransport.swift:37</td><td><pre>        self.messageTransport = messageTransport</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#43_13"; return false;'>ProtocolTransport.swift:43</td><td><pre>        self.messageTransport.dataHandler = { [unowned self] (data) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#77_17"; return false;'>ProtocolTransport.swift:77</td><td><pre>            self.messageTransport.write(jsonData)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#115_17"; return false;'>ProtocolTransport.swift:115</td><td><pre>            self.messageTransport.write(jsonData)</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='29_34'>MessageTransport</a></span>
0030        <span class='builtin'><a name='30_4'>private</a></span> <span class='keyword'><a name='30_12'>var</a></span> <span class='identifier'><a name='30_16' href='#' title='usrString2' onclick='return expand(this);'>responders<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#38_13"; return false;'>ProtocolTransport.swift:38</td><td><pre>        self.responders = [:]</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#79_17"; return false;'>ProtocolTransport.swift:79</td><td><pre>            self.responders[issuedId] = { [unowned self] (result) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#142_30"; return false;'>ProtocolTransport.swift:142</td><td><pre>        guard let responder = responders[message.id] else {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#151_8"; return false;'>ProtocolTransport.swift:151</td><td><pre>        responders.removeValue(forKey: message.id)</pre></td></table></span></a></span>: [<span class='typeidentifier'><a name='30_29'>JSONId</a></span>: <span class='typeidentifier'><a name='30_37'>MessageResponder</a></span>]
0031        <span class='builtin'><a name='31_4'>private</a></span> <span class='keyword'><a name='31_12'>let</a></span> <span class='identifier'><a name='31_16' href='#' title='usrString2' onclick='return expand(this);'>encoder<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#39_13"; return false;'>ProtocolTransport.swift:39</td><td><pre>        self.encoder = JSONEncoder()</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#71_36"; return false;'>ProtocolTransport.swift:71</td><td><pre>                jsonData = try self.encoder.encode(rpcRequest)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#109_36"; return false;'>ProtocolTransport.swift:109</td><td><pre>                jsonData = try self.encoder.encode(notification)</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='31_25'>JSONEncoder</a></span>
0032        <span class='builtin'><a name='32_4'>private</a></span> <span class='keyword'><a name='32_12'>let</a></span> <span class='identifier'><a name='32_16' href='#' title='usrString2' onclick='return expand(this);'>decoder<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#40_13"; return false;'>ProtocolTransport.swift:40</td><td><pre>        self.decoder = JSONDecoder()</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#92_46"; return false;'>ProtocolTransport.swift:92</td><td><pre>                    let jsonResult = try self.decoder.decode(JSONRPCResultResponse&lt;T>.self, from: data)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#123_39"; return false;'>ProtocolTransport.swift:123</td><td><pre>            if let message = try? self.decoder.decode(JSONRPCResponse.self, from: data) {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#128_44"; return false;'>ProtocolTransport.swift:128</td><td><pre>            if let notification = try? self.decoder.decode(JSONRPCNotification.self, from: data) {</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='32_25'>JSONDecoder</a></span>
0033        <span class='builtin'><a name='33_4'>public</a></span> <span class='builtin'><a name='33_11'>weak</a></span> <span class='keyword'><a name='33_16'>var</a></span> <span class='identifier'><a name='33_20' href='#' title='usrString2' onclick='return expand(this);'>delegate<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#133_17"; return false;'>ProtocolTransport.swift:133</td><td><pre>            self.delegate?.transportReceived(self, undecodableData: data)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#157_13"; return false;'>ProtocolTransport.swift:157</td><td><pre>        self.delegate?.transportReceived(self, notificationMethod: method, data: data)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#21_31"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:21</td><td><pre>        self.protocolTransport.delegate = self</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='33_30'>ProtocolTransportDelegate</a></span>?
0034        <span class='builtin'><a name='34_4'>private</a></span> <span class='keyword'><a name='34_12'>let</a></span> <span class='identifier'><a name='34_16' href='#' title='usrString2' onclick='return expand(this);'>queue<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#41_13"; return false;'>ProtocolTransport.swift:41</td><td><pre>        self.queue = DispatchQueue(label: "com.chimehq.SwiftLSPClient.ProtocolTransport")</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#63_8"; return false;'>ProtocolTransport.swift:63</td><td><pre>        queue.async {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#90_12"; return false;'>ProtocolTransport.swift:90</td><td><pre>            queue.async {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#105_8"; return false;'>ProtocolTransport.swift:105</td><td><pre>        queue.async {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#122_8"; return false;'>ProtocolTransport.swift:122</td><td><pre>        queue.async {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#139_53"; return false;'>ProtocolTransport.swift:139</td><td><pre>            dispatchPrecondition(condition: .onQueue(queue))</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='34_23'>DispatchQueue</a></span>
0035        
0036        <span class='builtin'><a name='36_4'>public</a></span> <span class='keyword'><a name='36_11'>init</a></span>(<span class='identifier'><a name='36_16' href='#' title='usrString2' onclick='return expand(this);'>messageTransport<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#37_32"; return false;'>ProtocolTransport.swift:37</td><td><pre>        self.messageTransport = messageTransport</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='36_34'>MessageTransport</a></span>) {
0037            <span class='keyword'><a name='37_8'>self</a></span>.<span class='identifier'><a name='37_13' href='ProtocolTransport.html#29_16' title='usrString1'>messageTransport</a></span> = <span class='identifier'><a name='37_32' href='ProtocolTransport.html#36_16' title='usrString1'>messageTransport</a></span>
0038            <span class='keyword'><a name='38_8'>self</a></span>.<span class='identifier'><a name='38_13' href='ProtocolTransport.html#30_16' title='usrString1'>responders</a></span> = [:]
0039            <span class='keyword'><a name='39_8'>self</a></span>.<span class='identifier'><a name='39_13' href='ProtocolTransport.html#31_16' title='usrString1'>encoder</a></span> = <span class='identifier'><a name='39_23'>JSONEncoder</a></span>()
0040            <span class='keyword'><a name='40_8'>self</a></span>.<span class='identifier'><a name='40_13' href='ProtocolTransport.html#32_16' title='usrString1'>decoder</a></span> = <span class='identifier'><a name='40_23'>JSONDecoder</a></span>()
0041            <span class='keyword'><a name='41_8'>self</a></span>.<span class='identifier'><a name='41_13' href='ProtocolTransport.html#34_16' title='usrString1'>queue</a></span> = <span class='identifier'><a name='41_21'>DispatchQueue</a></span>(<span class='identifier'><a name='41_35'>label</a></span>: <span class='string'><a name='41_42'>"com.chimehq.SwiftLSPClient.ProtocolTransport"</a></span>)
0042            
0043            <span class='keyword'><a name='43_8'>self</a></span>.<span class='identifier'><a name='43_13' href='ProtocolTransport.html#29_16' title='usrString1'>messageTransport</a></span>.<span class='identifier'><a name='43_30' href='MessageTransport.html#13_8' title='usrString1'>dataHandler</a></span> = { [<span class='builtin'><a name='43_47'>unowned</a></span> <span class='keyword'><a name='43_55'>self</a></span>] (<span class='identifier'><a name='43_62' title='usrString3'>data</a></span>) <span class='keyword'><a name='43_68'>in</a></span>
0044                <span class='keyword'><a name='44_12'>self</a></span>.<span class='identifier'><a name='44_17' href='ProtocolTransport.html#121_17' title='usrString1'>dataAvailable</a></span>(<span class='identifier'><a name='44_31' href='ProtocolTransport.html#43_62' title='usrString1'>data</a></span>)
0045            }
0046        }
0047    
0048        <span class='builtin'><a name='48_4'>public</a></span> <span class='builtin'><a name='48_11'>convenience</a></span> <span class='keyword'><a name='48_23'>init</a></span>(<span class='identifier'><a name='48_28' href='#' title='usrString2' onclick='return expand(this);'>dataTransport<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#49_63"; return false;'>ProtocolTransport.swift:49</td><td><pre>        let messageTransport = MessageTransport(dataTransport: dataTransport)</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='48_43'>DataTransport</a></span>) {
0049            <span class='keyword'><a name='49_8'>let</a></span> <span class='identifier'><a name='49_12' title='usrString3'>messageTransport</a></span> = <span class='identifier'><a name='49_31' href='MessageTransport.html#11_13' title='usrString1'>MessageTransport</a></span>(<span class='identifier'><a name='49_48' href='MessageTransport.html#19_11' title='usrString1'>dataTransport</a></span>: <span class='identifier'><a name='49_63' href='ProtocolTransport.html#48_28' title='usrString1'>dataTransport</a></span>)
0050            
0051            <span class='keyword'><a name='51_8'>self</a></span>.<span class='identifier'><a name='51_13' href='ProtocolTransport.html#36_11' title='usrString1'>init</a></span>(<span class='identifier'><a name='51_18'>messageTransport</a></span>: <span class='identifier'><a name='51_36' href='ProtocolTransport.html#49_12' title='usrString1'>messageTransport</a></span>)
0052        }
0053        
0054        <span class='builtin'><a name='54_4'>private</a></span> <span class='keyword'><a name='54_12'>func</a></span> <span class='identifier'><a name='54_17' href='#' title='usrString2' onclick='return expand(this);'>generateID<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#64_32"; return false;'>ProtocolTransport.swift:64</td><td><pre>            let issuedId = self.generateID()</pre></td></table></span></a></span>() -> <span class='typeidentifier'><a name='54_33'>JSONId</a></span> {
0055            <span class='keyword'><a name='55_8'>let</a></span> <span class='identifier'><a name='55_12' title='usrString3'>issuedId</a></span> = <span class='identifier'><a name='55_23' href='JSONRPC.html#11_12' title='usrString1'>JSONId</a></span>.<span class='identifier'><a name='55_30' href='JSONRPC.html#12_9' title='usrString1'>numericId</a></span>(<span class='identifier'><a name='55_40' href='ProtocolTransport.html#28_16' title='usrString1'>id</a></span>)
0056            
0057            <span class='identifier'><a name='57_8' href='ProtocolTransport.html#28_16' title='usrString1'>id</a></span> += <span class='number'><a name='57_14'>1</a></span>
0058            
0059            <span class='keyword'><a name='59_8'>return</a></span> <span class='identifier'><a name='59_15' href='ProtocolTransport.html#55_12' title='usrString1'>issuedId</a></span>
0060        }
0061        
0062        <span class='builtin'><a name='62_4'>public</a></span> <span class='keyword'><a name='62_11'>func</a></span> <span class='identifier'><a name='62_16' href='#' title='usrString2' onclick='return expand(this);'>sendRequest<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#106_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:106</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;InitializationResponse>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#114_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:114</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;Hover>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#167_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:167</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;WillSaveWaitUntilResponse>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#184_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:184</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;CompletionResponse>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#192_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:192</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;SignatureHelp>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#200_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:200</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;DeclarationResponse?>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#208_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:208</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;DefinitionResponse?>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#216_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:216</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;TypeDefinitionResponse?>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#224_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:224</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;ImplementationResponse?>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#232_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:232</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;DocumentSymbolResponse>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#240_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:240</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;FormattingResult>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#248_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:248</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;FormattingResult>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#256_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:256</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;FormattingResult>) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#264_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:264</td><td><pre>        protocolTransport.sendRequest(params, method: method) { (result: ProtocolResponse&lt;ReferenceResponse?>) in</pre></td></table></span></a></span>&lt;<span class='identifier'><a name='62_28' title='usrString3'>T</a></span>, <span class='identifier'><a name='62_31' title='usrString3'>U</a></span>>(<span class='keyword'><a name='62_34'>_</a></span> <span class='identifier'><a name='62_36' title='usrString2' onclick='return expand(this);'>request<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='62_45'>T</a></span>, <span class='identifier'><a name='62_48' href='#' title='usrString2' onclick='return expand(this);'>method<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#66_66"; return false;'>ProtocolTransport.swift:66</td><td><pre>            let rpcRequest = JSONRPCRequest(id: issuedId, method: method, params: request)</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='62_56'>String</a></span>, <span class='identifier'><a name='62_64' href='#' title='usrString2' onclick='return expand(this);'>responseHandler<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#73_16"; return false;'>ProtocolTransport.swift:73</td><td><pre>                responseHandler(.failure(.encodingFailure(error)))</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#80_68"; return false;'>ProtocolTransport.swift:80</td><td><pre>                self.relayResponse(result: result, responseHandler: responseHandler)</pre></td></table></span></a></span>: <span class='builtin'><a name='62_81'>@escaping</a></span> (<span class='typeidentifier'><a name='62_92'>ResponseResult</a></span>&lt;<span class='typeidentifier'><a name='62_107'>U</a></span>>) -> <span class='typeidentifier'><a name='62_114'>Void</a></span>) <span class='keyword'><a name='62_120'>where</a></span> <span class='typeidentifier'><a name='62_126'>T</a></span>: <span class='typeidentifier'><a name='62_129'>Codable</a></span>, <span class='typeidentifier'><a name='62_138'>U</a></span>: <span class='typeidentifier'><a name='62_141'>Decodable</a></span> {
0063            <span class='identifier'><a name='63_8' href='ProtocolTransport.html#34_16' title='usrString1'>queue</a></span>.<span class='identifier'><a name='63_14'>async</a></span> {
0064                <span class='keyword'><a name='64_12'>let</a></span> <span class='identifier'><a name='64_16' title='usrString3'>issuedId</a></span> = <span class='keyword'><a name='64_27'>self</a></span>.<span class='identifier'><a name='64_32' href='ProtocolTransport.html#54_17' title='usrString1'>generateID</a></span>()
0065    
0066                <span class='keyword'><a name='66_12'>let</a></span> <span class='identifier'><a name='66_16' title='usrString3'>rpcRequest</a></span> = <span class='identifier'><a name='66_29' href='JSONRPC.html#55_14' title='usrString1'>JSONRPCRequest</a></span>(<span class='identifier'><a name='66_44' href='JSONRPC.html#55_14' title='usrString1'>id</a></span>: <span class='identifier'><a name='66_48' href='ProtocolTransport.html#64_16' title='usrString1'>issuedId</a></span>, <span class='identifier'><a name='66_58' href='JSONRPC.html#55_14' title='usrString1'>method</a></span>: <span class='identifier'><a name='66_66' href='ProtocolTransport.html#62_48' title='usrString1'>method</a></span>, <span class='identifier'><a name='66_74' href='JSONRPC.html#55_14' title='usrString1'>params</a></span>: <span class='identifier'><a name='66_82' href='ProtocolTransport.html#62_36' title='usrString1'>request</a></span>)
0067    
0068                <span class='keyword'><a name='68_12'>let</a></span> <span class='identifier'><a name='68_16' title='usrString3'>jsonData</a></span>: <span class='typeidentifier'><a name='68_26'>Data</a></span>
0069    
0070                <span class='keyword'><a name='70_12'>do</a></span> {
0071                    <span class='identifier'><a name='71_16' href='ProtocolTransport.html#68_16' title='usrString1'>jsonData</a></span> = <span class='keyword'><a name='71_27'>try</a></span> <span class='keyword'><a name='71_31'>self</a></span>.<span class='identifier'><a name='71_36' href='ProtocolTransport.html#31_16' title='usrString1'>encoder</a></span>.<span class='identifier'><a name='71_44'>encode</a></span>(<span class='identifier'><a name='71_51' href='ProtocolTransport.html#66_16' title='usrString1'>rpcRequest</a></span>)
0072                } <span class='keyword'><a name='72_14'>catch</a></span> {
0073                    <span class='identifier'><a name='73_16' href='ProtocolTransport.html#62_64' title='usrString1'>responseHandler</a></span>(.<span class='identifier'><a name='73_33'>failure</a></span>(.<span class='identifier'><a name='73_42' href='ProtocolTransport.html#12_9' title='usrString1'>encodingFailure</a></span>(<span class='identifier'><a name='73_58' href='ProtocolTransport.html#72_20' title='usrString1'>error</a></span>)))
0074                    <span class='keyword'><a name='74_16'>return</a></span>
0075                }
0076    
0077                <span class='keyword'><a name='77_12'>self</a></span>.<span class='identifier'><a name='77_17' href='ProtocolTransport.html#29_16' title='usrString1'>messageTransport</a></span>.<span class='identifier'><a name='77_34' href='MessageTransport.html#156_16' title='usrString1'>write</a></span>(<span class='identifier'><a name='77_40' href='ProtocolTransport.html#68_16' title='usrString1'>jsonData</a></span>)
0078    
0079                <span class='keyword'><a name='79_12'>self</a></span>.<span class='identifier'><a name='79_17' href='ProtocolTransport.html#30_16' title='usrString1'>responders</a></span>[<span class='identifier'><a name='79_28' href='ProtocolTransport.html#64_16' title='usrString1'>issuedId</a></span>] = { [<span class='builtin'><a name='79_43'>unowned</a></span> <span class='keyword'><a name='79_51'>self</a></span>] (<span class='identifier'><a name='79_58' title='usrString3'>result</a></span>) <span class='keyword'><a name='79_66'>in</a></span>
0080                    <span class='keyword'><a name='80_16'>self</a></span>.<span class='identifier'><a name='80_21' href='ProtocolTransport.html#85_17' title='usrString1'>relayResponse</a></span>(<span class='identifier'><a name='80_35' href='ProtocolTransport.html#85_17' title='usrString1'>result</a></span>: <span class='identifier'><a name='80_43' href='ProtocolTransport.html#79_58' title='usrString1'>result</a></span>, <span class='identifier'><a name='80_51' href='ProtocolTransport.html#85_17' title='usrString1'>responseHandler</a></span>: <span class='identifier'><a name='80_68' href='ProtocolTransport.html#62_64' title='usrString1'>responseHandler</a></span>)
0081                }
0082            }
0083        }
0084    
0085        <span class='builtin'><a name='85_4'>private</a></span> <span class='keyword'><a name='85_12'>func</a></span> <span class='identifier'><a name='85_17' href='#' title='usrString2' onclick='return expand(this);'>relayResponse<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#80_21"; return false;'>ProtocolTransport.swift:80</td><td><pre>                self.relayResponse(result: result, responseHandler: responseHandler)</pre></td></table></span></a></span>&lt;<span class='identifier'><a name='85_31' title='usrString3'>T</a></span>>(<span class='identifier'><a name='85_34' href='#' title='usrString2' onclick='return expand(this);'>result<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#86_15"; return false;'>ProtocolTransport.swift:86</td><td><pre>        switch result {</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='85_42'>DataResult</a></span>, <span class='identifier'><a name='85_54' href='#' title='usrString2' onclick='return expand(this);'>responseHandler<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#88_12"; return false;'>ProtocolTransport.swift:88</td><td><pre>            responseHandler(.failure(.responderRelayFailure(error)))</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#94_20"; return false;'>ProtocolTransport.swift:94</td><td><pre>                    responseHandler(.success(jsonResult))</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#96_20"; return false;'>ProtocolTransport.swift:96</td><td><pre>                    responseHandler(.failure(.decodingFailure(error)))</pre></td></table></span></a></span>: <span class='builtin'><a name='85_71'>@escaping</a></span> (<span class='typeidentifier'><a name='85_82'>ResponseResult</a></span>&lt;<span class='typeidentifier'><a name='85_97'>T</a></span>>) -> <span class='typeidentifier'><a name='85_104'>Void</a></span>) <span class='keyword'><a name='85_110'>where</a></span> <span class='typeidentifier'><a name='85_116'>T</a></span>: <span class='typeidentifier'><a name='85_119'>Decodable</a></span> {
0086            <span class='keyword'><a name='86_8'>switch</a></span> <span class='identifier'><a name='86_15' href='ProtocolTransport.html#85_34' title='usrString1'>result</a></span> {
0087            <span class='keyword'><a name='87_8'>case</a></span> .<span class='identifier'><a name='87_14'>failure</a></span>(<span class='keyword'><a name='87_22'>let</a></span> <span class='identifier'><a name='87_26' title='usrString3'>error</a></span>):
0088                <span class='identifier'><a name='88_12' href='ProtocolTransport.html#85_54' title='usrString1'>responseHandler</a></span>(.<span class='identifier'><a name='88_29'>failure</a></span>(.<span class='identifier'><a name='88_38' href='ProtocolTransport.html#15_9' title='usrString1'>responderRelayFailure</a></span>(<span class='identifier'><a name='88_60' href='ProtocolTransport.html#87_26' title='usrString1'>error</a></span>)))
0089            <span class='keyword'><a name='89_8'>case</a></span> .<span class='identifier'><a name='89_14'>success</a></span>(<span class='keyword'><a name='89_22'>let</a></span> <span class='identifier'><a name='89_26' title='usrString3'>data</a></span>):
0090                <span class='identifier'><a name='90_12' href='ProtocolTransport.html#34_16' title='usrString1'>queue</a></span>.<span class='identifier'><a name='90_18'>async</a></span> {
0091                    <span class='keyword'><a name='91_16'>do</a></span> {
0092                        <span class='keyword'><a name='92_20'>let</a></span> <span class='identifier'><a name='92_24' title='usrString3'>jsonResult</a></span> = <span class='keyword'><a name='92_37'>try</a></span> <span class='keyword'><a name='92_41'>self</a></span>.<span class='identifier'><a name='92_46' href='ProtocolTransport.html#32_16' title='usrString1'>decoder</a></span>.<span class='identifier'><a name='92_54'>decode</a></span>(<span class='identifier'><a name='92_61' href='JSONRPC.html#78_14' title='usrString1'>JSONRPCResultResponse</a></span>&lt;<span class='typeidentifier'><a name='92_83'>T</a></span>>.<span class='keyword'><a name='92_86'>self</a></span>, <span class='identifier'><a name='92_92'>from</a></span>: <span class='identifier'><a name='92_98' href='ProtocolTransport.html#89_26' title='usrString1'>data</a></span>)
0093    
0094                        <span class='identifier'><a name='94_20' href='ProtocolTransport.html#85_54' title='usrString1'>responseHandler</a></span>(.<span class='identifier'><a name='94_37'>success</a></span>(<span class='identifier'><a name='94_45' href='ProtocolTransport.html#92_24' title='usrString1'>jsonResult</a></span>))
0095                    } <span class='keyword'><a name='95_18'>catch</a></span> {
0096                        <span class='identifier'><a name='96_20' href='ProtocolTransport.html#85_54' title='usrString1'>responseHandler</a></span>(.<span class='identifier'><a name='96_37'>failure</a></span>(.<span class='identifier'><a name='96_46' href='ProtocolTransport.html#13_9' title='usrString1'>decodingFailure</a></span>(<span class='identifier'><a name='96_62' href='ProtocolTransport.html#95_24' title='usrString1'>error</a></span>)))
0097                    }
0098                }
0099            }
0100        }
0101        
0102        <span class='builtin'><a name='102_4'>public</a></span> <span class='keyword'><a name='102_11'>func</a></span> <span class='identifier'><a name='102_16' href='#' title='usrString2' onclick='return expand(this);'>sendNotification<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#122_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:122</td><td><pre>        protocolTransport.sendNotification(params, method: method) { (error) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#131_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:131</td><td><pre>        protocolTransport.sendNotification(params, method: method) { (error) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#140_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:140</td><td><pre>        protocolTransport.sendNotification(params, method: method) { (error) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#149_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:149</td><td><pre>        protocolTransport.sendNotification(params, method: method) { (error) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#158_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:158</td><td><pre>        protocolTransport.sendNotification(params, method: method)  { (error) in</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="JSONRPCLanguageServer.html#175_26"; event.stopPropagation(); return false;'>JSONRPCLanguageServer.swift:175</td><td><pre>        protocolTransport.sendNotification(params, method: method) { (error) in</pre></td></table></span></a></span>&lt;<span class='identifier'><a name='102_33' title='usrString3'>T</a></span>>(<span class='keyword'><a name='102_36'>_</a></span> <span class='identifier'><a name='102_38' title='usrString2' onclick='return expand(this);'>params<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='102_46'>T</a></span>, <span class='identifier'><a name='102_49' href='#' title='usrString2' onclick='return expand(this);'>method<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#103_61"; return false;'>ProtocolTransport.swift:103</td><td><pre>        let notification = JSONRPCNotificationParams(method: method, params: params)</pre></td></table></span></a></span>: <span class='typeidentifier'><a name='102_57'>String</a></span>, <span class='identifier'><a name='102_65' href='#' title='usrString2' onclick='return expand(this);'>block<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#111_16"; return false;'>ProtocolTransport.swift:111</td><td><pre>                block(.encodingFailure(error))</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#117_12"; return false;'>ProtocolTransport.swift:117</td><td><pre>            block(nil)</pre></td></table></span></a></span>: <span class='builtin'><a name='102_72'>@escaping</a></span> (<span class='typeidentifier'><a name='102_83'>ProtocolTransportError</a></span>?) -> <span class='typeidentifier'><a name='102_111'>Void</a></span>) <span class='keyword'><a name='102_117'>where</a></span> <span class='typeidentifier'><a name='102_123'>T</a></span>: <span class='typeidentifier'><a name='102_126'>Codable</a></span> {
0103            <span class='keyword'><a name='103_8'>let</a></span> <span class='identifier'><a name='103_12' title='usrString3'>notification</a></span> = <span class='identifier'><a name='103_27' href='JSONRPC.html#111_14' title='usrString1'>JSONRPCNotificationParams</a></span>(<span class='identifier'><a name='103_53' href='JSONRPC.html#111_14' title='usrString1'>method</a></span>: <span class='identifier'><a name='103_61' href='ProtocolTransport.html#102_49' title='usrString1'>method</a></span>, <span class='identifier'><a name='103_69' href='JSONRPC.html#111_14' title='usrString1'>params</a></span>: <span class='identifier'><a name='103_77' href='ProtocolTransport.html#102_38' title='usrString1'>params</a></span>)
0104    
0105            <span class='identifier'><a name='105_8' href='ProtocolTransport.html#34_16' title='usrString1'>queue</a></span>.<span class='identifier'><a name='105_14'>async</a></span> {
0106                <span class='keyword'><a name='106_12'>let</a></span> <span class='identifier'><a name='106_16' title='usrString3'>jsonData</a></span>: <span class='typeidentifier'><a name='106_26'>Data</a></span>
0107    
0108                <span class='keyword'><a name='108_12'>do</a></span> {
0109                    <span class='identifier'><a name='109_16' href='ProtocolTransport.html#106_16' title='usrString1'>jsonData</a></span> = <span class='keyword'><a name='109_27'>try</a></span> <span class='keyword'><a name='109_31'>self</a></span>.<span class='identifier'><a name='109_36' href='ProtocolTransport.html#31_16' title='usrString1'>encoder</a></span>.<span class='identifier'><a name='109_44'>encode</a></span>(<span class='identifier'><a name='109_51' href='ProtocolTransport.html#103_12' title='usrString1'>notification</a></span>)
0110                } <span class='keyword'><a name='110_14'>catch</a></span> {
0111                    <span class='identifier'><a name='111_16' href='ProtocolTransport.html#102_65' title='usrString1'>block</a></span>(.<span class='identifier'><a name='111_23' href='ProtocolTransport.html#12_9' title='usrString1'>encodingFailure</a></span>(<span class='identifier'><a name='111_39' href='ProtocolTransport.html#110_20' title='usrString1'>error</a></span>))
0112                    <span class='keyword'><a name='112_16'>return</a></span>
0113                }
0114    
0115                <span class='keyword'><a name='115_12'>self</a></span>.<span class='identifier'><a name='115_17' href='ProtocolTransport.html#29_16' title='usrString1'>messageTransport</a></span>.<span class='identifier'><a name='115_34' href='MessageTransport.html#156_16' title='usrString1'>write</a></span>(<span class='identifier'><a name='115_40' href='ProtocolTransport.html#106_16' title='usrString1'>jsonData</a></span>)
0116    
0117                <span class='identifier'><a name='117_12' href='ProtocolTransport.html#102_65' title='usrString1'>block</a></span>(<span class='keyword'><a name='117_18'>nil</a></span>)
0118            }
0119        }
0120        
0121        <span class='builtin'><a name='121_4'>private</a></span> <span class='keyword'><a name='121_12'>func</a></span> <span class='identifier'><a name='121_17' href='#' title='usrString2' onclick='return expand(this);'>dataAvailable<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#44_17"; return false;'>ProtocolTransport.swift:44</td><td><pre>            self.dataAvailable(data)</pre></td></table></span></a></span>(<span class='keyword'><a name='121_31'>_</a></span> <span class='identifier'><a name='121_33' title='usrString2' onclick='return expand(this);'>data<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='121_39'>Data</a></span>) {
0122            <span class='identifier'><a name='122_8' href='ProtocolTransport.html#34_16' title='usrString1'>queue</a></span>.<span class='identifier'><a name='122_14'>async</a></span> {
0123                <span class='keyword'><a name='123_12'>if</a></span> <span class='keyword'><a name='123_15'>let</a></span> <span class='identifier'><a name='123_19' title='usrString3'>message</a></span> = <span class='keyword'><a name='123_29'>try</a></span>? <span class='keyword'><a name='123_34'>self</a></span>.<span class='identifier'><a name='123_39' href='ProtocolTransport.html#32_16' title='usrString1'>decoder</a></span>.<span class='identifier'><a name='123_47'>decode</a></span>(<span class='identifier'><a name='123_54' href='JSONRPC.html#72_14' title='usrString1'>JSONRPCResponse</a></span>.<span class='keyword'><a name='123_70'>self</a></span>, <span class='identifier'><a name='123_76'>from</a></span>: <span class='identifier'><a name='123_82' href='ProtocolTransport.html#121_33' title='usrString1'>data</a></span>) {
0124                    <span class='keyword'><a name='124_16'>self</a></span>.<span class='identifier'><a name='124_21' href='ProtocolTransport.html#137_17' title='usrString1'>dispatchMessage</a></span>(<span class='identifier'><a name='124_37' href='ProtocolTransport.html#123_19' title='usrString1'>message</a></span>, <span class='identifier'><a name='124_46' href='ProtocolTransport.html#137_17' title='usrString1'>originalData</a></span>: <span class='identifier'><a name='124_60' href='ProtocolTransport.html#121_33' title='usrString1'>data</a></span>)
0125                    <span class='keyword'><a name='125_16'>return</a></span>
0126                }
0127    
0128                <span class='keyword'><a name='128_12'>if</a></span> <span class='keyword'><a name='128_15'>let</a></span> <span class='identifier'><a name='128_19' title='usrString3'>notification</a></span> = <span class='keyword'><a name='128_34'>try</a></span>? <span class='keyword'><a name='128_39'>self</a></span>.<span class='identifier'><a name='128_44' href='ProtocolTransport.html#32_16' title='usrString1'>decoder</a></span>.<span class='identifier'><a name='128_52'>decode</a></span>(<span class='identifier'><a name='128_59' href='JSONRPC.html#106_14' title='usrString1'>JSONRPCNotification</a></span>.<span class='keyword'><a name='128_79'>self</a></span>, <span class='identifier'><a name='128_85'>from</a></span>: <span class='identifier'><a name='128_91' href='ProtocolTransport.html#121_33' title='usrString1'>data</a></span>) {
0129                    <span class='keyword'><a name='129_16'>self</a></span>.<span class='identifier'><a name='129_21' href='ProtocolTransport.html#154_17' title='usrString1'>dispatchNotification</a></span>(<span class='identifier'><a name='129_42' href='ProtocolTransport.html#128_19' title='usrString1'>notification</a></span>, <span class='identifier'><a name='129_56' href='ProtocolTransport.html#154_17' title='usrString1'>originalData</a></span>: <span class='identifier'><a name='129_70' href='ProtocolTransport.html#121_33' title='usrString1'>data</a></span>)
0130                    <span class='keyword'><a name='130_16'>return</a></span>
0131                }
0132    
0133                <span class='keyword'><a name='133_12'>self</a></span>.<span class='identifier'><a name='133_17' href='ProtocolTransport.html#33_20' title='usrString1'>delegate</a></span>?.<span class='identifier'><a name='133_27' href='ProtocolTransport.html#19_9' title='usrString1'>transportReceived</a></span>(<span class='keyword'><a name='133_45'>self</a></span>, <span class='identifier'><a name='133_51' href='ProtocolTransport.html#19_9' title='usrString1'>undecodableData</a></span>: <span class='identifier'><a name='133_68' href='ProtocolTransport.html#121_33' title='usrString1'>data</a></span>)
0134            }
0135        }
0136        
0137        <span class='builtin'><a name='137_4'>private</a></span> <span class='keyword'><a name='137_12'>func</a></span> <span class='identifier'><a name='137_17' href='#' title='usrString2' onclick='return expand(this);'>dispatchMessage<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#124_21"; return false;'>ProtocolTransport.swift:124</td><td><pre>                self.dispatchMessage(message, originalData: data)</pre></td></table></span></a></span>(<span class='keyword'><a name='137_33'>_</a></span> <span class='identifier'><a name='137_35' title='usrString2' onclick='return expand(this);'>message<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='137_44'>JSONRPCResponse</a></span>, <span class='identifier'><a name='137_61' href='ProtocolTransport.html#137_17' title='usrString1'>originalData</a></span> <span class='identifier'><a name='137_74' title='usrString2' onclick='return expand(this);'>data<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='137_80'>Data</a></span>) {
0138            <span class='keyword'><a name='138_8'>if</a></span> <span class='keyword'><a name='138_11'>#available</a></span>(<span class='keyword'><a name='138_22'>OSX</a></span> <span class='number'><a name='138_26'>10.12</a></span>, *) {
0139                <span class='identifier'><a name='139_12'>dispatchPrecondition</a></span>(<span class='identifier'><a name='139_33'>condition</a></span>: .<span class='identifier'><a name='139_45'>onQueue</a></span>(<span class='identifier'><a name='139_53' href='ProtocolTransport.html#34_16' title='usrString1'>queue</a></span>))
0140            }
0141    
0142            <span class='keyword'><a name='142_8'>guard</a></span> <span class='keyword'><a name='142_14'>let</a></span> <span class='identifier'><a name='142_18' title='usrString3'>responder</a></span> = <span class='identifier'><a name='142_30' href='ProtocolTransport.html#30_16' title='usrString1'>responders</a></span>[<span class='identifier'><a name='142_41' href='ProtocolTransport.html#137_35' title='usrString1'>message</a></span>.<span class='identifier'><a name='142_49' href='JSONRPC.html#74_15' title='usrString1'>id</a></span>] <span class='keyword'><a name='142_53'>else</a></span> {
0143                <span class='comment'><a name='143_12'>// hrm, got a message without a matching responder
0144    </a></span>            <span class='identifier'><a name='144_12'>print</a></span>(<span class='string'><a name='144_18'>"not matching responder for </a></span>\<span class='string_interpolation_anchor'><a name='144_47'>(</a></span><span class='identifier'><a name='144_48' href='ProtocolTransport.html#137_35' title='usrString1'>message</a></span>.<span class='identifier'><a name='144_56' href='JSONRPC.html#74_15' title='usrString1'>id</a></span><span class='string_interpolation_anchor'><a name='144_58'>)</a></span><span class='string'><a name='144_59'>, dropping message"</a></span>)
0145                <span class='keyword'><a name='145_12'>return</a></span>
0146            }
0147                
0148            <span class='identifier'><a name='148_8' href='ProtocolTransport.html#142_18' title='usrString1'>responder</a></span>(.<span class='identifier'><a name='148_19'>success</a></span>(<span class='identifier'><a name='148_27' href='ProtocolTransport.html#137_74' title='usrString1'>data</a></span>))
0149    
0150            <span class='comment'><a name='150_8'>// TODO: This doesn't seem to be threadsafe
0151    </a></span>        <span class='identifier'><a name='151_8' href='ProtocolTransport.html#30_16' title='usrString1'>responders</a></span>.<span class='identifier'><a name='151_19'>removeValue</a></span>(<span class='identifier'><a name='151_31'>forKey</a></span>: <span class='identifier'><a name='151_39' href='ProtocolTransport.html#137_35' title='usrString1'>message</a></span>.<span class='identifier'><a name='151_47' href='JSONRPC.html#74_15' title='usrString1'>id</a></span>)
0152        }
0153        
0154        <span class='builtin'><a name='154_4'>private</a></span> <span class='keyword'><a name='154_12'>func</a></span> <span class='identifier'><a name='154_17' href='#' title='usrString2' onclick='return expand(this);'>dispatchNotification<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="ProtocolTransport.html#129_21"; return false;'>ProtocolTransport.swift:129</td><td><pre>                self.dispatchNotification(notification, originalData: data)</pre></td></table></span></a></span>(<span class='keyword'><a name='154_38'>_</a></span> <span class='identifier'><a name='154_40' title='usrString2' onclick='return expand(this);'>notification<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='154_54'>JSONRPCNotification</a></span>, <span class='identifier'><a name='154_75' href='ProtocolTransport.html#154_17' title='usrString1'>originalData</a></span> <span class='identifier'><a name='154_88' title='usrString2' onclick='return expand(this);'>data<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='154_94'>Data</a></span>) {
0155            <span class='keyword'><a name='155_8'>let</a></span> <span class='identifier'><a name='155_12' title='usrString3'>method</a></span> = <span class='identifier'><a name='155_21' href='ProtocolTransport.html#154_40' title='usrString1'>notification</a></span>.<span class='identifier'><a name='155_34' href='JSONRPC.html#108_15' title='usrString1'>method</a></span>
0156    
0157            <span class='keyword'><a name='157_8'>self</a></span>.<span class='identifier'><a name='157_13' href='ProtocolTransport.html#33_20' title='usrString1'>delegate</a></span>?.<span class='identifier'><a name='157_23' href='ProtocolTransport.html#20_9' title='usrString1'>transportReceived</a></span>(<span class='keyword'><a name='157_41'>self</a></span>, <span class='identifier'><a name='157_47' href='ProtocolTransport.html#20_9' title='usrString1'>notificationMethod</a></span>: <span class='identifier'><a name='157_67' href='ProtocolTransport.html#155_12' title='usrString1'>method</a></span>, <span class='identifier'><a name='157_75' href='ProtocolTransport.html#20_9' title='usrString1'>data</a></span>: <span class='identifier'><a name='157_81' href='ProtocolTransport.html#154_88' title='usrString1'>data</a></span>)
0158        }
0159    }
0160    
0161    