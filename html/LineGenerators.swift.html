<html><head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="siteify.css">
<script>

var lastlink;

function expand(a) {
    if ( a.children[0].style.display != "block" ) {
        if ( lastlink )
            lastlink.style.display = "none";
        a.children[0].style.display = "block";
        lastlink = a.children[0];
    }
    else {
        a.children[0].style.display = "none";
        lastlink = null;
    }
    return false;
}

</script></head><body><h3>siteify/LineGenerators.swift</h3><pre><span class=linenum>0001</span>    <span class='comment'>//
<span class=linenum>0002</span>    </span><span class='comment'>//  LineGenerators.swift
<span class=linenum>0003</span>    </span><span class='comment'>//  refactord
<span class=linenum>0004</span>    </span><span class='comment'>//
<span class=linenum>0005</span>    </span><span class='comment'>//  Created by John Holdsworth on 19/12/2015.
<span class=linenum>0006</span>    </span><span class='comment'>//  Copyright Â© 2015 John Holdsworth. All rights reserved.
<span class=linenum>0007</span>    </span><span class='comment'>//
<span class=linenum>0008</span>    </span><span class='comment'>//  $Id: //depot/siteify/siteify/LineGenerators.swift#4 $
<span class=linenum>0009</span>    </span><span class='comment'>//
<span class=linenum>0010</span>    </span><span class='comment'>//  Repo: </span><span class='url'><a href='https://github.com/johnno1962/Refactorator'>https://github.com/johnno1962/Refactorator</a></span><span class='comment'>
<span class=linenum>0011</span>    </span><span class='comment'>//
<span class=linenum>0012</span>    </span>
<span class=linenum>0013</span>    <span class='keyword'>import</span> <span class='identifier'>Foundation</span>
<span class=linenum>0014</span>    
<span class=linenum>0015</span>    <span class='keyword'>class</span> <span class='identifier'><a name='15_6' title='usrString2' onclick='return expand(this);'>TaskGenerator<span class='references'><table></table></span></a></span>: <span class='typeidentifier'><a name='15_21' href='LineGenerators.swift.html#51_6' title='usrString1'>FileGenerator</a></span> {
<span class=linenum>0016</span>    
<span class=linenum>0017</span>        <span class='keyword'>let</span> <span class='identifier'><a name='17_8' href='#' title='usrString2' onclick='return expand(this);'>task<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#35_13"; return false;'>LineGenerators.swift:35</td><td><pre>        self.task = task</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#46_8"; return false;'>LineGenerators.swift:46</td><td><pre>        task.terminate()</pre></td></table></span></a></span>: <span class='typeidentifier'>Process</span>
<span class=linenum>0018</span>    
<span class=linenum>0019</span>        <span class='builtin'>convenience</span> <span class='keyword'>init</span>( <span class='identifier'><a name='19_22' href='#' title='usrString2' onclick='return expand(this);'>command<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#20_70"; return false;'>LineGenerators.swift:20</td><td><pre>        self.init( launchPath: "/bin/bash", arguments: ["-c", "exec \(command)"], directory: directory, lineSeparator: lineSeparator )</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>, <span class='identifier'><a name='19_39' href='#' title='usrString2' onclick='return expand(this);'>directory<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#20_93"; return false;'>LineGenerators.swift:20</td><td><pre>        self.init( launchPath: "/bin/bash", arguments: ["-c", "exec \(command)"], directory: directory, lineSeparator: lineSeparator )</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>? = <span class='keyword'>nil</span>, <span class='identifier'><a name='19_65' href='#' title='usrString2' onclick='return expand(this);'>lineSeparator<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#20_119"; return false;'>LineGenerators.swift:20</td><td><pre>        self.init( launchPath: "/bin/bash", arguments: ["-c", "exec \(command)"], directory: directory, lineSeparator: lineSeparator )</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>? = <span class='keyword'>nil</span> ) {
<span class=linenum>0020</span>            <span class='keyword'>self</span>.<span class='identifier'><a name='20_13' href='LineGenerators.swift.html#23_16' title='usrString1'>init</a></span>( <span class='identifier'>launchPath</span>: <span class='string'>"/bin/bash"</span>, <span class='identifier'>arguments</span>: [<span class='string'>"-c"</span>, <span class='string'>"exec </span>\<span class='string_interpolation_anchor'>(</span><span class='identifier'><a name='20_70' href='LineGenerators.swift.html#19_22' title='usrString1'>command</a></span><span class='string_interpolation_anchor'>)</span><span class='string'>"</span>], <span class='identifier'>directory</span>: <span class='identifier'><a name='20_93' href='LineGenerators.swift.html#19_39' title='usrString1'>directory</a></span>, <span class='identifier'>lineSeparator</span>: <span class='identifier'><a name='20_119' href='LineGenerators.swift.html#19_65' title='usrString1'>lineSeparator</a></span> )
<span class=linenum>0021</span>        }
<span class=linenum>0022</span>    
<span class=linenum>0023</span>        <span class='builtin'>convenience</span> <span class='keyword'>init</span>( <span class='identifier'><a name='23_22' href='#' title='usrString2' onclick='return expand(this);'>launchPath<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#26_26"; return false;'>LineGenerators.swift:26</td><td><pre>        task.launchPath = launchPath</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>, <span class='identifier'><a name='23_42' href='#' title='usrString2' onclick='return expand(this);'>arguments<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#27_25"; return false;'>LineGenerators.swift:27</td><td><pre>        task.arguments = arguments</pre></td></table></span></a></span>: [<span class='typeidentifier'>String</span>] = [], <span class='identifier'><a name='23_68' href='#' title='usrString2' onclick='return expand(this);'>directory<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#28_36"; return false;'>LineGenerators.swift:28</td><td><pre>        task.currentDirectoryPath = directory ?? "."</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>? = <span class='keyword'>nil</span>, <span class='identifier'><a name='23_94' href='#' title='usrString2' onclick='return expand(this);'>lineSeparator<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#30_46"; return false;'>LineGenerators.swift:30</td><td><pre>        self.init( task: task, lineSeparator: lineSeparator )</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>? = <span class='keyword'>nil</span> ) {
<span class=linenum>0024</span>    
<span class=linenum>0025</span>            <span class='keyword'>let</span> <span class='identifier'><a name='25_12' title='usrString3'>task</a></span> = <span class='identifier'>Process</span>()
<span class=linenum>0026</span>            <span class='identifier'><a name='26_8' href='LineGenerators.swift.html#25_12' title='usrString1'>task</a></span>.<span class='identifier'>launchPath</span> = <span class='identifier'><a name='26_26' href='LineGenerators.swift.html#23_22' title='usrString1'>launchPath</a></span>
<span class=linenum>0027</span>            <span class='identifier'><a name='27_8' href='LineGenerators.swift.html#25_12' title='usrString1'>task</a></span>.<span class='identifier'>arguments</span> = <span class='identifier'><a name='27_25' href='LineGenerators.swift.html#23_42' title='usrString1'>arguments</a></span>
<span class=linenum>0028</span>            <span class='identifier'><a name='28_8' href='LineGenerators.swift.html#25_12' title='usrString1'>task</a></span>.<span class='identifier'>currentDirectoryPath</span> = <span class='identifier'><a name='28_36' href='LineGenerators.swift.html#23_68' title='usrString1'>directory</a></span> ?? <span class='string'>"."</span>
<span class=linenum>0029</span>    
<span class=linenum>0030</span>            <span class='keyword'>self</span>.<span class='identifier'><a name='30_13' href='LineGenerators.swift.html#33_4' title='usrString1'>init</a></span>( <span class='identifier'>task</span>: <span class='identifier'><a name='30_25' href='LineGenerators.swift.html#25_12' title='usrString1'>task</a></span>, <span class='identifier'>lineSeparator</span>: <span class='identifier'><a name='30_46' href='LineGenerators.swift.html#23_94' title='usrString1'>lineSeparator</a></span> )
<span class=linenum>0031</span>        }
<span class=linenum>0032</span>    
<span class=linenum>0033</span>        <span class='keyword'>init</span>( <span class='identifier'><a name='33_10' href='#' title='usrString2' onclick='return expand(this);'>task<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#35_20"; return false;'>LineGenerators.swift:35</td><td><pre>        self.task = task</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#38_8"; return false;'>LineGenerators.swift:38</td><td><pre>        task.standardOutput = pipe.fileHandleForWriting</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#39_8"; return false;'>LineGenerators.swift:39</td><td><pre>        task.launch()</pre></td></table></span></a></span>: <span class='typeidentifier'>Process</span>, <span class='identifier'><a name='33_25' href='#' title='usrString2' onclick='return expand(this);'>lineSeparator<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#42_70"; return false;'>LineGenerators.swift:42</td><td><pre>        super.init( handle: pipe.fileHandleForReading, lineSeparator: lineSeparator )</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>? = <span class='keyword'>nil</span> ) {
<span class=linenum>0034</span>    
<span class=linenum>0035</span>            <span class='keyword'>self</span>.<span class='identifier'><a name='35_13' href='LineGenerators.swift.html#17_8' title='usrString1'>task</a></span> = <span class='identifier'><a name='35_20' href='LineGenerators.swift.html#33_10' title='usrString1'>task</a></span>
<span class=linenum>0036</span>    
<span class=linenum>0037</span>            <span class='keyword'>let</span> <span class='identifier'><a name='37_12' title='usrString3'>pipe</a></span> = <span class='identifier'>Pipe</span>()
<span class=linenum>0038</span>            <span class='identifier'><a name='38_8' href='LineGenerators.swift.html#33_10' title='usrString1'>task</a></span>.<span class='identifier'>standardOutput</span> = <span class='identifier'><a name='38_30' href='LineGenerators.swift.html#37_12' title='usrString1'>pipe</a></span>.<span class='identifier'>fileHandleForWriting</span>
<span class=linenum>0039</span>            <span class='identifier'><a name='39_8' href='LineGenerators.swift.html#33_10' title='usrString1'>task</a></span>.<span class='identifier'>launch</span>()
<span class=linenum>0040</span>    
<span class=linenum>0041</span>            <span class='identifier'><a name='41_8' href='LineGenerators.swift.html#37_12' title='usrString1'>pipe</a></span>.<span class='identifier'>fileHandleForWriting</span>.<span class='identifier'>closeFile</span>()
<span class=linenum>0042</span>            <span class='keyword'>super</span>.<span class='identifier'><a name='42_14' href='LineGenerators.swift.html#62_4' title='usrString1'>init</a></span>( <span class='identifier'>handle</span>: <span class='identifier'><a name='42_28' href='LineGenerators.swift.html#37_12' title='usrString1'>pipe</a></span>.<span class='identifier'>fileHandleForReading</span>, <span class='identifier'>lineSeparator</span>: <span class='identifier'><a name='42_70' href='LineGenerators.swift.html#33_25' title='usrString1'>lineSeparator</a></span> )
<span class=linenum>0043</span>        }
<span class=linenum>0044</span>    
<span class=linenum>0045</span>        <span class='keyword'>deinit</span> {
<span class=linenum>0046</span>            <span class='identifier'><a name='46_8' href='LineGenerators.swift.html#17_8' title='usrString1'>task</a></span>.<span class='identifier'>terminate</span>()
<span class=linenum>0047</span>        }
<span class=linenum>0048</span>    
<span class=linenum>0049</span>    }
<span class=linenum>0050</span>    
<span class=linenum>0051</span>    <span class='keyword'>class</span> <span class='identifier'><a name='51_6' href='#' title='usrString2' onclick='return expand(this);'>FileGenerator<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#15_21"; return false;'>LineGenerators.swift:15</td><td><pre>class TaskGenerator: FileGenerator {</pre></td></table></span></a></span>: <span class='typeidentifier'>IteratorProtocol</span> {
<span class=linenum>0052</span>    
<span class=linenum>0053</span>        <span class='keyword'>let</span> <span class='identifier'><a name='53_8' href='#' title='usrString2' onclick='return expand(this);'>eol<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#63_13"; return false;'>LineGenerators.swift:63</td><td><pre>        self.eol = Int32((lineSeparator ?? "\n").utf16.first!)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#69_57"; return false;'>LineGenerators.swift:69</td><td><pre>            if let endOfLine = memchr( readBuffer.bytes, eol, readBuffer.length ) {</pre></td></table></span></a></span>: <span class='typeidentifier'>Int32</span>
<span class=linenum>0054</span>        <span class='keyword'>let</span> <span class='identifier'><a name='54_8' href='#' title='usrString2' onclick='return expand(this);'>handle<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#64_13"; return false;'>LineGenerators.swift:64</td><td><pre>        self.handle = handle</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#82_28"; return false;'>LineGenerators.swift:82</td><td><pre>            let bytesRead = handle.availableData</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#104_8"; return false;'>LineGenerators.swift:104</td><td><pre>        handle.closeFile()</pre></td></table></span></a></span>: <span class='typeidentifier'>FileHandle</span>
<span class=linenum>0055</span>        <span class='keyword'>let</span> <span class='identifier'><a name='55_8' href='#' title='usrString2' onclick='return expand(this);'>readBuffer<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#69_39"; return false;'>LineGenerators.swift:69</td><td><pre>            if let endOfLine = memchr( readBuffer.bytes, eol, readBuffer.length ) {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#69_62"; return false;'>LineGenerators.swift:69</td><td><pre>            if let endOfLine = memchr( readBuffer.bytes, eol, readBuffer.length ) {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#73_28"; return false;'>LineGenerators.swift:73</td><td><pre>                let start = readBuffer.bytes.assumingMemoryBound(to: Int8.self)</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#77_16"; return false;'>LineGenerators.swift:77</td><td><pre>                readBuffer.replaceBytes( in: consumed, withBytes:nil, length:0 )</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#84_19"; return false;'>LineGenerators.swift:84</td><td><pre>                if readBuffer.length != 0 {</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#85_54"; return false;'>LineGenerators.swift:85</td><td><pre>                    let last = String.fromData( data: readBuffer )</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#86_20"; return false;'>LineGenerators.swift:86</td><td><pre>                    readBuffer.length = 0</pre></td><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#94_12"; return false;'>LineGenerators.swift:94</td><td><pre>            readBuffer.append( bytesRead )</pre></td></table></span></a></span> = <span class='identifier'>NSMutableData</span>()
<span class=linenum>0056</span>    
<span class=linenum>0057</span>        <span class='builtin'>convenience</span> <span class='keyword'>init</span>?( <span class='identifier'><a name='57_23' href='#' title='usrString2' onclick='return expand(this);'>path<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#58_57"; return false;'>LineGenerators.swift:58</td><td><pre>        guard let handle = FileHandle( forReadingAtPath: path ) else { return nil }</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>, <span class='identifier'><a name='57_37' href='#' title='usrString2' onclick='return expand(this);'>lineSeparator<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#59_50"; return false;'>LineGenerators.swift:59</td><td><pre>        self.init( handle: handle, lineSeparator: lineSeparator )</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>? = <span class='keyword'>nil</span> ) {
<span class=linenum>0058</span>            <span class='keyword'>guard</span> <span class='keyword'>let</span> <span class='identifier'><a name='58_18' title='usrString3'>handle</a></span> = <span class='identifier'>FileHandle</span>( <span class='identifier'>forReadingAtPath</span>: <span class='identifier'><a name='58_57' href='LineGenerators.swift.html#57_23' title='usrString1'>path</a></span> ) <span class='keyword'>else</span> { <span class='keyword'>return</span> <span class='keyword'>nil</span> }
<span class=linenum>0059</span>            <span class='keyword'>self</span>.<span class='identifier'><a name='59_13' href='LineGenerators.swift.html#62_4' title='usrString1'>init</a></span>( <span class='identifier'>handle</span>: <span class='identifier'><a name='59_27' href='LineGenerators.swift.html#58_18' title='usrString1'>handle</a></span>, <span class='identifier'>lineSeparator</span>: <span class='identifier'><a name='59_50' href='LineGenerators.swift.html#57_37' title='usrString1'>lineSeparator</a></span> )
<span class=linenum>0060</span>        }
<span class=linenum>0061</span>    
<span class=linenum>0062</span>        <span class='keyword'>init</span>( <span class='identifier'><a name='62_10' href='#' title='usrString2' onclick='return expand(this);'>handle<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#64_22"; return false;'>LineGenerators.swift:64</td><td><pre>        self.handle = handle</pre></td></table></span></a></span>: <span class='typeidentifier'>FileHandle</span>, <span class='identifier'><a name='62_30' href='#' title='usrString2' onclick='return expand(this);'>lineSeparator<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#63_26"; return false;'>LineGenerators.swift:63</td><td><pre>        self.eol = Int32((lineSeparator ?? "\n").utf16.first!)</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>? = <span class='keyword'>nil</span> ) {
<span class=linenum>0063</span>            <span class='keyword'>self</span>.<span class='identifier'><a name='63_13' href='LineGenerators.swift.html#53_8' title='usrString1'>eol</a></span> = <span class='identifier'>Int32</span>((<span class='identifier'><a name='63_26' href='LineGenerators.swift.html#62_30' title='usrString1'>lineSeparator</a></span> ?? <span class='string'>"\n"</span>).<span class='identifier'>utf16</span>.<span class='identifier'>first</span>!)
<span class=linenum>0064</span>            <span class='keyword'>self</span>.<span class='identifier'><a name='64_13' href='LineGenerators.swift.html#54_8' title='usrString1'>handle</a></span> = <span class='identifier'><a name='64_22' href='LineGenerators.swift.html#62_10' title='usrString1'>handle</a></span>
<span class=linenum>0065</span>        }
<span class=linenum>0066</span>    
<span class=linenum>0067</span>        <span class='keyword'>func</span> <span class='identifier'><a name='67_9' title='usrString2' onclick='return expand(this);'>next<span class='references'><table></table></span></a></span>() -> <span class='typeidentifier'>String</span>? {
<span class=linenum>0068</span>            <span class='keyword'>while</span> <span class='keyword'>true</span> {
<span class=linenum>0069</span>                <span class='keyword'>if</span> <span class='keyword'>let</span> <span class='identifier'><a name='69_19' title='usrString3'>endOfLine</a></span> = <span class='identifier'>memchr</span>( <span class='identifier'><a name='69_39' href='LineGenerators.swift.html#55_8' title='usrString1'>readBuffer</a></span>.<span class='identifier'>bytes</span>, <span class='identifier'><a name='69_57' href='LineGenerators.swift.html#53_8' title='usrString1'>eol</a></span>, <span class='identifier'><a name='69_62' href='LineGenerators.swift.html#55_8' title='usrString1'>readBuffer</a></span>.<span class='identifier'>length</span> ) {
<span class=linenum>0070</span>                    <span class='keyword'>let</span> <span class='identifier'><a name='70_20' title='usrString3'>endOfLine</a></span> = <span class='identifier'><a name='70_32' href='LineGenerators.swift.html#69_19' title='usrString1'>endOfLine</a></span>.<span class='identifier'>assumingMemoryBound</span>(<span class='identifier'>to</span>: <span class='identifier'>Int8</span>.<span class='keyword'>self</span>)
<span class=linenum>0071</span>                    <span class='identifier'><a name='71_16' href='LineGenerators.swift.html#70_20' title='usrString1'>endOfLine</a></span>[<span class='number'>0</span>] = <span class='number'>0</span>
<span class=linenum>0072</span>    
<span class=linenum>0073</span>                    <span class='keyword'>let</span> <span class='identifier'><a name='73_20' title='usrString3'>start</a></span> = <span class='identifier'><a name='73_28' href='LineGenerators.swift.html#55_8' title='usrString1'>readBuffer</a></span>.<span class='identifier'>bytes</span>.<span class='identifier'>assumingMemoryBound</span>(<span class='identifier'>to</span>: <span class='identifier'>Int8</span>.<span class='keyword'>self</span>)
<span class=linenum>0074</span>                    <span class='keyword'>let</span> <span class='identifier'><a name='74_20' title='usrString3'>line</a></span> = <span class='identifier'>String</span>( <span class='identifier'>cString</span>: <span class='identifier'><a name='74_44' href='LineGenerators.swift.html#73_20' title='usrString1'>start</a></span> )
<span class=linenum>0075</span>    
<span class=linenum>0076</span>                    <span class='keyword'>let</span> <span class='identifier'><a name='76_20' title='usrString3'>consumed</a></span> = <span class='identifier'>NSMakeRange</span>( <span class='number'>0</span>, <span class='identifier'>UnsafePointer</span>&lt;<span class='typeidentifier'>Int8</span>>(<span class='identifier'><a name='76_67' href='LineGenerators.swift.html#70_20' title='usrString1'>endOfLine</a></span>) + <span class='number'>1</span> - <span class='identifier'><a name='76_84' href='LineGenerators.swift.html#73_20' title='usrString1'>start</a></span> )
<span class=linenum>0077</span>                    <span class='identifier'><a name='77_16' href='LineGenerators.swift.html#55_8' title='usrString1'>readBuffer</a></span>.<span class='identifier'>replaceBytes</span>( <span class='identifier'>in</span>: <span class='identifier'><a name='77_45' href='LineGenerators.swift.html#76_20' title='usrString1'>consumed</a></span>, <span class='identifier'>withBytes</span>:<span class='keyword'>nil</span>, <span class='identifier'>length</span>:<span class='number'>0</span> )
<span class=linenum>0078</span>    
<span class=linenum>0079</span>                    <span class='keyword'>return</span> <span class='identifier'><a name='79_23' href='LineGenerators.swift.html#74_20' title='usrString1'>line</a></span>
<span class=linenum>0080</span>                }
<span class=linenum>0081</span>    
<span class=linenum>0082</span>                <span class='keyword'>let</span> <span class='identifier'><a name='82_16' title='usrString3'>bytesRead</a></span> = <span class='identifier'><a name='82_28' href='LineGenerators.swift.html#54_8' title='usrString1'>handle</a></span>.<span class='identifier'>availableData</span>
<span class=linenum>0083</span>                <span class='keyword'>if</span> <span class='identifier'><a name='83_15' href='LineGenerators.swift.html#82_16' title='usrString1'>bytesRead</a></span>.<span class='identifier'>count</span> &lt;= <span class='number'>0</span> {
<span class=linenum>0084</span>                    <span class='keyword'>if</span> <span class='identifier'><a name='84_19' href='LineGenerators.swift.html#55_8' title='usrString1'>readBuffer</a></span>.<span class='identifier'>length</span> != <span class='number'>0</span> {
<span class=linenum>0085</span>                        <span class='keyword'>let</span> <span class='identifier'><a name='85_24' title='usrString3'>last</a></span> = <span class='identifier'>String</span>.<span class='identifier'><a name='85_38' href='LineGenerators.swift.html#110_16' title='usrString1'>fromData</a></span>( <span class='identifier'>data</span>: <span class='identifier'><a name='85_54' href='LineGenerators.swift.html#55_8' title='usrString1'>readBuffer</a></span> )
<span class=linenum>0086</span>                        <span class='identifier'><a name='86_20' href='LineGenerators.swift.html#55_8' title='usrString1'>readBuffer</a></span>.<span class='identifier'>length</span> = <span class='number'>0</span>
<span class=linenum>0087</span>                        <span class='keyword'>return</span> <span class='identifier'><a name='87_27' href='LineGenerators.swift.html#85_24' title='usrString1'>last</a></span>
<span class=linenum>0088</span>                    }
<span class=linenum>0089</span>                    <span class='keyword'>else</span> {
<span class=linenum>0090</span>                        <span class='keyword'>break</span>
<span class=linenum>0091</span>                    }
<span class=linenum>0092</span>                }
<span class=linenum>0093</span>    
<span class=linenum>0094</span>                <span class='identifier'><a name='94_12' href='LineGenerators.swift.html#55_8' title='usrString1'>readBuffer</a></span>.<span class='identifier'>append</span>( <span class='identifier'><a name='94_31' href='LineGenerators.swift.html#82_16' title='usrString1'>bytesRead</a></span> )
<span class=linenum>0095</span>            }
<span class=linenum>0096</span>            <span class='keyword'>return</span> <span class='keyword'>nil</span>
<span class=linenum>0097</span>        }
<span class=linenum>0098</span>    
<span class=linenum>0099</span>        <span class='keyword'>var</span> <span class='identifier'><a name='99_8' title='usrString2' onclick='return expand(this);'>sequence<span class='references'><table></table></span></a></span>: <span class='typeidentifier'>AnySequence</span>&lt;<span class='typeidentifier'>String</span>> {
<span class=linenum>0100</span>            <span class='keyword'>return</span> <span class='identifier'>AnySequence</span>({<span class='keyword'>self</span>})
<span class=linenum>0101</span>        }
<span class=linenum>0102</span>    
<span class=linenum>0103</span>        <span class='keyword'>deinit</span> {
<span class=linenum>0104</span>            <span class='identifier'><a name='104_8' href='LineGenerators.swift.html#54_8' title='usrString1'>handle</a></span>.<span class='identifier'>closeFile</span>()
<span class=linenum>0105</span>        }
<span class=linenum>0106</span>    }
<span class=linenum>0107</span>    
<span class=linenum>0108</span>    <span class='keyword'>extension</span> <span class='typeidentifier'>String</span> {
<span class=linenum>0109</span>    
<span class=linenum>0110</span>        <span class='keyword'>static</span> <span class='keyword'>func</span> <span class='identifier'><a name='110_16' href='#' title='usrString2' onclick='return expand(this);'>fromData<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#85_38"; return false;'>LineGenerators.swift:85</td><td><pre>                    let last = String.fromData( data: readBuffer )</pre></td></table></span></a></span>( <span class='identifier'><a name='110_26' href='#' title='usrString2' onclick='return expand(this);'>data<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#111_31"; return false;'>LineGenerators.swift:111</td><td><pre>        return NSString( data: data as Data, encoding: encoding.rawValue ) as String?</pre></td></table></span></a></span>: <span class='typeidentifier'>NSData</span>, <span class='identifier'><a name='110_40' href='#' title='usrString2' onclick='return expand(this);'>encoding<span class='references'><table><tr><td style='text-decoration: underline;' onclick='document.location.href="LineGenerators.swift.html#111_55"; return false;'>LineGenerators.swift:111</td><td><pre>        return NSString( data: data as Data, encoding: encoding.rawValue ) as String?</pre></td></table></span></a></span>: <span class='typeidentifier'>String</span>.<span class='typeidentifier'>Encoding</span> = .<span class='identifier'>utf8</span> ) -> <span class='typeidentifier'>String</span>? {
<span class=linenum>0111</span>            <span class='keyword'>return</span> <span class='identifier'>NSString</span>( <span class='identifier'>data</span>: <span class='identifier'><a name='111_31' href='LineGenerators.swift.html#110_26' title='usrString1'>data</a></span> <span class='keyword'>as</span> <span class='typeidentifier'>Data</span>, <span class='identifier'>encoding</span>: <span class='identifier'><a name='111_55' href='LineGenerators.swift.html#110_40' title='usrString1'>encoding</a></span>.<span class='identifier'>rawValue</span> ) <span class='keyword'>as</span> <span class='typeidentifier'>String</span>?
<span class=linenum>0112</span>        }
<span class=linenum>0113</span>    
<span class=linenum>0114</span>    }
<span class=linenum>0115</span>    